{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nvar _jsxFileName = \"/home/caleb_lee/gina_web_app/components/parent/messagecard.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function () { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from 'react';\nimport View from \"react-native-web/dist/exports/View\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport { Card, Body } from 'native-base';\nimport { formatDate, fetchData as _fetchData, post, beautifyTime, formatTime, get } from \"../util\";\nimport Reloading from \"../reloading\";\n\nvar MessageCard = function (_React$Component) {\n  _inherits(MessageCard, _React$Component);\n\n  var _super = _createSuper(MessageCard);\n\n  function MessageCard(props) {\n    var _this;\n\n    _classCallCheck(this, MessageCard);\n\n    _this = _super.call(this, props);\n    _this.state = {\n      child_id: _this.props.child_id,\n      isLoading: true,\n      data_available: false,\n      items_to_bring: [],\n      activities: [],\n      text: '',\n      teacher_id: '',\n      message_id: null,\n      message_for_teacher: '',\n      isConnected: true,\n      scrollHeight: '100%',\n      message_read: false\n    };\n    _this.fetchData = _this.fetchData.bind(_assertThisInitialized(_this));\n    return _this;\n  }\n\n  _createClass(MessageCard, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var date = this.props.date;\n      this.fetchData(this.state.child_id, new Date(date.getTime()));\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      if (this.props.date !== prevProps.date) {\n        this.setState({\n          isLoading: true,\n          message_for_teacher: '',\n          scrollHeight: '100%'\n        });\n        this.fetchData(this.props.child_id, new Date(this.props.date.getTime()));\n      } else if (this.props.child_id !== prevProps.child_id) {\n        this.setState({\n          isLoading: true,\n          message_for_teacher: '',\n          scrollHeight: '100%'\n        });\n        this.fetchData(this.props.child_id, new Date());\n      } else if (this.props.isConnected != prevProps.isConnected) {\n        this.setState({\n          isConnected: this.props.isConnected\n        });\n      }\n    }\n  }, {\n    key: \"setScrollHeight\",\n    value: function setScrollHeight(scrollHeight) {\n      this.setState({\n        scrollHeight: scrollHeight\n      });\n    }\n  }, {\n    key: \"fetchData\",\n    value: function fetchData(child_id, propDate) {\n      var date, start_date, end_date, messageData;\n      return _regeneratorRuntime.async(function fetchData$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              date = new Date(propDate.getTime());\n\n              if (!(date.getHours() < 17)) {\n                _context.next = 4;\n                break;\n              }\n\n              this.setState({\n                isLoading: false,\n                message_for_teacher: '',\n                data_available: false\n              });\n              return _context.abrupt(\"return\");\n\n            case 4:\n              start_date = formatDate(date);\n              date.setDate(date.getDate() + 1);\n              end_date = formatDate(date);\n              _context.next = 9;\n              return _regeneratorRuntime.awrap(_fetchData('message', child_id, start_date, end_date));\n\n            case 9:\n              messageData = _context.sent;\n\n              if (!(messageData.data === undefined || messageData.data[start_date] === undefined)) {\n                _context.next = 13;\n                break;\n              }\n\n              this.setState({\n                isLoading: false,\n                message_for_teacher: '',\n                data_available: false\n              });\n              return _context.abrupt(\"return\");\n\n            case 13:\n              this.denormalize(messageData.data[start_date]);\n\n            case 14:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, this, null, Promise);\n    }\n  }, {\n    key: \"denormalize\",\n    value: function denormalize(message_data) {\n      var items_list = ['母奶粉', '尿布', '水壺', '衣物'];\n      var activities_list = ['嬰兒按摩', '音樂律動', '教具操作', '繪本欣賞', '認知圖片', '體能活動', '藝術創作', '多元語言'];\n      var items_to_bring = [];\n      var activities = [];\n\n      for (var i = 0; i < message_data.items_to_bring.length - 1; i++) {\n        if (message_data.items_to_bring[i]) {\n          items_to_bring.push(items_list[i]);\n        }\n      }\n\n      if (message_data.items_to_bring[message_data.items_to_bring.length - 1]) {\n        items_to_bring.push(message_data.other_item);\n      }\n\n      for (var i = 0; i < message_data.activities.length - 1; i++) {\n        if (message_data.activities[i]) {\n          activities.push(activities_list[i]);\n        }\n      }\n\n      if (message_data.activities[message_data.activities.length - 1]) {\n        activities.push(message_data.other_activity);\n      }\n\n      this.setState({\n        isLoading: false,\n        data_available: true,\n        message_id: message_data.message_id,\n        items_to_bring: items_to_bring,\n        activities: activities,\n        text: message_data.text,\n        teacher_id: message_data.teacher_id,\n        message_for_teacher: message_data.message_for_teacher,\n        message_read: message_data.message_read\n      });\n    }\n  }, {\n    key: \"sendMessage\",\n    value: function sendMessage() {\n      var _this$props, class_id, parent_id, date, _this$state, message_for_teacher, message_id, isConnected, body, response, success, statusCode, message, data;\n\n      return _regeneratorRuntime.async(function sendMessage$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _this$props = this.props, class_id = _this$props.class_id, parent_id = _this$props.parent_id, date = _this$props.date;\n              _this$state = this.state, message_for_teacher = _this$state.message_for_teacher, message_id = _this$state.message_id, isConnected = _this$state.isConnected;\n\n              if (!(!this.editable() || message_for_teacher === '')) {\n                _context2.next = 4;\n                break;\n              }\n\n              return _context2.abrupt(\"return\");\n\n            case 4:\n              if (isConnected) {\n                _context2.next = 7;\n                break;\n              }\n\n              alert('網路連不到! 請稍後再試試看');\n              return _context2.abrupt(\"return\");\n\n            case 7:\n              body = {\n                student_id: this.props.child_id,\n                parent_id: parent_id,\n                message_id: message_id,\n                message_for_teacher: message_for_teacher,\n                timestamp: formatDate(date) + ' ' + formatTime(date)\n              };\n              _context2.next = 10;\n              return _regeneratorRuntime.awrap(post(\"/message/class/\" + class_id, body));\n\n            case 10:\n              response = _context2.sent;\n              success = response.success, statusCode = response.statusCode, message = response.message, data = response.data;\n\n              if (success) {\n                _context2.next = 15;\n                break;\n              }\n\n              alert(\"Sorry \\u50B3\\u9001\\u8A0A\\u606F\\u6642\\u96FB\\u8166\\u51FA\\u72C0\\u6CC1\\u4E86\\uFF01\\u8ACB\\u622A\\u5716\\u548C\\u8207\\u5DE5\\u7A0B\\u5E2B\\u806F\\u7E6B\\n\\n\" + message);\n              return _context2.abrupt(\"return\");\n\n            case 15:\n              alert(\"\\u8A0A\\u606F\\u50B3\\u9054\\u6210\\u529F\\uFF01\");\n              this.fetchData(this.state.child_id, new Date(date.getTime()));\n\n            case 17:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, null, this, null, Promise);\n    }\n  }, {\n    key: \"editable\",\n    value: function editable() {\n      var date = this.props.date;\n      var threshold = new Date();\n\n      if (threshold.getDay() === 6) {\n        threshold.setDate(threshold.getDate() - 1);\n      } else if (threshold.getDay() === 0) {\n        threshold.setDate(threshold.getDate() - 2);\n      }\n\n      threshold.setHours(17, 0, 0, 0);\n      return date.getTime() >= threshold.getTime() || this.before4am();\n    }\n  }, {\n    key: \"before4am\",\n    value: function before4am() {\n      var date = this.props.date;\n      var today = new Date();\n      var prev_day = new Date();\n\n      if (today.getDay() === 1) {\n        prev_day.setDate(prev_day.getDate() - 3);\n        return date.toDateString() === prev_day.toDateString() && today.getHours() < 4;\n      } else if (today.getDay() > 1 && today.getDay() < 6) {\n        prev_day.setDate(prev_day.getDate() - 1);\n        return date.toDateString() === prev_day.toDateString() && today.getHours() < 4;\n      }\n\n      return false;\n    }\n  }, {\n    key: \"showMessageForTeacher\",\n    value: function showMessageForTeacher() {\n      var date = this.props.date;\n      var today = new Date();\n      today.setHours(0, 0, 0, 1);\n\n      if (date.toDateString() === today.toDateString() && this.editable()) {\n        return true;\n      } else if (date < today) {\n        return true;\n      }\n\n      return false;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$state2 = this.state,\n          items_to_bring = _this$state2.items_to_bring,\n          activities = _this$state2.activities,\n          text = _this$state2.text,\n          teacher_id = _this$state2.teacher_id,\n          isLoading = _this$state2.isLoading,\n          data_available = _this$state2.data_available,\n          message_for_teacher = _this$state2.message_for_teacher,\n          scrollHeight = _this$state2.scrollHeight,\n          message_read = _this$state2.message_read;\n      var date = this.props.date;\n      return React.createElement(Card, {\n        style: {\n          width: '93%'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 204,\n          columnNumber: 7\n        }\n      }, React.createElement(View, {\n        style: {\n          flex: 1,\n          flexDirection: 'row'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 205,\n          columnNumber: 9\n        }\n      }, React.createElement(View, {\n        style: {\n          width: 56,\n          height: 56,\n          alignItems: 'center',\n          justifyContent: 'center'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 206,\n          columnNumber: 11\n        }\n      }, React.createElement(Image, {\n        source: require(\"../../assets/icon-message.png\"),\n        style: {\n          width: 48,\n          height: 48\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 207,\n          columnNumber: 13\n        }\n      })), React.createElement(View, {\n        style: {\n          flex: 1\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 215,\n          columnNumber: 11\n        }\n      }, React.createElement(View, {\n        style: {\n          paddingTop: 8\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 216,\n          columnNumber: 13\n        }\n      }, React.createElement(Text, {\n        style: {\n          fontSize: 20\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 217,\n          columnNumber: 15\n        }\n      }, \"\\u8A0A\\u606F\")), isLoading ? React.createElement(Reloading, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 220,\n          columnNumber: 15\n        }\n      }) : data_available ? React.createElement(View, {\n        style: {\n          flex: 1,\n          paddingVertical: 8,\n          paddingRight: 8\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 222,\n          columnNumber: 17\n        }\n      }, React.createElement(View, {\n        style: {\n          padding: 5,\n          marginBottom: 6,\n          backgroundColor: '#F5F5F5'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 223,\n          columnNumber: 19\n        }\n      }, React.createElement(Text, {\n        style: {\n          color: 'rgba(0,0,0,0.8)',\n          fontSize: 15\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 224,\n          columnNumber: 21\n        }\n      }, \"\\u611B\\u7684\\u5C0F\\u8A9E\"), React.createElement(Text, {\n        style: {\n          fontSize: 25,\n          paddingVertical: 7\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 225,\n          columnNumber: 21\n        }\n      }, text)), React.createElement(View, {\n        style: {\n          flexDirection: 'row'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 227,\n          columnNumber: 19\n        }\n      }, React.createElement(View, {\n        style: {\n          flex: 1,\n          padding: 5,\n          backgroundColor: '#F5F5F5',\n          marginRight: 3\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 230,\n          columnNumber: 21\n        }\n      }, React.createElement(Text, {\n        style: {\n          color: 'rgba(0,0,0,0.8)',\n          fontSize: 15\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 231,\n          columnNumber: 23\n        }\n      }, \"\\u5BB6\\u9577\\u6E96\\u5099\"), items_to_bring.length ? React.createElement(View, {\n        style: {\n          alignItems: 'center',\n          paddingVertical: 7\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 233,\n          columnNumber: 25\n        }\n      }, items_to_bring.map(function (item, index) {\n        return React.createElement(Text, {\n          key: index,\n          style: {\n            padding: 5,\n            backgroundColor: 'lightgrey',\n            marginBottom: 3,\n            fontSize: 25\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 236,\n            columnNumber: 31\n          }\n        }, item);\n      })) : null), React.createElement(View, {\n        style: {\n          flex: 1,\n          padding: 5,\n          backgroundColor: '#F5F5F5',\n          marginLeft: 3\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 253,\n          columnNumber: 21\n        }\n      }, React.createElement(Text, {\n        style: {\n          color: 'rgba(0,0,0,0.8)',\n          fontSize: 15\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 254,\n          columnNumber: 23\n        }\n      }, \"\\u4ECA\\u65E5\\u6D3B\\u52D5\"), activities.length ? React.createElement(View, {\n        style: {\n          alignItems: 'center',\n          paddingVertical: 7\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 256,\n          columnNumber: 25\n        }\n      }, activities.map(function (activity, index) {\n        return React.createElement(Text, {\n          key: index,\n          style: {\n            padding: 5,\n            backgroundColor: 'lightgrey',\n            marginBottom: 3,\n            fontSize: 25\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 259,\n            columnNumber: 31\n          }\n        }, activity);\n      })) : null)), React.createElement(View, {\n        style: {\n          backgroundColor: '#ffddb7',\n          marginTop: 5\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 279,\n          columnNumber: 19\n        }\n      }, React.createElement(View, {\n        style: {\n          padding: 5,\n          flexDirection: 'row',\n          justifyContent: 'space-between'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 280,\n          columnNumber: 21\n        }\n      }, React.createElement(Text, {\n        style: {\n          fontSize: 15\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 281,\n          columnNumber: 23\n        }\n      }, \"\\u7D66\\u8001\\u5E2B\\u7684\\u8A71\"), message_for_teacher !== '' && React.createElement(Text, {\n        style: {\n          fontSize: 15\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 282,\n          columnNumber: 54\n        }\n      }, message_read ? '已讀' : '未讀')), React.createElement(TextInput, {\n        editable: this.editable(),\n        style: {\n          height: scrollHeight,\n          justifyContent: 'center',\n          backgroundColor: 'rgba(255,255,255,0.7)',\n          paddingTop: 10,\n          padding: 10,\n          fontSize: 25\n        },\n        placeholder: this.editable() ? '點擊我開始填寫...' : isLoading ? '下載中...' : '已不能填寫',\n        scrollEnabled: false,\n        multiline: true,\n        value: message_for_teacher,\n        onChangeText: function onChangeText(message_for_teacher) {\n          return _this2.setState({\n            message_for_teacher: message_for_teacher\n          });\n        },\n        onChange: function onChange(e) {\n          return _this2.setScrollHeight(e.target.scrollHeight);\n        },\n        onLayout: function onLayout(event) {\n          var scrollHeight = event.nativeEvent.target.scrollHeight;\n\n          _this2.setState({\n            scrollHeight: scrollHeight\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 285,\n          columnNumber: 21\n        }\n      }), React.createElement(TouchableOpacity, {\n        disabled: !this.editable(),\n        style: {\n          padding: 10,\n          justifyContent: 'center'\n        },\n        onClick: function onClick() {\n          return _this2.sendMessage();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 316,\n          columnNumber: 21\n        }\n      }, React.createElement(Text, {\n        style: {\n          fontSize: 25,\n          alignSelf: 'center'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 321,\n          columnNumber: 23\n        }\n      }, \"\\u9001\\u51FA\")))) : React.createElement(View, {\n        style: {\n          flex: 1,\n          paddingVertical: 8,\n          paddingRight: 8\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 325,\n          columnNumber: 19\n        }\n      }, React.createElement(Text, {\n        style: {\n          fontSize: 17\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 326,\n          columnNumber: 21\n        }\n      }, \"\\u6C92\\u6709\\u65B0\\u7D00\\u9304\"), this.showMessageForTeacher() && React.createElement(View, {\n        style: {\n          backgroundColor: '#ffddb7',\n          marginTop: 5\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 329,\n          columnNumber: 19\n        }\n      }, React.createElement(View, {\n        style: {\n          padding: 5,\n          flexDirection: 'row',\n          justifyContent: 'space-between'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 330,\n          columnNumber: 21\n        }\n      }, React.createElement(Text, {\n        style: {\n          fontSize: 15\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 331,\n          columnNumber: 23\n        }\n      }, \"\\u7D66\\u8001\\u5E2B\\u7684\\u8A71\"), message_for_teacher !== '' && React.createElement(Text, {\n        style: {\n          fontSize: 15\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 332,\n          columnNumber: 54\n        }\n      }, message_read ? '已讀' : '未讀')), React.createElement(TextInput, {\n        editable: this.editable(),\n        style: {\n          height: scrollHeight,\n          justifyContent: 'center',\n          backgroundColor: 'rgba(255,255,255,0.7)',\n          paddingTop: 10,\n          padding: 10,\n          fontSize: 25\n        },\n        placeholder: this.editable() ? '點擊我開始填寫...' : isLoading ? '下載中...' : '已不能填寫',\n        scrollEnabled: false,\n        multiline: true,\n        value: message_for_teacher,\n        onChangeText: function onChangeText(message_for_teacher) {\n          return _this2.setState({\n            message_for_teacher: message_for_teacher\n          });\n        },\n        onChange: function onChange(e) {\n          return _this2.setScrollHeight(e.target.scrollHeight);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 335,\n          columnNumber: 21\n        }\n      }), React.createElement(TouchableOpacity, {\n        disabled: !this.editable(),\n        style: {\n          padding: 10,\n          justifyContent: 'center'\n        },\n        onClick: function onClick() {\n          return _this2.sendMessage();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 360,\n          columnNumber: 21\n        }\n      }, React.createElement(Text, {\n        style: {\n          fontSize: 25,\n          alignSelf: 'center'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 365,\n          columnNumber: 23\n        }\n      }, \"\\u9001\\u51FA\")))))));\n    }\n  }]);\n\n  return MessageCard;\n}(React.Component);\n\nexport { MessageCard as default };","map":{"version":3,"sources":["/home/caleb_lee/gina_web_app/components/parent/messagecard.js"],"names":["React","Card","Body","formatDate","fetchData","post","beautifyTime","formatTime","get","Reloading","MessageCard","props","state","child_id","isLoading","data_available","items_to_bring","activities","text","teacher_id","message_id","message_for_teacher","isConnected","scrollHeight","message_read","bind","date","Date","getTime","prevProps","setState","propDate","getHours","start_date","setDate","getDate","end_date","messageData","data","undefined","denormalize","message_data","items_list","activities_list","i","length","push","other_item","other_activity","class_id","parent_id","editable","alert","body","student_id","timestamp","response","success","statusCode","message","threshold","getDay","setHours","before4am","today","prev_day","toDateString","width","flex","flexDirection","height","alignItems","justifyContent","require","paddingTop","fontSize","paddingVertical","paddingRight","padding","marginBottom","backgroundColor","color","marginRight","map","item","index","marginLeft","activity","marginTop","e","setScrollHeight","target","event","nativeEvent","sendMessage","alignSelf","showMessageForTeacher","Component"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { View, Text, Image, TextInput, TouchableOpacity, Alert } from 'react-native'\nimport { Card, Body } from 'native-base'\nimport { formatDate, fetchData, post, beautifyTime, formatTime, get } from '../util'\nimport Reloading from '../reloading'\n\nexport default class MessageCard extends React.Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      child_id: this.props.child_id,\n      isLoading: true,\n      data_available: false,\n      items_to_bring: [],\n      activities: [],\n      text: '',\n      teacher_id: '',\n      message_id: null,\n      message_for_teacher: '',\n      isConnected: true,\n      scrollHeight: '100%',\n      message_read: false\n    }\n    this.fetchData = this.fetchData.bind(this)\n  }\n\n  componentDidMount() {\n    const { date } = this.props\n    this.fetchData(this.state.child_id, new Date(date.getTime()))\n    // this.fetchDiaperAmount(child_id)\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.date !== prevProps.date) {\n      this.setState({ isLoading: true, message_for_teacher: '', scrollHeight: '100%' })\n      this.fetchData(this.props.child_id, new Date(this.props.date.getTime()));\n    } else if (this.props.child_id !== prevProps.child_id) {\n      this.setState({ isLoading: true, message_for_teacher: '', scrollHeight: '100%' })\n      this.fetchData(this.props.child_id, new Date());\n    } else if (this.props.isConnected != prevProps.isConnected) {\n      this.setState({\n        isConnected: this.props.isConnected\n      })\n    }\n  }\n\n  setScrollHeight(scrollHeight) {\n    this.setState({ scrollHeight })\n  }\n\n  async fetchData(child_id, propDate) {\n    let date = new Date(propDate.getTime())\n    if (date.getHours() < 17) {\n      this.setState({\n        isLoading: false,\n        message_for_teacher: '',\n        data_available: false\n      })\n      return\n    }\n    const start_date = formatDate(date)\n    date.setDate(date.getDate() + 1)\n    const end_date = formatDate(date)\n    const messageData = await fetchData('message', child_id, start_date, end_date)\n    if (messageData.data === undefined || messageData.data[start_date] === undefined) {\n      this.setState({\n        isLoading: false,\n        message_for_teacher: '',\n        data_available: false\n      })\n      return\n    }\n    this.denormalize(messageData.data[start_date])\n  }\n\n  // async fetchDiaperAmount(student_id) {\n  //   const response = await get(`/diaper/amount?student_id=${student_id}`)\n  //   const { success, statusCode, message, data } = response\n  //   if(!success) {\n  //     alert('Sorry 讀取尿布量時電腦出狀況了！請截圖和與工程師聯繫' + message)\n  //     return\n  //   }\n  //   console.log(response)\n  //   if (data <= 3) {\n  //     console.log('here')\n  //     this.setState({\n  //       data_available: true,\n  //       items_to_bring: [`尿布剩${data}片`]\n  //     })\n  //   }\n  // }\n\n  denormalize(message_data) {\n    const items_list = ['母奶粉', '尿布', '水壺', '衣物']\n    const activities_list = ['嬰兒按摩', '音樂律動', '教具操作', '繪本欣賞', '認知圖片', '體能活動', '藝術創作', '多元語言']\n    const items_to_bring = []\n    const activities = []\n    for (var i = 0; i < message_data.items_to_bring.length-1; i++) {\n      if (message_data.items_to_bring[i]) {\n        items_to_bring.push(items_list[i])\n      }\n    }\n\n    if (message_data.items_to_bring[message_data.items_to_bring.length-1]) {\n      items_to_bring.push(message_data.other_item)\n    }\n\n    for (var i = 0; i < message_data.activities.length - 1; i++) {\n      if (message_data.activities[i]) {\n        activities.push(activities_list[i])\n      }\n    }\n\n    if (message_data.activities[message_data.activities.length - 1]) {\n      activities.push(message_data.other_activity)\n    }\n\n    this.setState({\n      isLoading: false,\n      data_available: true,\n      message_id: message_data.message_id,\n      items_to_bring,\n      activities,\n      text: message_data.text,\n      teacher_id: message_data.teacher_id,\n      message_for_teacher: message_data.message_for_teacher,\n      message_read: message_data.message_read\n    })\n  }\n\n  async sendMessage() {\n    const { class_id, parent_id, date } = this.props\n    const { message_for_teacher, message_id, isConnected } = this.state\n    if (!this.editable() || message_for_teacher === '') return\n    if (!isConnected) {\n      alert('網路連不到! 請稍後再試試看')\n      return\n    }\n\n    // const now = new Date()\n    const body = {\n      student_id: this.props.child_id,\n      parent_id,\n      message_id,\n      message_for_teacher,\n      timestamp: formatDate(date) + ' ' + formatTime(date)\n    }\n    const response = await post(`/message/class/${class_id}`, body)\n    const { success, statusCode, message, data } = response\n    if (!success) {\n      alert(`Sorry 傳送訊息時電腦出狀況了！請截圖和與工程師聯繫\\n\\n` + message)\n      return \n    }\n    alert(`訊息傳達成功！`)\n    // const { date } = this.props\n    this.fetchData(this.state.child_id, new Date(date.getTime()))\n  }\n\n  editable() {\n    const { date } = this.props\n    // console.log('date: ', date)\n    let threshold = new Date()\n    if (threshold.getDay() === 6) { // if today is saturday\n      threshold.setDate(threshold.getDate() - 1)\n    } else if (threshold.getDay() === 0) { // if today is sunday\n      threshold.setDate(threshold.getDate() - 2)\n    }\n    threshold.setHours(17, 0, 0, 0)\n    return date.getTime() >= threshold.getTime() || this.before4am()\n  }\n\n  before4am() {\n    const { date } = this.props\n    let today = new Date()\n    let prev_day = new Date() \n    if (today.getDay() === 1) { // if today is monday, prev_day is last friday\n      prev_day.setDate(prev_day.getDate() - 3)\n      return date.toDateString() === prev_day.toDateString() && today.getHours() < 4\n    } else if (today.getDay() > 1 && today.getDay() < 6) { // today is [ tues, fri ]\n      prev_day.setDate(prev_day.getDate() - 1)\n      return date.toDateString() === prev_day.toDateString() && today.getHours() < 4\n    }\n    return false\n  }\n\n  showMessageForTeacher(){\n    const { date } = this.props\n    let today = new Date()\n    today.setHours(0,0,0,1)\n\n    if (date.toDateString() === today.toDateString() && this.editable()) {\n      return true\n    } else if (date < today) {\n      return true\n    }\n    return false\n  }\n\n  render() {\n    const { items_to_bring, activities, text, teacher_id, isLoading, data_available, message_for_teacher, scrollHeight, message_read } = this.state\n    const { date } = this.props\n    // console.log(date.toDateString())\n    return (\n      <Card style={{ width: '93%' }}>\n        <View style={{ flex: 1, flexDirection: 'row' }}>\n          <View style={{ width: 56, height: 56, alignItems: 'center', justifyContent: 'center'}}>\n            <Image\n              source={require('../../assets/icon-message.png')}\n              style={{\n                  width: 48,\n                  height: 48\n              }}\n            />\n          </View>\n          <View style={{ flex: 1 }}>\n            <View style={{ paddingTop: 8 }}>\n              <Text style={{ fontSize: 20 }}>訊息</Text>\n            </View>\n            {isLoading ? \n              <Reloading />\n              : data_available ? \n                <View style={{ flex: 1, paddingVertical: 8, paddingRight: 8 }}>\n                  <View style={{ padding: 5, marginBottom: 6, backgroundColor: '#F5F5F5' }}>\n                    <Text style={{color: 'rgba(0,0,0,0.8)', fontSize: 15}}>愛的小語</Text>\n                    <Text style={{ fontSize: 25, paddingVertical: 7 }}>{text}</Text>\n                  </View>\n                  <View\n                    style={{ flexDirection: 'row' }}\n                  >\n                    <View style={{ flex: 1, padding: 5, backgroundColor: '#F5F5F5', marginRight: 3 }}>\n                      <Text style={{color: 'rgba(0,0,0,0.8)', fontSize: 15}}>家長準備</Text>\n                      {items_to_bring.length ?\n                        <View style={{ alignItems: 'center', paddingVertical: 7}}>\n                          {items_to_bring.map((item, index) => {\n                            return(\n                              <Text \n                                key={index} \n                                style={{ \n                                  padding: 5, \n                                  backgroundColor: 'lightgrey', \n                                  marginBottom: 3,\n                                  fontSize: 25\n                                }}\n                              >\n                                {item}\n                              </Text>\n                            )\n                          })}\n                        </View>\n                        : null\n                      }\n                    </View>\n                    <View style={{ flex: 1, padding: 5, backgroundColor: '#F5F5F5', marginLeft: 3 }}>\n                      <Text style={{color: 'rgba(0,0,0,0.8)', fontSize: 15}}>今日活動</Text>\n                      {activities.length ?\n                        <View style={{ alignItems: 'center', paddingVertical: 7}}>\n                          {activities.map((activity, index) => {\n                            return(\n                              <Text \n                                key={index}\n                                style={{ \n                                  padding: 5, \n                                  backgroundColor: 'lightgrey', \n                                  marginBottom: 3,\n                                  fontSize: 25\n                                }}\n                              >\n                                {activity}\n                              </Text>\n                            )\n                          })}\n                        </View>\n                        : null\n                      }\n                    </View>\n                  </View>\n\n                  {/* message for teacher */}\n                  <View style={{ backgroundColor: '#ffddb7', marginTop: 5}}>\n                    <View style={{ padding: 5, flexDirection: 'row', justifyContent: 'space-between' }}>\n                      <Text style={{ fontSize: 15 }}>給老師的話</Text>\n                      {message_for_teacher !== '' && <Text style={{ fontSize: 15 }}>{message_read ? '已讀' : '未讀'}</Text>}\n                    </View>\n                    \n                    <TextInput\n                      editable={this.editable()}\n                      style={{\n                        // marginHorizontal: 15,\n                        height: scrollHeight,\n                        justifyContent: 'center',\n                        backgroundColor: 'rgba(255,255,255,0.7)',\n                        paddingTop: 10,\n                        padding: 10,\n                        fontSize: 25\n                      }}\n                      // textAlignVertical={\"top\"}\n                      placeholder={this.editable() ? \n                        '點擊我開始填寫...' \n                        : isLoading ?\n                          '下載中...'\n                          :'已不能填寫'}\n                      scrollEnabled={false}\n                      multiline={true}\n                      // blurOnSubmit={true}\n                      // maxLength={200}\n                      value={message_for_teacher}\n                      onChangeText={(message_for_teacher) => this.setState({ message_for_teacher })}\n                      onChange={(e) => this.setScrollHeight(e.target.scrollHeight)}\n                      onLayout={(event) => {\n                        const { scrollHeight } = event.nativeEvent.target\n                        this.setState({\n                            scrollHeight\n                        })\n                      }}\n                    />\n                    <TouchableOpacity\n                      disabled={!this.editable()}\n                      style={{ padding: 10, justifyContent: 'center' }}\n                      onClick={() => this.sendMessage()}\n                    >\n                      <Text style={{ fontSize: 25, alignSelf: 'center' }}>送出</Text>\n                    </TouchableOpacity>\n                  </View>\n                </View>\n                : <View style={{ flex: 1, paddingVertical: 8, paddingRight: 8 }}>\n                    <Text style={{ fontSize: 17 }}>沒有新紀錄</Text>\n                  {/* message for teacher */}\n                  {this.showMessageForTeacher() && \n                  <View style={{ backgroundColor: '#ffddb7', marginTop: 5}}>\n                    <View style={{ padding: 5, flexDirection: 'row', justifyContent: 'space-between' }}>\n                      <Text style={{ fontSize: 15 }}>給老師的話</Text>\n                      {message_for_teacher !== '' && <Text style={{ fontSize: 15 }}>{message_read ? '已讀' : '未讀'}</Text>}\n                    </View>\n                    \n                    <TextInput\n                      editable={this.editable()}\n                      style={{\n                        // marginHorizontal: 15,\n                        height: scrollHeight,\n                        justifyContent: 'center',\n                        backgroundColor: 'rgba(255,255,255,0.7)',\n                        paddingTop: 10,\n                        padding: 10,\n                        fontSize: 25\n                      }}\n                      // textAlignVertical={\"top\"}\n                      placeholder={this.editable() ? \n                        '點擊我開始填寫...' \n                        : isLoading ?\n                          '下載中...'\n                          :'已不能填寫'}\n                      scrollEnabled={false}\n                      multiline={true}\n                      // blurOnSubmit={true}\n                      // maxLength={200}\n                      value={message_for_teacher}\n                      onChangeText={(message_for_teacher) => this.setState({ message_for_teacher })}\n                      onChange={(e) => this.setScrollHeight(e.target.scrollHeight)}\n                    />\n                    <TouchableOpacity\n                      disabled={!this.editable()}\n                      style={{ padding: 10, justifyContent: 'center' }}\n                      onClick={() => this.sendMessage()}\n                    >\n                      <Text style={{ fontSize: 25, alignSelf: 'center' }}>送出</Text>\n                    </TouchableOpacity>\n                  </View>\n                  }\n                </View>\n            }\n          </View>\n        </View>\n      </Card>\n    );\n  }\n}"]},"metadata":{},"sourceType":"module"}