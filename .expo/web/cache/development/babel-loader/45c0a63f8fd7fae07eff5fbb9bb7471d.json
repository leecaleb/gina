{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nvar _jsxFileName = \"/home/caleb_lee/gina_web_app/components/teacher/teacherclockinout.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function () { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from 'react';\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport TouchableHighlight from \"react-native-web/dist/exports/TouchableHighlight\";\nimport { Container, Content, Text, View, Card, CardItem, Toast } from 'native-base';\nimport { connect } from 'react-redux';\nimport LoginNumberPad from \"./loginnumberpad\";\nimport { bindActionCreators } from 'redux';\nimport { markTeacherLoggedIn, markTeacherLoggedOut, markStaffAttendanceFail, fetchAttendanceSuccess } from \"../../redux/school/actions/index\";\n\nvar TeacherClockInOut = function (_React$Component) {\n  _inherits(TeacherClockInOut, _React$Component);\n\n  var _super = _createSuper(TeacherClockInOut);\n\n  function TeacherClockInOut(props) {\n    var _this;\n\n    _classCallCheck(this, TeacherClockInOut);\n\n    _this = _super.call(this, props);\n    _this.state = {\n      logging_in: false,\n      teacher_id: ''\n    };\n    _this.handleEnterPasscode = _this.handleEnterPasscode.bind(_assertThisInitialized(_this));\n    _this.hideLoginPad = _this.hideLoginPad.bind(_assertThisInitialized(_this));\n    return _this;\n  }\n\n  _createClass(TeacherClockInOut, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.fetchStaffAttendanceByClassId();\n    }\n  }, {\n    key: \"fetchStaffAttendanceByClassId\",\n    value: function fetchStaffAttendanceByClassId() {\n      var _this2 = this;\n\n      var _this$props$class = this.props.class,\n          class_id = _this$props$class.class_id,\n          isConnected = _this$props$class.isConnected;\n\n      if (!isConnected) {\n        Toast.show({\n          text: '拍謝 網路連不到! 等一下再試試看',\n          buttonText: 'Okay',\n          position: \"top\",\n          type: \"warning\",\n          duration: 5000\n        });\n        return;\n      }\n\n      var query = \"https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/dev/staff-attendance?class_id=\" + class_id;\n      fetch(query, {\n        method: 'GET',\n        headers: {\n          Accept: 'application/json',\n          'Content-Type': 'application/json'\n        }\n      }).then(function (res) {\n        return res.json();\n      }).then(function (resJson) {\n        _this2.props.fetchAttendanceSuccess(resJson.data);\n      }).catch(function (err) {\n        console.log('err: ', err);\n      });\n    }\n  }, {\n    key: \"handleEnterPasscode\",\n    value: function handleEnterPasscode(passcode) {\n      var teacher_id = this.props.class.passcodeTeacherId[passcode];\n\n      if (teacher_id === undefined || teacher_id !== this.state.teacher_id) {\n        Toast.show({\n          text: 'Wrong password!',\n          buttonText: 'Okay',\n          position: \"top\",\n          type: \"warning\",\n          duration: 3000\n        });\n      } else {\n        var teacher = this.props.class.teachers[teacher_id];\n        var time = new Date();\n\n        if (teacher.logged_in) {\n          this.clockOut(teacher_id, time);\n        } else {\n          this.clockIn(teacher_id, time);\n        }\n\n        this.setState({\n          logging_in: false\n        });\n      }\n    }\n  }, {\n    key: \"clockIn\",\n    value: function clockIn(staff_id, time) {\n      var _this3 = this;\n\n      var isConnected = this.props.class.isConnected;\n\n      if (!isConnected) {\n        Toast.show({\n          text: '拍謝 網路連不到! 等一下再試試看',\n          buttonText: 'Okay',\n          position: \"top\",\n          type: \"warning\",\n          duration: 5000\n        });\n        return;\n      }\n\n      var query = \"https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/dev/staff-attendance\";\n      fetch(query, {\n        method: 'POST',\n        headers: {\n          Accept: 'application/json',\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          staff_id: staff_id\n        })\n      }).then(function (res) {\n        return res.json();\n      }).then(function (resJson) {\n        var statusCode = resJson.statusCode,\n            message = resJson.message,\n            data = resJson.data;\n\n        if (statusCode > 200 || resJson[\"message\"] === \"Internal server error\") {\n          _this3.props.markStaffAttendanceFail(message);\n        } else {\n          _this3.props.markTeacherLoggedIn(staff_id, time, data.attendance_id);\n        }\n      }).catch(function (err) {\n        console.log('err: ', err);\n      });\n    }\n  }, {\n    key: \"clockOut\",\n    value: function clockOut(staff_id, time) {\n      var _this4 = this;\n\n      var isConnected = this.props.class.isConnected;\n\n      if (!isConnected) {\n        Toast.show({\n          text: '拍謝 網路連不到! 等一下再試試看',\n          buttonText: 'Okay',\n          position: \"top\",\n          type: \"warning\",\n          duration: 5000\n        });\n        return;\n      }\n\n      var attendance_id = this.props.class.teachers[staff_id].attendance_id;\n      var query = \"https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/dev/staff-attendance/\" + attendance_id;\n      fetch(query, {\n        method: 'PUT',\n        headers: {\n          Accept: 'application/json',\n          'Content-Type': 'application/json'\n        }\n      }).then(function (res) {\n        return res.json();\n      }).then(function (resJson) {\n        var statusCode = resJson.statusCode,\n            message = resJson.message;\n\n        if (statusCode > 200 || message === \"Internal server error\") {\n          _this4.props.markStaffAttendanceFail(message);\n        } else {\n          _this4.props.markTeacherLoggedOut(staff_id, time);\n        }\n      }).catch(function (err) {\n        console.log('err: ', err);\n      });\n    }\n  }, {\n    key: \"hideLoginPad\",\n    value: function hideLoginPad() {\n      this.setState({\n        logging_in: false\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this5 = this;\n\n      var errMessage = this.props.class.errMessage;\n      return React.createElement(Container, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 158,\n          columnNumber: 13\n        }\n      }, errMessage !== '' ? React.createElement(Text, {\n        style: {\n          fontSize: 20,\n          color: 'red'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 160,\n          columnNumber: 21\n        }\n      }, errMessage) : null, this.state.logging_in ? React.createElement(LoginNumberPad, {\n        handleEnterPasscode: function handleEnterPasscode(passcode) {\n          return _this5.handleEnterPasscode(passcode);\n        },\n        hideLoginPad: this.hideLoginPad,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 163,\n          columnNumber: 21\n        }\n      }) : null, React.createElement(Content, {\n        contentContainerStyle: {\n          marginTop: 30,\n          paddingBottom: 30,\n          alignSelf: 'center',\n          flexDirection: 'row'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 168,\n          columnNumber: 17\n        }\n      }, Object.keys(this.props.class.teachers).map(function (teacher_id) {\n        return React.createElement(TouchableHighlight, {\n          key: teacher_id,\n          style: {\n            margin: 20\n          },\n          underlayColor: \"transparent\",\n          onPress: function onPress() {\n            return _this5.setState({\n              logging_in: true,\n              teacher_id: teacher_id\n            });\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 171,\n            columnNumber: 29\n          }\n        }, React.createElement(View, {\n          style: styles.cardContainer,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 177,\n            columnNumber: 33\n          }\n        }, React.createElement(Card, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 178,\n            columnNumber: 37\n          }\n        }, React.createElement(CardItem, {\n          style: {\n            justifyContent: 'center'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 179,\n            columnNumber: 41\n          }\n        }, React.createElement(Image, {\n          style: styles.thumbnailImage,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 180,\n            columnNumber: 45\n          }\n        })), React.createElement(CardItem, {\n          footer: true,\n          style: {\n            justifyContent: 'center',\n            backgroundColor: _this5.props.class.teachers[teacher_id].logged_in ? '#dcf3d0' : '#ffe1d0'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 184,\n            columnNumber: 41\n          }\n        }, React.createElement(Text, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 187,\n            columnNumber: 45\n          }\n        }, _this5.props.class.teachers[teacher_id].name)))));\n      })));\n    }\n  }]);\n\n  return TeacherClockInOut;\n}(React.Component);\n\nvar styles = StyleSheet.create({\n  cardContainer: {\n    width: 119,\n    height: 150,\n    margin: 2,\n    marginBottom: -2\n  },\n  thumbnailImage: {\n    height: 80,\n    width: 80,\n    borderRadius: 40\n  }\n});\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    class: state.classInfo\n  };\n};\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n  return _objectSpread({}, bindActionCreators({\n    markTeacherLoggedIn: markTeacherLoggedIn,\n    markTeacherLoggedOut: markTeacherLoggedOut,\n    markStaffAttendanceFail: markStaffAttendanceFail,\n    fetchAttendanceSuccess: fetchAttendanceSuccess\n  }, dispatch));\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(TeacherClockInOut);","map":{"version":3,"sources":["/home/caleb_lee/gina_web_app/components/teacher/teacherclockinout.js"],"names":["React","Container","Content","Text","View","Card","CardItem","Toast","connect","LoginNumberPad","bindActionCreators","markTeacherLoggedIn","markTeacherLoggedOut","markStaffAttendanceFail","fetchAttendanceSuccess","TeacherClockInOut","props","state","logging_in","teacher_id","handleEnterPasscode","bind","hideLoginPad","fetchStaffAttendanceByClassId","class","class_id","isConnected","show","text","buttonText","position","type","duration","query","fetch","method","headers","Accept","then","res","json","resJson","data","catch","err","console","log","passcode","passcodeTeacherId","undefined","teacher","teachers","time","Date","logged_in","clockOut","clockIn","setState","staff_id","body","JSON","stringify","statusCode","message","attendance_id","errMessage","fontSize","color","marginTop","paddingBottom","alignSelf","flexDirection","Object","keys","map","margin","styles","cardContainer","justifyContent","thumbnailImage","backgroundColor","name","Component","StyleSheet","create","width","height","marginBottom","borderRadius","mapStateToProps","classInfo","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { StyleSheet, Image, TouchableHighlight } from 'react-native'\nimport { Container, Content, Text, View, Card, CardItem, Toast } from 'native-base'\nimport { connect } from 'react-redux'\nimport LoginNumberPad from './loginnumberpad'\nimport { bindActionCreators } from 'redux';\nimport { markTeacherLoggedIn, markTeacherLoggedOut, markStaffAttendanceFail, fetchAttendanceSuccess } from '../../redux/school/actions/index'\n\nclass TeacherClockInOut extends React.Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            logging_in: false,\n            teacher_id: ''\n        }\n        this.handleEnterPasscode = this.handleEnterPasscode.bind(this)\n        this.hideLoginPad = this.hideLoginPad.bind(this)\n    }\n\n    componentDidMount() {\n        this.fetchStaffAttendanceByClassId()\n    }\n\n    fetchStaffAttendanceByClassId() {\n        const { class_id, isConnected } = this.props.class\n        if (!isConnected) {\n            Toast.show({\n                text: '拍謝 網路連不到! 等一下再試試看',\n                buttonText: 'Okay',\n                position: \"top\",\n                type: \"warning\",\n                duration: 5000\n            })\n            return\n        }\n        const query = `https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/dev/staff-attendance?class_id=${class_id}`\n        fetch(query, {\n            method: 'GET',\n            headers: {\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            }\n        })\n            .then(res => res.json())\n            .then(resJson => {\n                this.props.fetchAttendanceSuccess(resJson.data)\n            })\n            .catch(err => {\n                console.log('err: ', err)\n            })\n\n    }\n\n    handleEnterPasscode(passcode) {\n        const teacher_id = this.props.class.passcodeTeacherId[passcode]\n        if (teacher_id === undefined || teacher_id !== this.state.teacher_id) {\n            Toast.show({\n                text: 'Wrong password!',\n                buttonText: 'Okay',\n                position: \"top\",\n                type: \"warning\",\n                duration: 3000\n            })\n        } else {\n            const teacher = this.props.class.teachers[teacher_id]\n            const time = new Date()\n            if (teacher.logged_in) {\n                this.clockOut(teacher_id, time)\n            } else {\n                this.clockIn(teacher_id, time)\n            }\n            this.setState({ logging_in: false })\n        }\n        \n    }\n\n    clockIn(staff_id, time) {\n        const { isConnected } = this.props.class\n        if (!isConnected) {\n            Toast.show({\n                text: '拍謝 網路連不到! 等一下再試試看',\n                buttonText: 'Okay',\n                position: \"top\",\n                type: \"warning\",\n                duration: 5000\n            })\n            return\n        }\n        const query = `https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/dev/staff-attendance`\n        fetch(query, {\n            method: 'POST',\n            headers: {\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                staff_id\n            })\n        })\n            .then(res => res.json())\n            .then(resJson => {\n                const { statusCode, message, data } = resJson\n                if ( statusCode > 200 || resJson[\"message\"] === \"Internal server error\") {\n                    this.props.markStaffAttendanceFail(message)\n                } else {\n                    this.props.markTeacherLoggedIn(staff_id, time, data.attendance_id)\n                }\n            })\n            .catch(err => {\n                console.log('err: ', err)\n            })\n    }\n\n    clockOut(staff_id, time) {\n        const { isConnected } = this.props.class\n        if (!isConnected) {\n            Toast.show({\n                text: '拍謝 網路連不到! 等一下再試試看',\n                buttonText: 'Okay',\n                position: \"top\",\n                type: \"warning\",\n                duration: 5000\n            })\n            return\n        }\n\n        const { attendance_id } = this.props.class.teachers[staff_id]\n        const query = `https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/dev/staff-attendance/${attendance_id}`\n        fetch(query, {\n            method: 'PUT',\n            headers: {\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            }\n        })\n            .then(res => res.json())\n            .then(resJson => {\n                const { statusCode, message } = resJson\n                if (statusCode > 200 || message === \"Internal server error\") {\n                    this.props.markStaffAttendanceFail(message)\n                }\n                else {\n                    this.props.markTeacherLoggedOut(staff_id, time)\n                }\n            })\n            .catch(err => {\n                console.log('err: ', err)\n            })\n    }\n\n    hideLoginPad() {\n        this.setState({ logging_in: false })\n    }\n\n    render() {\n        const { errMessage } = this.props.class\n        return(\n            <Container>\n                {errMessage !== '' ?    \n                    <Text style={{ fontSize: 20, color: 'red' }}>{errMessage}</Text>\n                    : null}\n                {this.state.logging_in ?\n                    <LoginNumberPad\n                        handleEnterPasscode={(passcode) => this.handleEnterPasscode(passcode)}\n                        hideLoginPad={this.hideLoginPad}\n                    /> : null}\n                        \n                <Content contentContainerStyle={{ marginTop: 30, paddingBottom: 30, alignSelf: 'center', flexDirection: 'row' }}>\n                    {Object.keys(this.props.class.teachers).map((teacher_id) => {\n                        return (\n                            <TouchableHighlight\n                                key={teacher_id}\n                                style={{ margin: 20 }}\n                                underlayColor='transparent'\n                                onPress={() => this.setState({ logging_in: true, teacher_id: teacher_id})}\n                            >\n                                <View style={styles.cardContainer}>\n                                    <Card>\n                                        <CardItem style={{ justifyContent: 'center' }}>\n                                            <Image\n                                                // source={{ uri: this.props.class.students[student_id].profile_picture }}\n                                                style={styles.thumbnailImage}/>\n                                        </CardItem>\n                                        <CardItem\n                                            footer\n                                            style={{ justifyContent: 'center', backgroundColor: this.props.class.teachers[teacher_id].logged_in ? '#dcf3d0' : '#ffe1d0' }}>\n                                            <Text>{this.props.class.teachers[teacher_id].name}</Text>\n                                        </CardItem>\n                                    </Card>\n                                </View>\n                            </TouchableHighlight>\n                        )\n                    })}\n                </Content>\n            </Container>\n        )\n    }\n}\n\nconst styles = StyleSheet.create({\n    cardContainer: {\n        width: 119,\n        height: 150,\n        margin: 2,\n        marginBottom: -2\n    },\n    thumbnailImage: {\n        height: 80,\n        width: 80,\n        borderRadius: 40\n    }\n})\n\nconst mapStateToProps = (state) => {\n    return {\n        class: state.classInfo\n    }\n}\n\nconst mapDispatchToProps = (dispatch) => {\n    return {\n        ...bindActionCreators({markTeacherLoggedIn, markTeacherLoggedOut, markStaffAttendanceFail, fetchAttendanceSuccess}, dispatch)\n    }\n}\nexport default connect(mapStateToProps, mapDispatchToProps) (TeacherClockInOut)"]},"metadata":{},"sourceType":"module"}