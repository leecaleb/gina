{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _inherits from\"@babel/runtime/helpers/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import React from'react';import View from\"react-native-web/dist/exports/View\";import TextInput from\"react-native-web/dist/exports/TextInput\";import TouchableHighlight from\"react-native-web/dist/exports/TouchableHighlight\";import Text from\"react-native-web/dist/exports/Text\";import Alert from\"react-native-web/dist/exports/Alert\";import KeyboardAvoidingView from\"react-native-web/dist/exports/KeyboardAvoidingView\";import Reloading from\"../../reloading\";import{connect}from'react-redux';import{bindActionCreators}from'redux';import RegisterNewStudents from\"./registernewstudents\";import RegisterParents from\"./registerparents\";import{ScrollView}from'react-native-gesture-handler';import{fetchStudentsSuccess}from\"../../../redux/school/actions/index\";import{get}from\"../../util\";var Registration=function(_React$Component){_inherits(Registration,_React$Component);var _super=_createSuper(Registration);function Registration(props){var _this;_classCallCheck(this,Registration);_this=_super.call(this,props);_this.state={parentSignUpStatus:[false],createFamilyProfileStatus:'not_created'};return _this;}_createClass(Registration,[{key:\"componentDidMount\",value:function componentDidMount(){}},{key:\"createFamilyProfile\",value:function createFamilyProfile(){var _this2=this;var all_parents_signed_up=true;var parentSignUpStatus=this.refs['parent'].getParentSignUpStatus();parentSignUpStatus.forEach(function(status){all_parents_signed_up&=status;});if(!all_parents_signed_up){alert('Error! We cannot create family profile until all parents have been signed up');return;}var parentDataArray=this.refs['parent'].getParentDataArray();var studentDataArray=this.refs['student'].getStudentDataArray();this.setState({createFamilyProfileStatus:'creating'});fetch('https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/dev/family/',{method:'POST',headers:{Accept:'application/json','Content-Type':'application/json'},body:JSON.stringify({parentDataArray:parentDataArray,studentDataArray:studentDataArray})}).then(function(response){return response.json();}).then(function(resJson){if(resJson.statusCode>200||resJson.message==='Internal server error'){alert('Error!'+resJson.message);}else{_this2.fetchStudentData();Alert.alert('註冊成功!','點選OK以離開頁面',[{text:'OK',onPress:function onPress(){return _this2.props.navigation.goBack();}}]);_this2.setState({createFamilyProfileStatus:'created'});}}).catch(function(err){console.error(err);});}},{key:\"fetchStudentData\",value:function fetchStudentData(){var school_id,response,success,statusCode,message,data,students,classes;return _regeneratorRuntime.async(function fetchStudentData$(_context){while(1){switch(_context.prev=_context.next){case 0:school_id=this.props.route.params.school_id;_context.next=3;return _regeneratorRuntime.awrap(get(\"/school/\"+school_id+\"/student\"));case 3:response=_context.sent;success=response.success,statusCode=response.statusCode,message=response.message,data=response.data;if(success){_context.next=8;break;}alert('Sorry 取得學生資料時電腦出狀況了！請截圖和與工程師聯繫\\n\\n'+message);return _context.abrupt(\"return\");case 8:students=data.students,classes=data.classes;this.props.fetchStudentsSuccess(students,classes);case 10:case\"end\":return _context.stop();}}},null,this,null,Promise);}},{key:\"render\",value:function render(){var _this3=this;var _this$state=this.state,studentDataArray=_this$state.studentDataArray,parentDataArray=_this$state.parentDataArray,parentSignUpStatus=_this$state.parentSignUpStatus,createFamilyProfileStatus=_this$state.createFamilyProfileStatus;return React.createElement(KeyboardAvoidingView,{style:{flex:1,justifyContent:'center',alignItems:'center'}},React.createElement(ScrollView,{style:{width:'100%'}},React.createElement(RegisterNewStudents,{ref:\"student\",classes:this.props.classes}),React.createElement(RegisterParents,{ref:\"parent\"}),React.createElement(View,{style:{flex:1,flexDirection:'row',justifyContent:'space-around'}},React.createElement(TouchableHighlight,{style:{flex:1,padding:20,backgroundColor:createFamilyProfileStatus==='not_created'?'#b5e9e9':createFamilyProfileStatus==='creating'?'#b5e9e9':'#00c07f',justifyContent:'center'},onPress:function onPress(){return _this3.createFamilyProfile();}},createFamilyProfileStatus==='not_created'?React.createElement(Text,{style:{fontSize:50,textAlign:'center'}},\"\\u5B8C\\u6210\"):createFamilyProfileStatus==='creating'?React.createElement(Reloading,null):React.createElement(Text,{style:{fontSize:50}},\"SUCCESS\")),React.createElement(TouchableHighlight,{style:{flex:1,padding:20,backgroundColor:'#fa625f',justifyContent:'center'},onPress:function onPress(){return _this3.props.navigation.goBack();}},React.createElement(Text,{style:{fontSize:50,textAlign:'center'}},\"\\u8FD4\\u56DE\")))));}}]);return Registration;}(React.Component);var mapStateToProps=function mapStateToProps(state){return{classes:state.school.classes};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return _objectSpread({},bindActionCreators({fetchStudentsSuccess:fetchStudentsSuccess},dispatch));};export default connect(mapStateToProps,mapDispatchToProps)(Registration);","map":{"version":3,"sources":["/home/caleb_lee/gina_web_app/components/teacher/admin/registration.js"],"names":["React","Reloading","connect","bindActionCreators","RegisterNewStudents","RegisterParents","ScrollView","fetchStudentsSuccess","get","Registration","props","state","parentSignUpStatus","createFamilyProfileStatus","all_parents_signed_up","refs","getParentSignUpStatus","forEach","status","alert","parentDataArray","getParentDataArray","studentDataArray","getStudentDataArray","setState","fetch","method","headers","Accept","body","JSON","stringify","then","response","json","resJson","statusCode","message","fetchStudentData","Alert","text","onPress","navigation","goBack","catch","err","console","error","school_id","route","params","success","data","students","classes","flex","justifyContent","alignItems","width","flexDirection","padding","backgroundColor","createFamilyProfile","fontSize","textAlign","Component","mapStateToProps","school","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { View, TextInput, TouchableHighlight, Text, Alert, KeyboardAvoidingView } from 'react-native'\n// import Auth from '@aws-amplify/auth'\nimport Reloading from '../../reloading'\nimport { connect } from 'react-redux'\nimport { bindActionCreators } from 'redux'\nimport RegisterNewStudents from './registernewstudents'\nimport RegisterParents from './registerparents'\nimport { ScrollView } from 'react-native-gesture-handler'\nimport { fetchStudentsSuccess } from '../../../redux/school/actions/index'\nimport { get } from '../../util'\n\n/*\n1. Page where we connect parents to amplify for their login:\n  Auth.signUp({\n    username: 'USERNAME',\n    password: 'PASSWORD',\n    attributes: {\n        given_name: 'John',\n        family_name: 'Smith',\n        email: 'EMAIL@email.com'\n    }\n  })\n\n2. Save their credential in database in table users:\n  -id: 'UUID',\n  -firstName: 'John',\n  -lastName: 'Smith',\n  -email: 'EMAIL@email.com',\n  -username: 'USERNAME',\n  -role: 'parent'\n\n3. And initialize child/ren's data in database including but not limited to \n  -first_name,\n  -last_name,\n  -profile_picture,\n  -class_id <<====== list all classes and assign a class_id to child/ren\n\n****Leave sign up confirmation to parent side of the app(first time sign in)****\n\n*/\nclass Registration extends React.Component{\n  constructor(props) {\n    super(props)\n    this.state = {\n      \n      \n      parentSignUpStatus: [false],\n      createFamilyProfileStatus: 'not_created'\n    }\n  }\n\n  componentDidMount() {\n    //  fetch class info for class assinment or get it from redux store\n  }\n\n  \n\n  createFamilyProfile() {\n    let all_parents_signed_up = true\n    let parentSignUpStatus = this.refs['parent'].getParentSignUpStatus()\n    parentSignUpStatus.forEach(status => {\n      all_parents_signed_up &= status\n    })\n\n    if (!all_parents_signed_up) {\n      alert('Error! We cannot create family profile until all parents have been signed up')\n      return\n    }\n\n    let parentDataArray = this.refs['parent'].getParentDataArray()\n    let studentDataArray = this.refs['student'].getStudentDataArray()\n\n    this.setState({\n      createFamilyProfileStatus: 'creating'\n    })\n\n    fetch('https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/dev/family/', {\n      method: 'POST',\n      headers: {\n          Accept: 'application/json',\n          'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        parentDataArray,  //name, email, username, role\n        studentDataArray  //name, class_id, profile_picture, blood_type\n      })\n    })\n    .then((response) => response.json())\n    .then((resJson) => {\n      // console.log(resJson)\n      if (resJson.statusCode > 200 || resJson.message === 'Internal server error') {\n        alert('Error!' + resJson.message)\n      } else {\n        this.fetchStudentData()\n        Alert.alert(\n          '註冊成功!',\n          '點選OK以離開頁面',\n          [\n              { text: 'OK', onPress: () => this.props.navigation.goBack()}\n          ]\n        )\n        this.setState({\n          createFamilyProfileStatus: 'created'\n        })\n      }\n    })\n    .catch((err) => {\n      console.error(err)\n    })\n  }\n\n  async fetchStudentData() {\n    const { school_id } = this.props.route.params\n    const response = await get(`/school/${school_id}/student`)\n    const { success, statusCode, message, data } = response\n    if (!success) {\n        alert('Sorry 取得學生資料時電腦出狀況了！請截圖和與工程師聯繫\\n\\n' + message)\n        return \n    }\n\n    const {students, classes} = data\n    this.props.fetchStudentsSuccess(students, classes)\n  }\n\n  render() {\n    const { studentDataArray, parentDataArray, parentSignUpStatus, createFamilyProfileStatus } = this.state\n    // console.log(this.props.classes)\n    return (\n      <KeyboardAvoidingView style={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}>\n        <ScrollView style={{ width: '100%'}}>\n\n          <RegisterNewStudents \n            ref=\"student\"\n            classes={this.props.classes}\n          />\n\n          <RegisterParents ref=\"parent\" />\n\n          <View style={{ flex: 1, flexDirection: 'row', justifyContent: 'space-around' }}>\n            <TouchableHighlight\n              style={{\n                flex: 1,\n                padding: 20,\n                backgroundColor: createFamilyProfileStatus === 'not_created' ?\n                  '#b5e9e9'\n                  : createFamilyProfileStatus === 'creating' ?\n                    '#b5e9e9'\n                  : '#00c07f',\n                  justifyContent: 'center'\n              }}\n              onPress={() => this.createFamilyProfile()}\n            >\n              {createFamilyProfileStatus === 'not_created' ?\n                <Text style={{ fontSize: 50, textAlign: 'center' }}>完成</Text>\n                : createFamilyProfileStatus === 'creating' ?\n                  <Reloading />\n                : <Text style={{ fontSize: 50 }}>SUCCESS</Text>\n              }\n            </TouchableHighlight>\n\n            <TouchableHighlight\n              style={{ flex:1, padding: 20, backgroundColor: '#fa625f', justifyContent: 'center' }}\n              onPress={() => this.props.navigation.goBack()}\n            >\n              <Text style={{ fontSize: 50, textAlign: 'center'}}>返回</Text>\n            </TouchableHighlight>\n          </View>\n        </ScrollView>\n      </KeyboardAvoidingView>\n    )\n  }\n}\n\nconst mapStateToProps = (state) => {\n  return {\n    classes: state.school.classes\n  }\n}\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    ...bindActionCreators({fetchStudentsSuccess}, dispatch)\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps) (Registration)"]},"metadata":{},"sourceType":"module"}