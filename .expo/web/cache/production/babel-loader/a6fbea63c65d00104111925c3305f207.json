{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _assertThisInitialized from\"@babel/runtime/helpers/assertThisInitialized\";import _inherits from\"@babel/runtime/helpers/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import React from'react';import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import ScrollView from\"react-native-web/dist/exports/ScrollView\";import View from\"react-native-web/dist/exports/View\";import Text from\"react-native-web/dist/exports/Text\";import RefreshControl from\"react-native-web/dist/exports/RefreshControl\";import TouchableOpacity from\"react-native-web/dist/exports/TouchableOpacity\";import Alert from\"react-native-web/dist/exports/Alert\";import Dimensions from\"react-native-web/dist/exports/Dimensions\";import AppState from\"react-native-web/dist/exports/AppState\";import Image from\"react-native-web/dist/exports/Image\";import KeyboardAvoidingView from\"react-native-web/dist/exports/KeyboardAvoidingView\";import Platform from\"react-native-web/dist/exports/Platform\";import{connect}from'react-redux';import{bindActionCreators}from'redux';import{setConnectState,initializeChildren,markPresent,clearState}from\"../../redux/parent/actions/index\";import Reloading from\"../reloading\";import WellnessCard from\"./wellnesscard\";import AppetiteCard from\"./appetitecard\";import MilkCard from\"./milkcard\";import SleepCard from\"./sleepcard\";import RestroomCard from\"./restroomcard\";import MessageCard from\"./messagecard\";import ParentHomeTitle from\"./parenthometitle\";import ProfileSelector from\"./profileselector\";import QRPage from\"./qrpage\";import{formatDate,beautifyDate,beautifyTime,get}from\"../util\";import MedicationRequestCard from\"./medicinerequestcard\";import TimeModal from\"./timemodal\";import MorningReminderCard from\"./morningremindercard\";import ENV from\"../../variables\";var _Dimensions$get=Dimensions.get('window'),width=_Dimensions$get.width;var ParentHome=function(_React$Component){_inherits(ParentHome,_React$Component);var _super=_createSuper(ParentHome);function ParentHome(props){var _this;_classCallCheck(this,ParentHome);_this=_super.call(this,props);_this.timer=function(){return setTimeout(function(){_this.poll(_this.state.child_id);},10000);};_this._handleAppStateChange=function(nextAppState){if(_this.state.appState.match(/inactive|background/)&&nextAppState===\"active\"){_this.checkStudentAttendance(_this.state.child_id);if(_this.state.date.toDateString()!==new Date().toDateString()&&new Date().getHours()>3){_this.initializeChildren();}}_this.setState({appState:nextAppState});};_this.state={date:new Date(),child_id:'',student_id_array:[],message:'',refreshing:false,showQR:false,temperature:'',appState:'',showDateTimeModal:false,present:false,showTimeModal:false};_this.initializeChildren=_this.initializeChildren.bind(_assertThisInitialized(_this));return _this;}_createClass(ParentHome,[{key:\"poll\",value:function poll(student_id){var _this2=this;var query;return _regeneratorRuntime.async(function poll$(_context){while(1){switch(_context.prev=_context.next){case 0:query=\"https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/\"+ENV+\"/family/updates?student_id=\"+student_id;_context.next=3;return _regeneratorRuntime.awrap(fetch(query,{method:'GET',headers:{Accept:'application/json','Content-Type':'application/json'}}).then(function(res){return res.json();}).then(function(resJson){var update_types=resJson.data;update_types.forEach(function(update_type){_this2.refs[update_type].fetchData(student_id,new Date(_this2.state.date));});}).catch(function(err){console.log('polling error: ',err);}));case 3:this.timeoutId=this.timer();case 4:case\"end\":return _context.stop();}}},null,this,null,Promise);}},{key:\"componentDidMount\",value:function componentDidMount(){var _this3=this;window.addEventListener('offline',function(e){_this3.props.setConnectState(false);});window.addEventListener('online',function(e){_this3.props.setConnectState(true);});this.initializeChildren();this.timeoutId=this.timer();AppState.addEventListener(\"change\",this._handleAppStateChange);}},{key:\"setDate\",value:function setDate(){var date=new Date();if(date.getDay()===6){date.setDate(date.getDate()-1);}else if(date.getDay()===0){date.setDate(date.getDate()-2);}this.selectDatetimeConfirm(date);}},{key:\"isIOS\",value:function isIOS(){return Platform.OS==='ios';}},{key:\"initializeChildren\",value:function initializeChildren(){var _this4=this;var parent_id=this.props.route.params.parent_id;fetch(\"https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/\"+ENV+\"/family/\"+parent_id,{method:'GET',headers:{Accept:'application/json','Content-Type':'application/json'}}).then(function(res){return res.json();}).then(function(resJson){var statusCode=resJson.statusCode,message=resJson.message,data=resJson.data;if(statusCode>200||message==='Internal server error'){alert('Sorry 電腦出狀況了！請截圖和與工程師聯繫'+message);return;}_this4.props.initializeChildren(data);var student_id_array=Object.keys(_this4.props.parent.child_of_id);_this4.setState({child_id:student_id_array[0],student_id_array:student_id_array});_this4.setDate();}).catch(function(err){alert('Sorry 電腦出狀況了！請截圖和與工程師聯繫: error occurred when initializing student profiles');});}},{key:\"checkStudentAttendance\",value:function checkStudentAttendance(student_id){var date,response,success,statusCode,message,data,in_time,out_time,excuse_type,_date;return _regeneratorRuntime.async(function checkStudentAttendance$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(this.state.date.toDateString()!==new Date().toDateString())){_context2.next=2;break;}return _context2.abrupt(\"return\");case 2:date=new Date();_context2.next=5;return _regeneratorRuntime.awrap(get(\"/attendance/\"+student_id+\"?date=\"+formatDate(date)));case 5:response=_context2.sent;success=response.success,statusCode=response.statusCode,message=response.message,data=response.data;if(success){in_time=data.in_time,out_time=data.out_time,excuse_type=data.excuse_type;if(in_time!==null&&out_time!==null||excuse_type!==null){_date=new Date();_date.setHours(18,0,0,0);this.setState({date:_date});}}case 8:case\"end\":return _context2.stop();}}},null,this,null,Promise);}},{key:\"onSelectStudent\",value:function onSelectStudent(child_id){this.setState({child_id:child_id});}},{key:\"markPresent\",value:function markPresent(temperature){var date=this.state.date;this.setState({temperature:temperature,present:temperature!==''});}},{key:\"selectDatetimeConfirm\",value:function selectDatetimeConfirm(date){var _this5=this;var threshold=new Date();threshold.setHours(0,0,0,0);if(date.getTime()<threshold.getTime()){date.setHours(18);}else if(date.toDateString()===new Date().toDateString()){date.setTime(new Date());}else{date.setHours(16,0,0);}this.setState({date:date,showDateTimeModal:false},function(){return _this5.checkStudentAttendance(_this5.state.child_id);});}},{key:\"getDayDifference\",value:function getDayDifference(startDate,endDate){var start=new Date(startDate);var end=new Date(endDate);start.setHours(0);end.setHours(0);var oneDay=24*60*60*1000;return Math.round((end-start)/oneDay);}},{key:\"goBackADay\",value:function goBackADay(){var date=new Date(this.state.date.getTime());if(date.getDay()===1){date.setDate(date.getDate()-3);}else{date.setDate(date.getDate()-1);}this.selectDatetimeConfirm(date);}},{key:\"goForwardADay\",value:function goForwardADay(){var date=new Date(this.state.date.getTime());if(date.getDay()===5){date.setDate(date.getDate()+3);}else{date.setDate(date.getDate()+1);}this.selectDatetimeConfirm(date);}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){clearTimeout(this.timeoutId);AppState.removeEventListener(\"change\",this._handleAppStateChange);this.props.clearState();}},{key:\"render\",value:function render(){var _this6=this;var parent_id=this.props.route.params.parent_id;var isConnected=this.props.isConnected;var _this$state=this.state,date=_this$state.date,child_id=_this$state.child_id,showQR=_this$state.showQR,temperature=_this$state.temperature,showDateTimeModal=_this$state.showDateTimeModal,present=_this$state.present,showTimeModal=_this$state.showTimeModal;if(child_id===''){return React.createElement(Reloading,null);}var selected_student=this.props.parent.child_of_id[child_id];var day_difference=this.getDayDifference(date,new Date());return React.createElement(KeyboardAvoidingView,{enabled:true,behavior:\"padding\",keyboardVerticalOffset:100,style:{flex:1,zIndex:1}},React.createElement(ProfileSelector,{ref:\"profile_selector\",student_of_id:this.props.parent.child_of_id,onSelectStudent:function onSelectStudent(student_id){return _this6.onSelectStudent(student_id);}}),showQR?React.createElement(QRPage,{hideQRCode:function hideQRCode(){return _this6.setState({showQR:false});},parent_id:parent_id}):null,showDateTimeModal?React.createElement(TimeModal,{start_date:date,datetime_type:'date',hideModal:function hideModal(){return _this6.setState({showDateTimeModal:false});},selectDatetimeConfirm:function selectDatetimeConfirm(datetime){return _this6.selectDatetimeConfirm(datetime);},minDatetime:new Date().setDate(new Date().getDate()-7),maxDatetime:new Date().setDate(new Date().getDate()+1),paddingVertical:100}):null,showTimeModal&&React.createElement(TimeModal,{start_date:new Date(),datetime_type:'time',hideModal:function hideModal(){return _this6.setState({showTimeModal:false});},selectDatetimeConfirm:function selectDatetimeConfirm(time){return _this6.refs['morningreminder'].selectDatetimeConfirm(time);},minDatetime:null,maxDatetime:null,minTime:null,maxTime:null,paddingVertical:400}),React.createElement(ScrollView,{contentContainerStyle:{alignItems:'center',justifyContent:'center',paddingBottom:30},refreshControl:React.createElement(RefreshControl,{style:{backgroundColor:'transparent'},refreshing:this.state.refreshing,onRefresh:this.initializeChildren,tintColor:\"#ff8944\",title:\"Loading...\",titleColor:\"#368cbf\",colors:['#ff8944','#368cbf','#0000ff'],progressBackgroundColor:\"#ffff00\"})},React.createElement(View,{style:{width:'100%',flexDirection:'row',backgroundColor:'white'}},React.createElement(View,{style:{width:'15%'}},day_difference<7?React.createElement(TouchableOpacity,{style:{flex:1,justifyContent:'center',alignItems:'center'},onClick:function onClick(){return _this6.goBackADay();}},React.createElement(Image,{source:require(\"../../assets/icon-back.png\"),style:{width:40,height:40}})):null),React.createElement(TouchableOpacity,{style:{width:'70%',justifyContent:'center'},onClick:function onClick(){return _this6.setState({showDateTimeModal:true});}},React.createElement(Text,{style:{fontSize:width*0.12,textAlign:'center'}},beautifyDate(date))),React.createElement(View,{style:{width:'15%'}},day_difference>=0?React.createElement(TouchableOpacity,{style:{flex:1,justifyContent:'center',alignItems:'center'},onClick:function onClick(){return _this6.goForwardADay();}},React.createElement(Image,{source:require(\"../../assets/icon-forward.png\"),style:{width:40,height:40}})):null)),React.createElement(ParentHomeTitle,{student:selected_student,students:this.props.parent.child_of_id,student_name:this.props.parent.child_of_id[child_id].name,selectOtherChildProfile:function selectOtherChildProfile(){return _this6.refs['profile_selector'].slideIn();},viewQRCode:function viewQRCode(){return _this6.setState({showQR:true});},temperature:temperature}),React.createElement(View,{style:{flex:1,width:'93%',flexDirection:'row',justifyContent:'space-between',marginVertical:5}},React.createElement(TouchableOpacity,{style:{width:'30%',padding:10,backgroundColor:'#ffe1d0'},onClick:function onClick(){return _this6.props.navigation.navigate('PickupRequest',{child_id:child_id,school_id:selected_student.school_id});}},React.createElement(Text,{style:{fontSize:width*0.05,textAlign:'center'}},\"\\u63A5\\u56DE\\u544A\\u77E5\")),React.createElement(TouchableOpacity,{style:{width:'30%',padding:10,backgroundColor:'#fff1b5'},onClick:function onClick(){return _this6.props.navigation.push('MedicationRequestPage',{onGoBack:function onGoBack(){return _this6.refs['med_request'].fetchData(child_id,new Date());},student_id:child_id,class_id:selected_student.class_id});}},React.createElement(Text,{style:{fontSize:width*0.05,textAlign:'center'}},\"\\u6258\\u85E5\\u55AE\")),React.createElement(TouchableOpacity,{style:{width:'30%',padding:10,backgroundColor:'#b5e9e9'},onClick:function onClick(){return _this6.props.navigation.navigate('AbsenceExcusePage',{student_id:child_id,class_id:selected_student.class_id===null?\"\":selected_student.class_id,school_id:selected_student.school_id});}},React.createElement(Text,{style:{fontSize:width*0.05,textAlign:'center'}},\"\\u8ACB\\u5047\\u55AE\"))),React.createElement(MorningReminderCard,{child_id:child_id,date:date,class_id:selected_student.class_id,ref:\"morningreminder\",present:present,isConnected:isConnected,parent_id:parent_id,showTimeModal:function showTimeModal(){return _this6.setState({showTimeModal:true});}}),React.createElement(MedicationRequestCard,{child_id:child_id,date:date,ref:\"med_request\",viewMedRequest:function viewMedRequest(index,data){return _this6.props.navigation.push('AddMedicationRequestPage',{onGoBack:function onGoBack(){return _this6.refs['med_request'].fetchData(child_id,new Date());},student_id:child_id,class_id:selected_student.class_id===null?\"\":selected_student.class_id,index:index,data:data});}}),React.createElement(WellnessCard,{child_id:child_id,date:date,ref:\"wellness\",updateTitleTemp:function updateTitleTemp(temperature){return _this6.markPresent(temperature);}}),React.createElement(MessageCard,{child_id:child_id,date:date,class_id:selected_student.class_id,ref:\"messages\",parent_id:parent_id}),React.createElement(AppetiteCard,{child_id:child_id,date:date,ref:\"appetite\"}),React.createElement(MilkCard,{child_id:child_id,date:date,ref:\"milkintake\"}),React.createElement(SleepCard,{child_id:child_id,date:date,ref:\"sleep\"}),React.createElement(RestroomCard,{child_id:child_id,date:date,ref:\"diaper\"})));}}]);return ParentHome;}(React.Component);var styles=StyleSheet.create({button_text:{fontSize:18,textAlign:'center'},button:{width:'30%',padding:20,justifyContent:'center'}});var mapStateToProps=function mapStateToProps(state){return{parent:state.parent,isConnected:state.parent.isConnected};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return _objectSpread({},bindActionCreators({setConnectState:setConnectState,initializeChildren:initializeChildren,markPresent:markPresent,clearState:clearState},dispatch));};export default connect(mapStateToProps,mapDispatchToProps)(ParentHome);","map":{"version":3,"sources":["/home/caleb_lee/gina_web_app/components/parent/parenthome.js"],"names":["React","connect","bindActionCreators","setConnectState","initializeChildren","markPresent","clearState","Reloading","WellnessCard","AppetiteCard","MilkCard","SleepCard","RestroomCard","MessageCard","ParentHomeTitle","ProfileSelector","QRPage","formatDate","beautifyDate","beautifyTime","get","MedicationRequestCard","TimeModal","MorningReminderCard","ENV","Dimensions","width","ParentHome","props","timer","setTimeout","poll","state","child_id","_handleAppStateChange","nextAppState","appState","match","checkStudentAttendance","date","toDateString","Date","getHours","setState","student_id_array","message","refreshing","showQR","temperature","showDateTimeModal","present","showTimeModal","bind","student_id","query","fetch","method","headers","Accept","then","res","json","resJson","update_types","data","forEach","update_type","refs","fetchData","catch","err","console","log","timeoutId","window","addEventListener","e","AppState","getDay","setDate","getDate","selectDatetimeConfirm","Platform","OS","parent_id","route","params","statusCode","alert","Object","keys","parent","child_of_id","response","success","in_time","out_time","excuse_type","setHours","threshold","getTime","setTime","startDate","endDate","start","end","oneDay","Math","round","clearTimeout","removeEventListener","isConnected","selected_student","day_difference","getDayDifference","flex","zIndex","onSelectStudent","datetime","time","alignItems","justifyContent","paddingBottom","backgroundColor","flexDirection","goBackADay","require","height","fontSize","textAlign","goForwardADay","name","slideIn","marginVertical","padding","navigation","navigate","school_id","push","onGoBack","class_id","index","Component","styles","StyleSheet","create","button_text","button","mapStateToProps","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { StyleSheet, ScrollView, View, Text, RefreshControl, TouchableOpacity,\n    Alert, Dimensions, AppState,Image, KeyboardAvoidingView, Platform } from 'react-native'\nimport { connect } from 'react-redux'\nimport { bindActionCreators } from 'redux'\nimport { setConnectState, initializeChildren, markPresent, clearState } from '../../redux/parent/actions/index'\nimport Reloading from '../reloading'\nimport WellnessCard from './wellnesscard';\nimport AppetiteCard from './appetitecard';\nimport MilkCard from './milkcard';\nimport SleepCard from './sleepcard';\nimport RestroomCard from './restroomcard';\nimport MessageCard from './messagecard'\nimport ParentHomeTitle from './parenthometitle'\nimport ProfileSelector from './profileselector'\nimport QRPage from './qrpage'\nimport { formatDate, beautifyDate, beautifyTime, get } from '../util'\nimport MedicationRequestCard from './medicinerequestcard'\nimport TimeModal from './timemodal'\nimport MorningReminderCard from './morningremindercard'\nimport ENV from '../../variables'\nconst { width } = Dimensions.get('window')\n\nclass ParentHome extends React.Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            date: new Date(),\n            child_id: '',\n            student_id_array: [],\n            message: '',\n            refreshing: false,\n            showQR: false,\n            temperature: '',\n            appState: '',\n            showDateTimeModal: false,\n            present: false,\n            showTimeModal: false\n        }\n        this.initializeChildren = this.initializeChildren.bind(this)\n    }\n\n    timer = () => setTimeout(() => {\n        this.poll(this.state.child_id)\n    }, 10000)\n\n    async poll(student_id) {\n        const query = `https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/${ENV}/family/updates?student_id=${student_id}`\n        await fetch(query, {\n            method: 'GET',\n            headers: {\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            }\n        })\n            .then(res => res.json())\n            .then(resJson => {\n                // console.log('parenthome/poll: ')\n                const update_types = resJson.data\n                update_types.forEach(update_type => {\n                    // console.log(update_type)\n                    this.refs[update_type].fetchData(student_id, new Date(this.state.date))\n                })  \n            })\n            .catch(err => {\n                console.log('polling error: ', err)\n            })\n        this.timeoutId = this.timer()\n    }\n\n    componentDidMount() {\n        // this.setDate()\n        window.addEventListener('offline', (e) => {\n            // console.log('offline ', e)\n            this.props.setConnectState(false) \n        });\n        window.addEventListener('online', (e) => {\n            // console.log('online ', e)\n            this.props.setConnectState(true)\n        });\n        this.initializeChildren()\n        this.timeoutId = this.timer()\n        AppState.addEventListener(\"change\", this._handleAppStateChange);\n    }\n\n    // // SPECIAL DAY QUICK TEMP FIX\n    // isSpecialDate(date) {\n    //     const special_date = new Date()\n    //     special_date.setMonth(5,20)\n    //     return date.toDateString() === special_date.toDateString()\n    // }\n    \n    // goBackADay() {\n    //     const date = new Date(this.state.date.getTime())\n    //     const special_date = new Date()\n    //     special_date.setMonth(5,22)\n    //     if (date.getDay() === 1 && (date.toDateString() !== special_date.toDateString())) {\n    //         date.setDate(date.getDate() - 3)\n    //     } else if (date.toDateString() === special_date.toDateString()) {\n    //         date.setDate(date.getDate() - 2)\n    //     } else {\n    //         date.setDate(date.getDate() - 1)\n    //     }\n    //     this.selectDatetimeConfirm(date)\n    // }\n\n    // goForwardADay() {\n    //     const date = new Date(this.state.date.getTime())\n    //     if (date.getDay() === 5 && !this.tomorrowHasClass()) {\n    //         date.setDate(date.getDate() + 3)\n    //     } else if (date.getDay() === 6 && this.isSpecialDate(date)) {\n    //         date.setDate(date.getDate() + 2)\n    //     } else {\n    //         date.setDate(date.getDate() + 1)\n    //     }\n    //     this.selectDatetimeConfirm(date)\n    // }\n\n    // tomorrowHasClass() {\n    //     const date = new Date(this.state.date)\n    //     date.setDate(date.getDate() + 1)\n    //     const special_date = new Date()\n    //     special_date.setMonth(5, 20)\n    //     if (date.toDateString() === special_date.toDateString()) {\n    //         return true\n    //     }\n    //     return false\n    // }\n\n    \n    setDate() {\n        let date = new Date()\n        if (date.getDay() === 6) {  \n            date.setDate(date.getDate() - 1)\n        } else if (date.getDay() === 0) {\n            date.setDate(date.getDate() - 2)\n        }\n        this.selectDatetimeConfirm(date)\n    }\n\n    // // SPECIAL DAY QUICK TEMP FIX\n    // setDate() {\n    //     let date = new Date()\n    //     if (date.getDay() === 0) {\n    //         date.setDate(date.getDate() - 1)\n    //     }\n    //     this.selectDatetimeConfirm(date)\n    // }\n\n\n    isIOS() {\n        return Platform.OS === 'ios'\n    }\n\n    initializeChildren() {\n        const { parent_id } = this.props.route.params\n\n        // this.setState({ child_id: '', date: new Date })\n        // this.setDate()\n        fetch(`https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/${ENV}/family/${parent_id}`, {\n            method: 'GET',\n            headers: {\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            }\n        })\n            .then((res) => res.json())\n            .then((resJson) => {\n                const { statusCode, message, data } = resJson\n                if (statusCode > 200 || message === 'Internal server error') {\n                    alert('Sorry 電腦出狀況了！請截圖和與工程師聯繫' + message)\n                    return\n                }\n                this.props.initializeChildren(data)\n                const student_id_array = Object.keys(this.props.parent.child_of_id)\n                this.setState({\n                    child_id: student_id_array[0],\n                    student_id_array\n                })\n                // this.checkStudentAttendance(student_id_array[0])\n                this.setDate()\n            })\n            .catch((err) => {\n                alert('Sorry 電腦出狀況了！請截圖和與工程師聯繫: error occurred when initializing student profiles')\n        })\n    }\n\n    _handleAppStateChange = nextAppState => {\n        if (\n            this.state.appState.match(/inactive|background/) &&\n            nextAppState === \"active\"\n        ) {\n            this.checkStudentAttendance(this.state.child_id)\n\n            if (this.state.date.toDateString() !== (new Date).toDateString() && (new Date).getHours() > 3) {\n                this.initializeChildren()\n            }\n        }\n        this.setState({ appState: nextAppState });\n    };\n\n    async checkStudentAttendance(student_id) {\n        if (this.state.date.toDateString() !== (new Date).toDateString()) {\n            return\n        }\n        const date = new Date()\n        const response = await get(`/attendance/${student_id}?date=${formatDate(date)}`)\n        const { success, statusCode, message, data } = response\n        // console.log('response: ', response)\n        if (success) {\n            const { in_time, out_time, excuse_type } = data\n            if ((in_time !== null && out_time !== null) || excuse_type !== null) {\n                let date = new Date()\n                date.setHours(18,0,0,0)\n                this.setState({\n                    date\n                })\n            }\n        }\n    }\n\n    onSelectStudent(child_id) {\n        this.setState({ child_id })\n    }\n\n    markPresent(temperature) {\n        const { date } = this.state\n        this.setState({\n            temperature,\n            present: temperature !== ''\n        })\n    }\n\n    selectDatetimeConfirm(date) {\n        const threshold = new Date()\n        threshold.setHours(0,0,0,0)\n        if (date.getTime() < threshold.getTime()) { // if selected date is before today\n            date.setHours(18)\n        } else if (date.toDateString() === (new Date()).toDateString()) { // if selected date is today\n            date.setTime(new Date())\n        } else { // if selected date is tomorrow\n            date.setHours(16, 0, 0)\n        }\n        this.setState({ date, showDateTimeModal: false }, () => this.checkStudentAttendance(this.state.child_id))\n    }\n\n    getDayDifference(startDate, endDate) {\n        let start = new Date(startDate)\n        let end = new Date(endDate)\n        start.setHours(0)\n        end.setHours(0)\n        const oneDay = 24 * 60 * 60 * 1000;\n        return Math.round((end - start) / (oneDay))\n    }\n\n    // SPECIAL DAY QUICK TEMP FIX\n    goBackADay() {\n        const date = new Date(this.state.date.getTime())\n        if (date.getDay() === 1) {\n            date.setDate(date.getDate() - 3)\n        } else {\n            date.setDate(date.getDate() - 1)\n        }\n        this.selectDatetimeConfirm(date)\n    }\n\n    goForwardADay() {\n        const date = new Date(this.state.date.getTime())\n        if (date.getDay() === 5) {\n            date.setDate(date.getDate() + 3)\n        } else {\n            date.setDate(date.getDate() + 1)\n        }\n        this.selectDatetimeConfirm(date)\n    }\n\n    componentWillUnmount() {\n        clearTimeout(this.timeoutId)\n        AppState.removeEventListener(\"change\", this._handleAppStateChange);\n        this.props.clearState()\n    }\n\n    render() {\n        const { parent_id } = this.props.route.params\n        const { isConnected } = this.props\n        // console.log('isConnected: ', isConnected)\n        const { date, child_id, showQR, temperature, showDateTimeModal, present, showTimeModal } = this.state\n        // console.log('parenthome: ', date)\n        if (child_id === '') {\n            return (\n                <Reloading />\n            )\n        }\n        const selected_student = this.props.parent.child_of_id[child_id]\n        const day_difference = this.getDayDifference(date, new Date())\n        return (\n            <KeyboardAvoidingView\n                enabled\n                behavior={\"padding\"}\n                keyboardVerticalOffset={100}\n                style={{ flex: 1, zIndex: 1 }}\n            >\n                <ProfileSelector\n                    ref='profile_selector'\n                    student_of_id={this.props.parent.child_of_id}\n                    onSelectStudent={(student_id) => this.onSelectStudent(student_id)}\n                />\n                {showQR ? \n                    <QRPage\n                        hideQRCode={() => this.setState({\n                            showQR: false\n                        })}\n                        parent_id={parent_id}\n                    />\n                    : null\n                }\n\n                {showDateTimeModal ?\n                    <TimeModal\n                        start_date={date}\n                        datetime_type={'date'}\n                        hideModal={() => this.setState({ showDateTimeModal: false })}\n                        selectDatetimeConfirm={(datetime) => this.selectDatetimeConfirm(datetime)}\n                        minDatetime={(new Date()).setDate((new Date()).getDate() - 7)}\n                        maxDatetime={(new Date()).setDate((new Date()).getDate() + 1)}\n                        paddingVertical={100}\n                    />\n                    : null\n                }\n\n                {showTimeModal &&\n                    <TimeModal\n                        start_date={new Date()}\n                        datetime_type={'time'}\n                        hideModal={() => this.setState({ showTimeModal: false })}\n                        selectDatetimeConfirm={(time) => this.refs['morningreminder'].selectDatetimeConfirm(time)}\n                        minDatetime={null}\n                        maxDatetime={null}\n                        minTime={null}\n                        maxTime={null}\n                        paddingVertical={400}\n                    />\n                }\n\n                {<ScrollView\n                    contentContainerStyle={{ alignItems: 'center', justifyContent: 'center', paddingBottom: 30 }}\n                    refreshControl={\n                        <RefreshControl\n                            style={{backgroundColor: 'transparent' }}\n                            refreshing={this.state.refreshing}\n                            onRefresh={this.initializeChildren}\n                            tintColor=\"#ff8944\"\n                            title=\"Loading...\"\n                            titleColor=\"#368cbf\"\n                            colors={['#ff8944', '#368cbf', '#0000ff']}\n                            progressBackgroundColor=\"#ffff00\"\n                        />\n                    }\n                >\n                    <View style={{ width: '100%', flexDirection: 'row', backgroundColor: 'white' }}> \n                        <View style={{ width: '15%'}}>\n                            {day_difference < 7 ?\n                                <TouchableOpacity\n                                    style={{ flex: 1, justifyContent: 'center', alignItems: 'center'}}\n                                    onClick={() => this.goBackADay()}\n                                >\n                                    <Image\n                                        source={require('../../assets/icon-back.png')}\n                                        style={{ width: 40, height: 40 }}\n                                    />\n                                </TouchableOpacity>\n                                : null\n                            }\n                        </View>\n                        <TouchableOpacity\n                            style={{ width: '70%', justifyContent: 'center'}}\n                            onClick={() => this.setState({ showDateTimeModal: true })}\n                        >\n\n                            <Text style={{ fontSize: width * 0.12, textAlign: 'center' }}>\n                                {beautifyDate(date)}\n                            </Text>\n                        </TouchableOpacity>\n                        <View style={{ width: '15%'}}>\n                            {day_difference >= 0 ?\n                                <TouchableOpacity\n                                    style={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}\n                                    onClick={() => this.goForwardADay()}\n                                >\n                                    <Image\n                                        source={require('../../assets/icon-forward.png')}\n                                        style={{ width: 40, height: 40 }}\n                                    />\n                                </TouchableOpacity>\n                                : null\n                            }\n                        </View>\n                    </View>\n                    <ParentHomeTitle\n                        student={selected_student}\n                        students={this.props.parent.child_of_id}\n                        student_name={this.props.parent.child_of_id[child_id].name}\n                        selectOtherChildProfile={() => this.refs['profile_selector'].slideIn()}\n                        viewQRCode={() => this.setState({\n                            showQR: true\n                        })}\n                        temperature={temperature}\n                    />\n\n                    <View style={{ flex: 1, width: '93%', flexDirection: 'row', justifyContent: 'space-between', marginVertical: 5 }}>\n                        <TouchableOpacity\n                            style={{width: '30%', padding: 10, backgroundColor: '#ffe1d0'}}\n                            onClick={() => this.props.navigation.navigate('PickupRequest', {\n                                child_id,\n                                school_id: selected_student.school_id\n                            })}>\n                            <Text style={{ fontSize: width * 0.05, textAlign: 'center'}}>接回告知</Text>\n                        </TouchableOpacity>\n                        <TouchableOpacity\n                            style={{width: '30%', padding: 10, backgroundColor: '#fff1b5'}}\n                            onClick={() => this.props.navigation.push('MedicationRequestPage', {\n                                onGoBack: () => this.refs['med_request'].fetchData(child_id, new Date()),\n                                student_id: child_id,\n                                class_id: selected_student.class_id\n                            })}>\n                            <Text style={{ fontSize: width * 0.05, textAlign: 'center' }}>托藥單</Text>\n                        </TouchableOpacity>\n                        <TouchableOpacity\n                            style={{width: '30%', padding: 10, backgroundColor: '#b5e9e9'}}\n                            onClick={() => this.props.navigation.navigate('AbsenceExcusePage', {\n                                student_id: child_id,\n                                class_id: selected_student.class_id === null ? \"\" : selected_student.class_id,\n                                school_id: selected_student.school_id\n                            })}>\n                            <Text style={{ fontSize: width * 0.05, textAlign: 'center' }}>請假單</Text>\n                        </TouchableOpacity>\n                    </View>\n\n                    <MorningReminderCard\n                        child_id={child_id}\n                        date={date}\n                        class_id={selected_student.class_id}\n                        ref=\"morningreminder\"\n                        present={present}\n                        isConnected={isConnected}\n                        parent_id={parent_id}\n                        showTimeModal={() => this.setState({ showTimeModal: true })}\n                    />\n\n                    <MedicationRequestCard\n                        child_id={child_id}\n                        date={date}\n                        ref=\"med_request\"\n                        viewMedRequest={(index, data) => this.props.navigation.push('AddMedicationRequestPage', {\n                            onGoBack: () => this.refs['med_request'].fetchData(child_id, new Date()),\n                            student_id: child_id, \n                            class_id: selected_student.class_id === null ? \"\" : selected_student.class_id,\n                            index,\n                            data\n                        })}\n                    />\n\n                    <WellnessCard\n                        child_id={child_id}\n                        date={date}\n                        ref=\"wellness\"\n                        updateTitleTemp={(temperature) => this.markPresent(temperature)}\n                    />\n\n                    <MessageCard\n                        child_id={child_id}\n                        date={date}\n                        class_id={selected_student.class_id}\n                        ref=\"messages\"\n                        parent_id={parent_id}\n                    />\n\n                    <AppetiteCard\n                        child_id={child_id}\n                        date={date}\n                        ref=\"appetite\"\n                    />\n\n                    <MilkCard\n                        child_id={child_id}\n                        date={date}\n                        ref=\"milkintake\"\n                    />\n\n                    <SleepCard\n                        child_id={child_id}\n                        date={date}\n                        ref=\"sleep\"\n                    />\n\n                    <RestroomCard\n                        child_id={child_id}\n                        date={date}\n                        ref=\"diaper\"\n                    />\n\n                </ScrollView>}\n            </KeyboardAvoidingView>\n        );\n    }\n}\n\nconst styles = StyleSheet.create({\n    button_text: {\n        fontSize: 18,\n        textAlign: 'center'\n    },\n    button: {\n        width: '30%',\n        padding: 20,\n        justifyContent: 'center',\n        // shadowColor: \"#000\",\n        // shadowOffset: {\n        //     width: 0,\n        //     height: 1,\n        // },\n        // shadowOpacity: 0.22,\n        // shadowRadius: 2.22,\n        // elevation: 3,\n    }\n})\n\nconst mapStateToProps = (state) => {\n    return {\n        parent: state.parent,\n        isConnected: state.parent.isConnected\n    }\n}\n\nconst mapDispatchToProps = (dispatch) => {\n    return {\n        ...bindActionCreators({\n            setConnectState,\n            initializeChildren,\n            markPresent,\n            clearState\n        }, dispatch)\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ParentHome)\n"]},"metadata":{},"sourceType":"module"}