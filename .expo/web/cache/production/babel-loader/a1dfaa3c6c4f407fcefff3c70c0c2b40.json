{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _assertThisInitialized from\"@babel/runtime/helpers/assertThisInitialized\";import _inherits from\"@babel/runtime/helpers/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import React from'react';import{Text,Button,Container,Content,Toast}from'native-base';import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import View from\"react-native-web/dist/exports/View\";import{setConnectState,initializeClass,setClassId,clearState}from\"../../redux/school/actions/index\";import{connect}from'react-redux';import{bindActionCreators}from'redux';import LoginNumberPad from\"./loginnumberpad\";import AttendanceCard from\"./attendancecard\";import MedicationReqeustCard from\"./medicationrequestcard\";import Reloading from\"../reloading\";import PickupAlert from\"./pickupalert\";import Modal from\"./modal\";import NetInfo from'@react-native-community/netinfo';import InboxCard from\"./inboxcard\";var TeacherHome=function(_React$Component){_inherits(TeacherHome,_React$Component);var _super=_createSuper(TeacherHome);function TeacherHome(props){var _this;_classCallCheck(this,TeacherHome);_this=_super.call(this,props);_this.timer=function(class_id){return setTimeout(function(){_this.poll(class_id);},10000);};_this.state={isLoading:true,showLoginNumberPad:false,pageClicked:'',alertForPickup:false,pickupQueue:[],showModal:false,modalStudentId:'',modalTeacherId:'',isAdmin:false,admin_id:''};_this.initializeClass=_this.initializeClass.bind(_assertThisInitialized(_this));_this.handleEnterPasscode=_this.handleEnterPasscode.bind(_assertThisInitialized(_this));_this.hideLoginPad=_this.hideLoginPad.bind(_assertThisInitialized(_this));_this.onConfirmPickup=_this.onConfirmPickup.bind(_assertThisInitialized(_this));_this.showModal=_this.showModal.bind(_assertThisInitialized(_this));_this.hideModal=_this.hideModal.bind(_assertThisInitialized(_this));return _this;}_createClass(TeacherHome,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;this.unsubscribe=NetInfo.addEventListener(function(state){var isConnected=state.isConnected;_this2.props.setConnectState(isConnected);});var _this$props$route$par=this.props.route.params,class_id=_this$props$route$par.class_id,class_name=_this$props$route$par.class_name,isAdmin=_this$props$route$par.isAdmin,admin_id=_this$props$route$par.admin_id;this.setState({isAdmin:isAdmin,admin_id:admin_id});this.props.setClassId(class_id);this.initializeClass(class_id);this.timeoutId=this.timer(class_id);this.props.navigation.setOptions({title:class_name});}},{key:\"poll\",value:function poll(class_id){var _this3=this;var query;return _regeneratorRuntime.async(function poll$(_context){while(1){switch(_context.prev=_context.next){case 0:query=\"https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/dev/class/\"+class_id+\"/updates\";_context.next=3;return _regeneratorRuntime.awrap(fetch(query,{method:'GET',headers:{Accept:'application/json','Content-Type':'application/json'}}).then(function(res){return res.json();}).then(function(resJson){var update_types=resJson.data;update_types.forEach(function(type){_this3.refs[type].fetchData();});}).catch(function(err){console.log('err: ',err);}));case 3:this.timeoutId=this.timer(class_id);case 4:case\"end\":return _context.stop();}}},null,this,null,Promise);}},{key:\"initializeClass\",value:function initializeClass(class_id){var _this4=this;fetch(\"https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/dev/class/\"+class_id,{method:'GET',headers:{Accept:'application/json','Content-Type':'application/json'}}).then(function(res){return res.json();}).then(function(resJson){_this4.props.initializeClass(resJson.teachers,resJson.students);_this4.setState({isLoading:false});}).catch(function(err){console.log('err: ',err);});}},{key:\"handleEnterPasscode\",value:function handleEnterPasscode(passcode){var teacher_id=this.props.class.passcodeTeacherId[passcode];if(teacher_id===undefined){Toast.show({text:'Wrong password!',buttonText:'Okay',position:\"top\",type:\"warning\",duration:3000});}else if(this.state.pageClicked==='attendance_modal'){this.setState({showModal:true,showLoginNumberPad:false,modalTeacherId:teacher_id});}else{this.props.navigation.navigate(this.state.pageClicked,{teacher_id:teacher_id,class:this.props.class});this.setState({showLoginNumberPad:false});}}},{key:\"pageClicked\",value:function pageClicked(_pageClicked){var _this$state=this.state,isAdmin=_this$state.isAdmin,admin_id=_this$state.admin_id;if(isAdmin){this.props.navigation.push(_pageClicked,{class:this.props.class,teacher_id:admin_id});}else{this.setState({showLoginNumberPad:true,pageClicked:_pageClicked});}}},{key:\"hideLoginPad\",value:function hideLoginPad(){this.setState({showLoginNumberPad:false});}},{key:\"onConfirmPickup\",value:function onConfirmPickup(){var newPickupQueue=this.state.pickupQueue.slice(1,this.state.pickupQueue.length);this.setState({alertForPickup:newPickupQueue.length===0?false:true,pickupQueue:newPickupQueue});}},{key:\"showModal\",value:function showModal(student_id){this.setState({showLoginNumberPad:true,pageClicked:'attendance_modal',modalStudentId:student_id});}},{key:\"hideModal\",value:function hideModal(){this.setState({showModal:false});}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){clearTimeout(this.timeoutId);this.props.clearState();this.unsubscribe();}},{key:\"render\",value:function render(){var _this5=this;var class_id=this.props.route.params.class_id;if(this.state.isLoading){return React.createElement(Reloading,null);}return React.createElement(Container,{style:{flex:1}},this.state.showLoginNumberPad?React.createElement(LoginNumberPad,{handleEnterPasscode:function handleEnterPasscode(passcode){return _this5.handleEnterPasscode(passcode);},hideLoginPad:this.hideLoginPad}):null,React.createElement(Modal,{show:this.state.showModal,student_id:this.state.modalStudentId,teacher_id:this.state.modalTeacherId,class_id:class_id,hideModal:this.hideModal}),React.createElement(Content,{contentContainerStyle:{marginTop:30,paddingBottom:50,alignItems:'center',justifyContent:'center'}},React.createElement(InboxCard,{ref:\"messages\",class_id:class_id,students:this.props.class.students,navigation:this.props.navigation}),React.createElement(MedicationReqeustCard,{ref:\"med_request\",class_id:class_id,students:this.props.class.students,medication_requests:this.props.medication_requests,navigation:this.props.navigation}),React.createElement(View,{style:styles.button_row},React.createElement(Button,{style:styles.record_button,onPress:function onPress(){return _this5.pageClicked('WellnessLog');}},React.createElement(Text,{style:styles.button_text},\"\\u5065\\u5EB7\")),React.createElement(Button,{style:styles.record_button,onPress:function onPress(){return _this5.pageClicked('MessageForParents');}},React.createElement(Text,{style:styles.button_text},\"\\u8001\\u5E2B\",\"\\n\",\"\\uF9CD\\u2F94\")),React.createElement(Button,{style:styles.record_button,onPress:function onPress(){return _this5.pageClicked('TeacherAppetiteLog');}},React.createElement(Text,{style:styles.button_text},\"\\u98F2\\u98DF\"))),React.createElement(View,{style:styles.button_row},React.createElement(Button,{style:styles.record_button,onPress:function onPress(){return _this5.pageClicked('TeacherSleepLog');}},React.createElement(Text,{style:styles.button_text},\"\\u7761\\u7720\")),React.createElement(Button,{style:styles.record_button,onPress:function onPress(){return _this5.pageClicked('TeacherMilkLog');}},React.createElement(Text,{style:styles.button_text},\"\\u9935\\u5976\")),React.createElement(Button,{style:styles.record_button,onPress:function onPress(){return _this5.pageClicked('DiaperLog');}},React.createElement(Text,{style:styles.button_text},\"\\u63DB\\u5C3F\\u5E03\"))),React.createElement(Button,{style:styles.button,onPress:function onPress(){return _this5.props.navigation.goBack();}},React.createElement(Text,{style:styles.button_text},\"\\u8FD4\\u56DE\"))));}}]);return TeacherHome;}(React.Component);var styles=StyleSheet.create({card:{width:'90%'},button_row:{width:'90%',height:100,justifyContent:'space-between',flexDirection:'row',marginVertical:7,paddingHorizontal:3},button_text:{width:'100%',textAlign:'center',color:'gray',fontSize:40},record_button:{width:'30%',height:'100%',backgroundColor:\"#b5e9e9\"},button:{width:'30%',backgroundColor:\"#b5e9e9\"}});var mapStateToProps=function mapStateToProps(state){return{class:state.classInfo,medication_requests:state.medicationrequests,attendance:state.attendance,teachers:state.school.teachers};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return _objectSpread({},bindActionCreators({setConnectState:setConnectState,initializeClass:initializeClass,setClassId:setClassId,clearState:clearState},dispatch));};export default connect(mapStateToProps,mapDispatchToProps)(TeacherHome);","map":{"version":3,"sources":["/home/caleb_lee/gina_web_app/components/teacher/teacherhome.js"],"names":["React","Text","Button","Container","Content","Toast","setConnectState","initializeClass","setClassId","clearState","connect","bindActionCreators","LoginNumberPad","AttendanceCard","MedicationReqeustCard","Reloading","PickupAlert","Modal","NetInfo","InboxCard","TeacherHome","props","timer","class_id","setTimeout","poll","state","isLoading","showLoginNumberPad","pageClicked","alertForPickup","pickupQueue","showModal","modalStudentId","modalTeacherId","isAdmin","admin_id","bind","handleEnterPasscode","hideLoginPad","onConfirmPickup","hideModal","unsubscribe","addEventListener","isConnected","route","params","class_name","setState","timeoutId","navigation","setOptions","title","query","fetch","method","headers","Accept","then","res","json","resJson","update_types","data","forEach","type","refs","fetchData","catch","err","console","log","teachers","students","passcode","teacher_id","class","passcodeTeacherId","undefined","show","text","buttonText","position","duration","navigate","push","newPickupQueue","slice","length","student_id","clearTimeout","flex","marginTop","paddingBottom","alignItems","justifyContent","medication_requests","styles","button_row","record_button","button_text","button","goBack","Component","StyleSheet","create","card","width","height","flexDirection","marginVertical","paddingHorizontal","textAlign","color","fontSize","backgroundColor","mapStateToProps","classInfo","medicationrequests","attendance","school","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { Text, Button, Container, Content, Toast} from 'native-base'\nimport { StyleSheet, View } from 'react-native'\nimport { setConnectState, initializeClass, setClassId, clearState } from '../../redux/school/actions/index'\nimport { connect } from 'react-redux'\nimport { bindActionCreators } from 'redux'\nimport LoginNumberPad from './loginnumberpad'\nimport AttendanceCard from './attendancecard'\nimport MedicationReqeustCard from './medicationrequestcard'\nimport Reloading from '../reloading'\nimport PickupAlert from './pickupalert'\nimport Modal from './modal'\nimport NetInfo from '@react-native-community/netinfo'\nimport InboxCard from './inboxcard'\n\n\nclass TeacherHome extends React.Component {\n    constructor (props) {\n        super(props)\n        this.state = {\n            isLoading: true,\n            showLoginNumberPad: false,\n            pageClicked: '',\n            alertForPickup: false,\n            pickupQueue: [],\n            showModal: false,\n            modalStudentId: '',\n            modalTeacherId: '',\n            isAdmin: false,\n            admin_id: ''\n        }\n        this.initializeClass = this.initializeClass.bind(this)\n        this.handleEnterPasscode = this.handleEnterPasscode.bind(this)\n        this.hideLoginPad = this.hideLoginPad.bind(this)\n        this.onConfirmPickup = this.onConfirmPickup.bind(this)\n        this.showModal = this.showModal.bind(this)\n        this.hideModal = this.hideModal.bind(this)\n    }\n\n    componentDidMount() {\n        this.unsubscribe = NetInfo.addEventListener(state => {\n            const {isConnected} = state\n            this.props.setConnectState(isConnected)\n        });\n        const { class_id, class_name, isAdmin, admin_id } = this.props.route.params\n        this.setState({ isAdmin, admin_id })\n        this.props.setClassId(class_id)\n        this.initializeClass(class_id)\n        this.timeoutId = this.timer(class_id)\n        this.props.navigation.setOptions({ \n            title: class_name\n        })\n    }\n\n    timer = (class_id) => setTimeout(() => {\n        this.poll(class_id)\n    }, 10000)\n\n    async poll(class_id) {\n        const query = `https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/dev/class/${class_id}/updates`\n        await fetch(query, {\n            method: 'GET',\n            headers: {\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            }\n        })\n            .then(res => res.json())\n            .then(resJson => { // TODO: make sure to disable this polling for admin log in\n                // console.log('teacherhome/poll/resJson: ', resJson)\n                const update_types = resJson.data\n                update_types.forEach(type => {\n                    this.refs[type].fetchData()\n                })\n            })\n            .catch(err => {console.log('err: ', err)})\n        this.timeoutId = this.timer(class_id)\n    }\n\n    initializeClass(class_id) {\n        fetch(`https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/dev/class/${class_id}`, {\n            method: 'GET',\n            headers: {\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            }\n        }).then((res) => res.json())\n            .then((resJson) => {\n                // console.log('teacherHome/resJson: ', resJson)\n                this.props.initializeClass(resJson.teachers, resJson.students)\n                this.setState({\n                    isLoading: false\n                })\n        }).catch(err => {\n            console.log('err: ', err)\n        })\n    }\n\n    handleEnterPasscode(passcode) {\n        const teacher_id = this.props.class.passcodeTeacherId[passcode]\n        if (teacher_id === undefined) {\n            Toast.show({\n                text: 'Wrong password!',\n                buttonText: 'Okay',\n                position: \"top\",\n                type: \"warning\",\n                duration: 3000\n            })\n        } else if (this.state.pageClicked === 'attendance_modal') {\n            this.setState({\n                showModal: true,\n                showLoginNumberPad: false,\n                modalTeacherId: teacher_id\n            })\n        } else {\n            this.props.navigation.navigate(this.state.pageClicked, {\n                teacher_id: teacher_id,\n                class: this.props.class,\n            })\n            this.setState({ showLoginNumberPad: false })\n        }\n    }\n\n    pageClicked(pageClicked) {\n        const { isAdmin, admin_id } = this.state\n        if (isAdmin) {\n            this.props.navigation.push(pageClicked, {\n                class: this.props.class,\n                teacher_id: admin_id\n            })\n        } else {\n            this.setState({ showLoginNumberPad: true, pageClicked})\n        }\n    }\n\n    hideLoginPad() {\n        this.setState({ showLoginNumberPad: false })\n    }\n\n    onConfirmPickup() {\n        var newPickupQueue = this.state.pickupQueue.slice(1, this.state.pickupQueue.length)\n        this.setState({\n            alertForPickup: newPickupQueue.length === 0 ? false : true,\n            pickupQueue: newPickupQueue\n        })\n    }\n\n    showModal(student_id) {\n        this.setState({\n            showLoginNumberPad: true,\n            pageClicked: 'attendance_modal',\n            modalStudentId: student_id\n        })\n    }\n\n    hideModal() {\n        this.setState({\n            showModal: false\n        })\n    }\n\n    componentWillUnmount() {\n        clearTimeout(this.timeoutId)\n        this.props.clearState()\n        this.unsubscribe()\n    }\n\n    render() {\n        const { class_id } = this.props.route.params\n        if (this.state.isLoading) {\n            return (\n                <Reloading />\n            )\n        }\n        return (\n            <Container style={{ flex: 1 }}>\n                {this.state.showLoginNumberPad ? \n                    <LoginNumberPad\n                        handleEnterPasscode={(passcode) => this.handleEnterPasscode(passcode)}\n                        hideLoginPad={this.hideLoginPad}\n                    /> : null\n                }\n                {/* <PickupAlert\n                    ref=\"pickup_request\"\n                    class_id={class_id}\n                    students={this.props.class.students}\n                /> */}\n\n                <Modal\n                    show={this.state.showModal}\n                    student_id={this.state.modalStudentId}\n                    teacher_id={this.state.modalTeacherId}\n                    class_id={class_id}\n                    hideModal={this.hideModal}\n                />\n\n                <Content contentContainerStyle={{\n                    marginTop: 30,\n                    paddingBottom: 50,\n                    alignItems: 'center',\n                    justifyContent: 'center'\n                }}>\n                    {/* <Button\n                        style={styles.button}\n                        onPress={() => {this.props.navigation.push('TeacherClockInOut')}}>\n                        <Text style={styles.button_text}>打卡</Text>\n                    </Button> */}\n\n                    {/* <View style={styles.card}>\n                        {this.props.attendance.initialized ? \n                            <AttendanceCard\n                                ref=\"attendance\"\n                                navigator={this.props.navigation}\n                                showModal={(student_id) => this.showModal(student_id)}\n                            />\n                        : <Reloading />\n                        }\n                    </View> */}\n                    <InboxCard\n                        ref=\"messages\"\n                        class_id={class_id}\n                        students={this.props.class.students}\n                        navigation={this.props.navigation}\n                    />\n\n                    <MedicationReqeustCard\n                        ref=\"med_request\"\n                        class_id={class_id}\n                        students={this.props.class.students}\n                        medication_requests={this.props.medication_requests}\n                        navigation={this.props.navigation}\n                    />\n\n                    <View style={styles.button_row}>\n                        <Button\n                            style={styles.record_button}\n                            onPress={() => this.pageClicked('WellnessLog')}>\n                            <Text style={styles.button_text}>健康</Text>\n                        </Button>\n                        <Button\n                            style={styles.record_button}\n                            onPress={() => this.pageClicked('MessageForParents')}>\n                            <Text style={styles.button_text}>老師{\"\\n\"}留⾔</Text>\n                            </Button>\n                        <Button\n                            style={styles.record_button}\n                            onPress={() => this.pageClicked('TeacherAppetiteLog')}>\n                            <Text style={styles.button_text}>飲食</Text>\n                        </Button>\n                    </View>\n                    <View style={styles.button_row}>\n                        <Button\n                            style={styles.record_button}\n                            onPress={() => this.pageClicked('TeacherSleepLog')}>\n                            <Text style={styles.button_text}>睡眠</Text>\n                        </Button>\n                        <Button\n                            style={styles.record_button}\n                            onPress={() => this.pageClicked('TeacherMilkLog')}>\n                            <Text style={styles.button_text}>餵奶</Text>\n                        </Button>\n                        <Button\n                            style={styles.record_button}\n                            onPress={() => this.pageClicked('DiaperLog')}>\n                            <Text style={styles.button_text}>換尿布</Text>\n                        </Button>\n                    </View>\n                    <Button\n                        style={styles.button}\n                        onPress={() => this.props.navigation.goBack()}>\n                        <Text style={styles.button_text}>返回</Text>\n                    </Button>\n                </Content>\n            </Container>\n        )\n    }\n}\n\nconst styles = StyleSheet.create({\n    card: {\n        width: '90%'\n    },\n    button_row: {\n        width: '90%',\n        height: 100,\n        justifyContent: 'space-between',\n        flexDirection: 'row',\n        marginVertical: 7,\n        paddingHorizontal: 3\n    },\n    button_text: {\n        width: '100%',\n        textAlign: 'center',\n        color: 'gray',\n        fontSize: 40\n    },\n    record_button: {\n        width: '30%',\n        height: '100%',\n        backgroundColor:\"#b5e9e9\"\n    },\n    button: {\n        width: '30%',\n        backgroundColor:\"#b5e9e9\"\n    }\n})\n\nconst mapStateToProps = (state) => {\n    return {\n        class: state.classInfo,\n        medication_requests: state.medicationrequests,\n        attendance: state.attendance,\n        teachers: state.school.teachers\n    }\n}\n\nconst mapDispatchToProps = (dispatch) => {\n    return {\n        ...bindActionCreators({setConnectState, initializeClass, setClassId, clearState}, dispatch)\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps) (TeacherHome)"]},"metadata":{},"sourceType":"module"}