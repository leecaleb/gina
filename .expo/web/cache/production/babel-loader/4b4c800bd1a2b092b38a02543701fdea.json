{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _toConsumableArray from\"@babel/runtime/helpers/toConsumableArray\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _assertThisInitialized from\"@babel/runtime/helpers/assertThisInitialized\";import _inherits from\"@babel/runtime/helpers/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import React from'react';import View from\"react-native-web/dist/exports/View\";import Text from\"react-native-web/dist/exports/Text\";import TouchableHighlight from\"react-native-web/dist/exports/TouchableHighlight\";import Image from\"react-native-web/dist/exports/Image\";import Alert from\"react-native-web/dist/exports/Alert\";import{connect}from'react-redux';import{formatDate}from\"../util\";import Reloading from\"../reloading\";import{addPickupRequest}from\"../../redux/school/actions/index\";import{bindActionCreators}from'redux';var PickupAlert=function(_React$Component){_inherits(PickupAlert,_React$Component);var _super=_createSuper(PickupAlert);function PickupAlert(props){var _this;_classCallCheck(this,PickupAlert);_this=_super.call(this,props);_this.timer=function(){return setTimeout(function(){_this.setState({color:_this.state.color==='#ffe1d0'?'#fa625f':'#ffe1d0'});_this.timeoutId=_this.timer();},2000);};_this.state={color:'#ffe1d0',requestQueue:[],isLoading:true};_this.onConfirm=_this.onConfirm.bind(_assertThisInitialized(_this));return _this;}_createClass(PickupAlert,[{key:\"componentDidMount\",value:function componentDidMount(){this.timeoutId=this.timer();}},{key:\"onConfirm\",value:function onConfirm(request_id,index){var _this2=this;var pick_up_request=_toConsumableArray(this.props.pick_up_request);var query=\"https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/dev/attendance/pickup-request?request_id=\"+request_id;fetch(query,{method:'PUT',headers:{Accept:'application/json','Content-Type':'application/json'}}).then(function(res){return res.json();}).then(function(resJson){var statusCode=resJson.statusCode,message=resJson.message;if(statusCode===200){pick_up_request.splice(index,1);_this2.props.addPickupRequest(pick_up_request);if(pick_up_request.length===0){_this2.props.navigation.goBack();}}else{Alert.alert('Sorry 取得接回通知資料時電腦出狀況了！','請截圖和與工程師聯繫 '+message,[{text:'Ok'}]);}}).catch(function(err){console.log('err: ',err);});}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){clearTimeout(this.timeoutId);}},{key:\"render\",value:function render(){var _this3=this;var _this$props=this.props,pick_up_request=_this$props.pick_up_request,students=_this$props.students;return React.createElement(View,{style:{flex:1,flexDirection:'row',justifyContent:'space-evenly',alignItems:'center',flexWrap:'wrap'}},pick_up_request.map(function(request,index){var id=request.id,student_id=request.student_id,arrival_time=request.arrival_time;var student=students[student_id];return React.createElement(View,{key:index,style:{width:'45%',height:'45%',marginTop:'5%',backgroundColor:_this3.state.color}},React.createElement(View,{style:{flex:2,alignItems:'center',justifyContent:'center'}},React.createElement(Image,{source:{uri:student.profile_picture},style:{width:'80%',aspectRatio:1}})),React.createElement(View,{style:{flex:1}},React.createElement(View,{style:{flex:1,justifyContent:'center'}},React.createElement(Text,{style:{fontSize:80,textAlign:'center'}},arrival_time)),React.createElement(View,{style:{flex:1}},React.createElement(TouchableHighlight,{style:{backgroundColor:'grey',padding:15,alignSelf:'flex-end',justifyContent:'center',marginRight:15},onPress:function onPress(){return _this3.onConfirm(id,index);}},React.createElement(Text,{style:{fontSize:35,textAlign:'center',color:'lightgrey'}},\"\\u78BA\\u8A8D\")))));}));}}]);return PickupAlert;}(React.Component);var mapStateToProps=function mapStateToProps(state){return{students:state.school.students,pick_up_request:state.school.pick_up_request};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return _objectSpread({},bindActionCreators({addPickupRequest:addPickupRequest},dispatch));};export default connect(mapStateToProps,mapDispatchToProps,null,{forwardRef:true})(PickupAlert);","map":{"version":3,"sources":["/home/caleb_lee/gina_web_app/components/teacher/pickupalert.js"],"names":["React","connect","formatDate","Reloading","addPickupRequest","bindActionCreators","PickupAlert","props","timer","setTimeout","setState","color","state","timeoutId","requestQueue","isLoading","onConfirm","bind","request_id","index","pick_up_request","query","fetch","method","headers","Accept","then","res","json","resJson","statusCode","message","splice","length","navigation","goBack","Alert","alert","text","catch","err","console","log","clearTimeout","students","flex","flexDirection","justifyContent","alignItems","flexWrap","map","request","id","student_id","arrival_time","student","width","height","marginTop","backgroundColor","uri","profile_picture","aspectRatio","fontSize","textAlign","padding","alignSelf","marginRight","Component","mapStateToProps","school","mapDispatchToProps","dispatch","forwardRef"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { View, Text, TouchableHighlight, Image, Alert } from 'react-native'\nimport { connect } from 'react-redux'\nimport { formatDate } from '../util'\nimport Reloading from '../reloading'\nimport { addPickupRequest } from '../../redux/school/actions/index'\nimport { bindActionCreators } from 'redux'\n\nclass PickupAlert extends React.Component{\n    constructor(props) {\n        super(props)\n        this.state = {\n            color: '#ffe1d0',\n            // alertForPickup: false,\n            requestQueue: [],\n            isLoading: true\n        }\n        this.onConfirm = this.onConfirm.bind(this)\n    }\n\n    componentDidMount() {\n        // const { requestQueue } = this.props.route.params\n        // if (requestQueue.length > 0) {\n        //     this.setState({\n        //         requestQueue,\n        //         isLoading: false\n        //     })\n            this.timeoutId = this.timer()\n        // } else {\n        //     this.props.navigation.goBack()\n        // }\n    }\n\n    timer = () => setTimeout(() => {\n        this.setState({ color: this.state.color === '#ffe1d0' ? '#fa625f' : '#ffe1d0' })\n        this.timeoutId = this.timer()\n        }, 2000\n    )\n\n    // fetchData() {\n    //     const query = `https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/dev/attendance/pickup-request?school_id=${this.props.school_id}`\n    //     fetch(query, {\n    //         method: 'GET',\n    //         headers: {\n    //             Accept: 'application/json',\n    //             'Content-Type': 'application/json'\n    //         }\n    //     })\n    //         .then(res => res.json())\n    //         .then(resJson => {\n    //             if (resJson.data.length > 0) {\n    //                 this.timeoutId = this.timer()\n    //             }\n    //             this.setState({\n    //                 alertForPickup: resJson.data.length === 0 ? false : true,\n    //                 requestQueue: resJson.data\n    //             })\n    //         })\n    //         .catch(err => {\n    //             console.log('err: ', err)\n    //         })\n    // }\n\n    onConfirm(request_id, index) {\n        const pick_up_request = [...this.props.pick_up_request]\n        const query = `https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/dev/attendance/pickup-request?request_id=${request_id}`\n        fetch(query, {\n            method: 'PUT',\n            headers: {\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            }\n        })\n            .then(res => res.json())\n            .then(resJson => {\n                // TODO: error handling\n                const { statusCode, message } = resJson\n                if (statusCode === 200) {\n                    pick_up_request.splice(index, 1)\n                    this.props.addPickupRequest(pick_up_request)\n                    if (pick_up_request.length === 0) {\n                        // clearTimeout(this.timeoutId)\n                        this.props.navigation.goBack()\n                    }\n                } else {\n                    Alert.alert(\n                        'Sorry 取得接回通知資料時電腦出狀況了！',\n                        '請截圖和與工程師聯繫 ' + message,\n                        [{ text: 'Ok' }]\n                    )\n                }\n            })\n            .catch(err => {\n                console.log('err: ', err)\n            })\n    }\n\n    componentWillUnmount() {\n        clearTimeout(this.timeoutId)\n    }\n\n    render() {\n        const { pick_up_request, students } = this.props\n        // if (this.state.isLoading) {\n        //     return <Reloading />\n        // } else {\n            // const request = this.state.requestQueue[0]\n            // const student = this.props.students[request['student_id']]\n            return (\n                <View style={{\n                    flex: 1,\n                    flexDirection: 'row',\n                    // backgroundColor: 'transparent',\n                    justifyContent: 'space-evenly',\n                    alignItems: 'center',\n                    flexWrap: 'wrap'\n                    // zIndex: 2,\n                    // position: 'absolute',\n                    // width: '100%',\n                    // height: '100%'\n                }}>\n                    {pick_up_request.map((request, index) => {\n                        const { id, student_id, arrival_time } = request\n                        const student = students[student_id]\n                        return(\n                            <View\n                                key={index}\n                                style={{\n                                    // flex: 1,\n                                    width: '45%',\n                                    height: '45%',\n                                    marginTop: '5%',\n                                    backgroundColor: this.state.color,\n                                    // zIndex: 3,\n                                    // position: 'absolute'\n                                }}\n                            >\n                                <View style={{ flex: 2, alignItems: 'center', justifyContent: 'center' }}>\n                                    <Image\n                                        source={{uri: student.profile_picture }}\n                                        style={{\n                                            width: '80%',\n                                            aspectRatio: 1\n                                        }}\n                                    />\n                                </View>\n                                <View style={{ flex: 1 }}>\n                                    <View style={{ flex: 1, justifyContent: 'center' }}>\n                                        <Text style={{ fontSize: 80, textAlign: 'center' }}>{arrival_time}</Text>\n                                    </View>\n                                    <View style={{ flex: 1 }}>\n                                        <TouchableHighlight\n                                            style={{\n                                                backgroundColor: 'grey',\n                                                padding: 15,\n                                                alignSelf: 'flex-end',\n                                                justifyContent: 'center',\n                                                marginRight: 15\n                                            }}\n                                            onPress={() => this.onConfirm(id, index)}\n                                        >\n                                            <Text style={{ fontSize: 35, textAlign: 'center', color: 'lightgrey' }}>確認</Text>\n                                        </TouchableHighlight>\n                                    </View>\n                                </View>\n                            </View>\n                        )\n                    })}\n                </View>\n            )\n        // }\n    }\n}\n\nconst mapStateToProps = (state) => {\n    return {\n        students: state.school.students,\n        pick_up_request: state.school.pick_up_request\n    }\n}\n\nconst mapDispatchToProps = (dispatch) => {\n    return {\n        ...bindActionCreators({ addPickupRequest }, dispatch)\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps, null, { forwardRef: true }) (PickupAlert)"]},"metadata":{},"sourceType":"module"}