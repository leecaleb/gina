{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _assertThisInitialized from\"@babel/runtime/helpers/assertThisInitialized\";import _inherits from\"@babel/runtime/helpers/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import React from'react';import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import Image from\"react-native-web/dist/exports/Image\";import TouchableHighlight from\"react-native-web/dist/exports/TouchableHighlight\";import{Container,Content,Text,View,Card,CardItem,Toast}from'native-base';import{connect}from'react-redux';import LoginNumberPad from\"./loginnumberpad\";import{bindActionCreators}from'redux';import{markTeacherLoggedIn,markTeacherLoggedOut,markStaffAttendanceFail,fetchAttendanceSuccess}from\"../../redux/school/actions/index\";var TeacherClockInOut=function(_React$Component){_inherits(TeacherClockInOut,_React$Component);var _super=_createSuper(TeacherClockInOut);function TeacherClockInOut(props){var _this;_classCallCheck(this,TeacherClockInOut);_this=_super.call(this,props);_this.state={logging_in:false,teacher_id:''};_this.handleEnterPasscode=_this.handleEnterPasscode.bind(_assertThisInitialized(_this));_this.hideLoginPad=_this.hideLoginPad.bind(_assertThisInitialized(_this));return _this;}_createClass(TeacherClockInOut,[{key:\"componentDidMount\",value:function componentDidMount(){this.fetchStaffAttendanceByClassId();}},{key:\"fetchStaffAttendanceByClassId\",value:function fetchStaffAttendanceByClassId(){var _this2=this;var _this$props$class=this.props.class,class_id=_this$props$class.class_id,isConnected=_this$props$class.isConnected;if(!isConnected){Toast.show({text:'拍謝 網路連不到! 等一下再試試看',buttonText:'Okay',position:\"top\",type:\"warning\",duration:5000});return;}var query=\"https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/dev/staff-attendance?class_id=\"+class_id;fetch(query,{method:'GET',headers:{Accept:'application/json','Content-Type':'application/json'}}).then(function(res){return res.json();}).then(function(resJson){_this2.props.fetchAttendanceSuccess(resJson.data);}).catch(function(err){console.log('err: ',err);});}},{key:\"handleEnterPasscode\",value:function handleEnterPasscode(passcode){var teacher_id=this.props.class.passcodeTeacherId[passcode];if(teacher_id===undefined||teacher_id!==this.state.teacher_id){Toast.show({text:'Wrong password!',buttonText:'Okay',position:\"top\",type:\"warning\",duration:3000});}else{var teacher=this.props.class.teachers[teacher_id];var time=new Date();if(teacher.logged_in){this.clockOut(teacher_id,time);}else{this.clockIn(teacher_id,time);}this.setState({logging_in:false});}}},{key:\"clockIn\",value:function clockIn(staff_id,time){var _this3=this;var isConnected=this.props.class.isConnected;if(!isConnected){Toast.show({text:'拍謝 網路連不到! 等一下再試試看',buttonText:'Okay',position:\"top\",type:\"warning\",duration:5000});return;}var query=\"https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/dev/staff-attendance\";fetch(query,{method:'POST',headers:{Accept:'application/json','Content-Type':'application/json'},body:JSON.stringify({staff_id:staff_id})}).then(function(res){return res.json();}).then(function(resJson){var statusCode=resJson.statusCode,message=resJson.message,data=resJson.data;if(statusCode>200||resJson[\"message\"]===\"Internal server error\"){_this3.props.markStaffAttendanceFail(message);}else{_this3.props.markTeacherLoggedIn(staff_id,time,data.attendance_id);}}).catch(function(err){console.log('err: ',err);});}},{key:\"clockOut\",value:function clockOut(staff_id,time){var _this4=this;var isConnected=this.props.class.isConnected;if(!isConnected){Toast.show({text:'拍謝 網路連不到! 等一下再試試看',buttonText:'Okay',position:\"top\",type:\"warning\",duration:5000});return;}var attendance_id=this.props.class.teachers[staff_id].attendance_id;var query=\"https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/dev/staff-attendance/\"+attendance_id;fetch(query,{method:'PUT',headers:{Accept:'application/json','Content-Type':'application/json'}}).then(function(res){return res.json();}).then(function(resJson){var statusCode=resJson.statusCode,message=resJson.message;if(statusCode>200||message===\"Internal server error\"){_this4.props.markStaffAttendanceFail(message);}else{_this4.props.markTeacherLoggedOut(staff_id,time);}}).catch(function(err){console.log('err: ',err);});}},{key:\"hideLoginPad\",value:function hideLoginPad(){this.setState({logging_in:false});}},{key:\"render\",value:function render(){var _this5=this;var errMessage=this.props.class.errMessage;return React.createElement(Container,null,errMessage!==''?React.createElement(Text,{style:{fontSize:20,color:'red'}},errMessage):null,this.state.logging_in?React.createElement(LoginNumberPad,{handleEnterPasscode:function handleEnterPasscode(passcode){return _this5.handleEnterPasscode(passcode);},hideLoginPad:this.hideLoginPad}):null,React.createElement(Content,{contentContainerStyle:{marginTop:30,paddingBottom:30,alignSelf:'center',flexDirection:'row'}},Object.keys(this.props.class.teachers).map(function(teacher_id){return React.createElement(TouchableHighlight,{key:teacher_id,style:{margin:20},underlayColor:\"transparent\",onPress:function onPress(){return _this5.setState({logging_in:true,teacher_id:teacher_id});}},React.createElement(View,{style:styles.cardContainer},React.createElement(Card,null,React.createElement(CardItem,{style:{justifyContent:'center'}},React.createElement(Image,{style:styles.thumbnailImage})),React.createElement(CardItem,{footer:true,style:{justifyContent:'center',backgroundColor:_this5.props.class.teachers[teacher_id].logged_in?'#dcf3d0':'#ffe1d0'}},React.createElement(Text,null,_this5.props.class.teachers[teacher_id].name)))));})));}}]);return TeacherClockInOut;}(React.Component);var styles=StyleSheet.create({cardContainer:{width:119,height:150,margin:2,marginBottom:-2},thumbnailImage:{height:80,width:80,borderRadius:40}});var mapStateToProps=function mapStateToProps(state){return{class:state.classInfo};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return _objectSpread({},bindActionCreators({markTeacherLoggedIn:markTeacherLoggedIn,markTeacherLoggedOut:markTeacherLoggedOut,markStaffAttendanceFail:markStaffAttendanceFail,fetchAttendanceSuccess:fetchAttendanceSuccess},dispatch));};export default connect(mapStateToProps,mapDispatchToProps)(TeacherClockInOut);","map":{"version":3,"sources":["/home/caleb_lee/gina_web_app/components/teacher/teacherclockinout.js"],"names":["React","Container","Content","Text","View","Card","CardItem","Toast","connect","LoginNumberPad","bindActionCreators","markTeacherLoggedIn","markTeacherLoggedOut","markStaffAttendanceFail","fetchAttendanceSuccess","TeacherClockInOut","props","state","logging_in","teacher_id","handleEnterPasscode","bind","hideLoginPad","fetchStaffAttendanceByClassId","class","class_id","isConnected","show","text","buttonText","position","type","duration","query","fetch","method","headers","Accept","then","res","json","resJson","data","catch","err","console","log","passcode","passcodeTeacherId","undefined","teacher","teachers","time","Date","logged_in","clockOut","clockIn","setState","staff_id","body","JSON","stringify","statusCode","message","attendance_id","errMessage","fontSize","color","marginTop","paddingBottom","alignSelf","flexDirection","Object","keys","map","margin","styles","cardContainer","justifyContent","thumbnailImage","backgroundColor","name","Component","StyleSheet","create","width","height","marginBottom","borderRadius","mapStateToProps","classInfo","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { StyleSheet, Image, TouchableHighlight } from 'react-native'\nimport { Container, Content, Text, View, Card, CardItem, Toast } from 'native-base'\nimport { connect } from 'react-redux'\nimport LoginNumberPad from './loginnumberpad'\nimport { bindActionCreators } from 'redux';\nimport { markTeacherLoggedIn, markTeacherLoggedOut, markStaffAttendanceFail, fetchAttendanceSuccess } from '../../redux/school/actions/index'\n\nclass TeacherClockInOut extends React.Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            logging_in: false,\n            teacher_id: ''\n        }\n        this.handleEnterPasscode = this.handleEnterPasscode.bind(this)\n        this.hideLoginPad = this.hideLoginPad.bind(this)\n    }\n\n    componentDidMount() {\n        this.fetchStaffAttendanceByClassId()\n    }\n\n    fetchStaffAttendanceByClassId() {\n        const { class_id, isConnected } = this.props.class\n        if (!isConnected) {\n            Toast.show({\n                text: '拍謝 網路連不到! 等一下再試試看',\n                buttonText: 'Okay',\n                position: \"top\",\n                type: \"warning\",\n                duration: 5000\n            })\n            return\n        }\n        const query = `https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/dev/staff-attendance?class_id=${class_id}`\n        fetch(query, {\n            method: 'GET',\n            headers: {\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            }\n        })\n            .then(res => res.json())\n            .then(resJson => {\n                this.props.fetchAttendanceSuccess(resJson.data)\n            })\n            .catch(err => {\n                console.log('err: ', err)\n            })\n\n    }\n\n    handleEnterPasscode(passcode) {\n        const teacher_id = this.props.class.passcodeTeacherId[passcode]\n        if (teacher_id === undefined || teacher_id !== this.state.teacher_id) {\n            Toast.show({\n                text: 'Wrong password!',\n                buttonText: 'Okay',\n                position: \"top\",\n                type: \"warning\",\n                duration: 3000\n            })\n        } else {\n            const teacher = this.props.class.teachers[teacher_id]\n            const time = new Date()\n            if (teacher.logged_in) {\n                this.clockOut(teacher_id, time)\n            } else {\n                this.clockIn(teacher_id, time)\n            }\n            this.setState({ logging_in: false })\n        }\n        \n    }\n\n    clockIn(staff_id, time) {\n        const { isConnected } = this.props.class\n        if (!isConnected) {\n            Toast.show({\n                text: '拍謝 網路連不到! 等一下再試試看',\n                buttonText: 'Okay',\n                position: \"top\",\n                type: \"warning\",\n                duration: 5000\n            })\n            return\n        }\n        const query = `https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/dev/staff-attendance`\n        fetch(query, {\n            method: 'POST',\n            headers: {\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                staff_id\n            })\n        })\n            .then(res => res.json())\n            .then(resJson => {\n                const { statusCode, message, data } = resJson\n                if ( statusCode > 200 || resJson[\"message\"] === \"Internal server error\") {\n                    this.props.markStaffAttendanceFail(message)\n                } else {\n                    this.props.markTeacherLoggedIn(staff_id, time, data.attendance_id)\n                }\n            })\n            .catch(err => {\n                console.log('err: ', err)\n            })\n    }\n\n    clockOut(staff_id, time) {\n        const { isConnected } = this.props.class\n        if (!isConnected) {\n            Toast.show({\n                text: '拍謝 網路連不到! 等一下再試試看',\n                buttonText: 'Okay',\n                position: \"top\",\n                type: \"warning\",\n                duration: 5000\n            })\n            return\n        }\n\n        const { attendance_id } = this.props.class.teachers[staff_id]\n        const query = `https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/dev/staff-attendance/${attendance_id}`\n        fetch(query, {\n            method: 'PUT',\n            headers: {\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            }\n        })\n            .then(res => res.json())\n            .then(resJson => {\n                const { statusCode, message } = resJson\n                if (statusCode > 200 || message === \"Internal server error\") {\n                    this.props.markStaffAttendanceFail(message)\n                }\n                else {\n                    this.props.markTeacherLoggedOut(staff_id, time)\n                }\n            })\n            .catch(err => {\n                console.log('err: ', err)\n            })\n    }\n\n    hideLoginPad() {\n        this.setState({ logging_in: false })\n    }\n\n    render() {\n        const { errMessage } = this.props.class\n        return(\n            <Container>\n                {errMessage !== '' ?    \n                    <Text style={{ fontSize: 20, color: 'red' }}>{errMessage}</Text>\n                    : null}\n                {this.state.logging_in ?\n                    <LoginNumberPad\n                        handleEnterPasscode={(passcode) => this.handleEnterPasscode(passcode)}\n                        hideLoginPad={this.hideLoginPad}\n                    /> : null}\n                        \n                <Content contentContainerStyle={{ marginTop: 30, paddingBottom: 30, alignSelf: 'center', flexDirection: 'row' }}>\n                    {Object.keys(this.props.class.teachers).map((teacher_id) => {\n                        return (\n                            <TouchableHighlight\n                                key={teacher_id}\n                                style={{ margin: 20 }}\n                                underlayColor='transparent'\n                                onPress={() => this.setState({ logging_in: true, teacher_id: teacher_id})}\n                            >\n                                <View style={styles.cardContainer}>\n                                    <Card>\n                                        <CardItem style={{ justifyContent: 'center' }}>\n                                            <Image\n                                                // source={{ uri: this.props.class.students[student_id].profile_picture }}\n                                                style={styles.thumbnailImage}/>\n                                        </CardItem>\n                                        <CardItem\n                                            footer\n                                            style={{ justifyContent: 'center', backgroundColor: this.props.class.teachers[teacher_id].logged_in ? '#dcf3d0' : '#ffe1d0' }}>\n                                            <Text>{this.props.class.teachers[teacher_id].name}</Text>\n                                        </CardItem>\n                                    </Card>\n                                </View>\n                            </TouchableHighlight>\n                        )\n                    })}\n                </Content>\n            </Container>\n        )\n    }\n}\n\nconst styles = StyleSheet.create({\n    cardContainer: {\n        width: 119,\n        height: 150,\n        margin: 2,\n        marginBottom: -2\n    },\n    thumbnailImage: {\n        height: 80,\n        width: 80,\n        borderRadius: 40\n    }\n})\n\nconst mapStateToProps = (state) => {\n    return {\n        class: state.classInfo\n    }\n}\n\nconst mapDispatchToProps = (dispatch) => {\n    return {\n        ...bindActionCreators({markTeacherLoggedIn, markTeacherLoggedOut, markStaffAttendanceFail, fetchAttendanceSuccess}, dispatch)\n    }\n}\nexport default connect(mapStateToProps, mapDispatchToProps) (TeacherClockInOut)"]},"metadata":{},"sourceType":"module"}