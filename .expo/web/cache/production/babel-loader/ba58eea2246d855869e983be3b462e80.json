{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _inherits from\"@babel/runtime/helpers/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import React from'react';import View from\"react-native-web/dist/exports/View\";import TouchableOpacity from\"react-native-web/dist/exports/TouchableOpacity\";import Text from\"react-native-web/dist/exports/Text\";import Animated from\"react-native-web/dist/exports/Animated\";import ScrollView from\"react-native-web/dist/exports/ScrollView\";import Alert from\"react-native-web/dist/exports/Alert\";import KeyboardAvoidingView from\"react-native-web/dist/exports/KeyboardAvoidingView\";import Platform from\"react-native-web/dist/exports/Platform\";import Dimensions from\"react-native-web/dist/exports/Dimensions\";import AbsenceExcuse from\"./absenceexcuse\";import{formatDate}from\"../util\";import ENV from\"../../variables\";import{connect}from'react-redux';var _Dimensions$get=Dimensions.get('window'),height=_Dimensions$get.height;var AbsenceExcusePage=function(_React$Component){_inherits(AbsenceExcusePage,_React$Component);var _super=_createSuper(AbsenceExcusePage);function AbsenceExcusePage(props){var _this;_classCallCheck(this,AbsenceExcusePage);_this=_super.call(this,props);_this.state={todays_date:formatDate(new Date()),SlideInRight:new Animated.Value(0),SlideInLeft:new Animated.Value(0),total_height:1,total_width:1,height:0,width:0,left:0,top:0,requests:[],day_of_week:['天','一','二','三','四','五','六'],selected_request_index:-1};return _this;}_createClass(AbsenceExcusePage,[{key:\"componentDidMount\",value:function componentDidMount(){var isConnected=this.props.isConnected;if(!isConnected){alert('網路連不到! 請稍後再試試看');return;}this.fetchAbsenceExcuse();this.initializePage();}},{key:\"isIOS\",value:function isIOS(){return Platform.OS==='ios';}},{key:\"fetchAbsenceExcuse\",value:function fetchAbsenceExcuse(){var _this2=this;var student_id,date,query;return _regeneratorRuntime.async(function fetchAbsenceExcuse$(_context){while(1){switch(_context.prev=_context.next){case 0:student_id=this.props.route.params.student_id;date=formatDate(new Date());query=\"https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/\"+ENV+\"/absence-excuse/student/\"+student_id+\"?date=\"+date;_context.next=5;return _regeneratorRuntime.awrap(fetch(query,{method:'GET',headers:{Accept:'application/json','Content-Type':'application/json'}}).then(function(res){return res.json();}).then(function(resJson){var statusCode=resJson.statusCode,message=resJson.message,data=resJson.data;if(statusCode>200||message==='Internal server error'){alert('Sorry 電腦出狀況了！請截圖和與工程師聯繫'+message);return;}_this2.denormalize(data);_this2.setState({requests:data});}).catch(function(err){alert('Sorry 電腦出狀況了！請截圖和與工程師聯繫: error occurred when fetching absence request');}));case 5:case\"end\":return _context.stop();}}},null,this,null,Promise);}},{key:\"denormalize\",value:function denormalize(data){for(var i=0;i<data.length;i++){data[i].date=new Date(data[i].date);}}},{key:\"initializePage\",value:function initializePage(){Animated.sequence([Animated.timing(this.state.SlideInRight,{toValue:1,duration:1000,useNativeDriver:true}),Animated.timing(this.state.SlideInLeft,{toValue:1,duration:1000,useNativeDriver:true})]).start();}},{key:\"selectRequest\",value:function selectRequest(index){var access_mode=this.refs['main'].fetchAccessMode();if(access_mode==='edit'){alert('還在編輯中喔請完成再離開 多謝');return;}this.setState({selected_request_index:index});}},{key:\"onCreateRequestSuccess\",value:function onCreateRequestSuccess(request_id){var requests,new_request_index,i;return _regeneratorRuntime.async(function onCreateRequestSuccess$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return _regeneratorRuntime.awrap(this.fetchAbsenceExcuse());case 2:requests=this.state.requests;new_request_index=-1;i=0;case 5:if(!(i<requests.length)){_context2.next=12;break;}if(!(requests[i].id===request_id)){_context2.next=9;break;}new_request_index=i;return _context2.abrupt(\"break\",12);case 9:i++;_context2.next=5;break;case 12:this.setState({selected_request_index:new_request_index});case 13:case\"end\":return _context2.stop();}}},null,this,null,Promise);}},{key:\"onDeleteRequestSuccess\",value:function onDeleteRequestSuccess(deleted_request_id){var requests=this.state.requests;var updated_requests=[];for(var i=0;i<requests.length;i++){if(requests[i].id!==deleted_request_id){updated_requests.push(requests[i]);}}this.setState({requests:updated_requests,selected_request_index:0});}},{key:\"checkUniqueStudentDate\",value:function checkUniqueStudentDate(id,date){var requests=this.state.requests;var duplicateDateFound=false;for(var i=0;i<requests.length;i++){if(id!==requests[i].id&&formatDate(date)===formatDate(requests[i].date)){duplicateDateFound=true;break;}}if(!duplicateDateFound){return;}alert('已經在這個日期請過假了');this.refs['main'].duplicateDateFound();}},{key:\"render\",value:function render(){var _this3=this;var _this$state=this.state,SlideInRight=_this$state.SlideInRight,SlideInLeft=_this$state.SlideInLeft,total_width=_this$state.total_width,requests=_this$state.requests,todays_date=_this$state.todays_date,day_of_week=_this$state.day_of_week,selected_request_index=_this$state.selected_request_index;var _this$props$route$par=this.props.route.params,student_id=_this$props$route$par.student_id,class_id=_this$props$route$par.class_id,school_id=_this$props$route$par.school_id;var selected_request=requests[selected_request_index];return React.createElement(KeyboardAvoidingView,{style:{flex:1,width:'100%',alignItems:'center'},behavior:'padding',keyboardVerticalOffset:85,enabled:true},React.createElement(ScrollView,{style:{width:'100%'}},React.createElement(View,{style:{width:'100%'}},React.createElement(ScrollView,{horizontal:true,showsHorizontalScrollIndicator:false},requests.map(function(request,index){var day=day_of_week[request.date.getDay()];var date=request.date.getMonth()+1+\"/\"+request.date.getDate();return React.createElement(Animated.View,{key:request.id,style:{padding:10,transform:[{translateX:SlideInRight.interpolate({inputRange:[0,1],outputRange:[total_width,0]})}]}},React.createElement(TouchableOpacity,{style:{height:100,width:100,padding:10,backgroundColor:selected_request_index===index?'#368cbf':'rgba(0,0,0,0.2)',borderRadius:10},underlayColor:\"#368cbf\",onClick:function onClick(){return _this3.selectRequest(index);}},React.createElement(View,null,formatDate(request.date)===todays_date?React.createElement(Text,{style:{fontSize:20,color:selected_request_index===index?'white':'black'}},\"\\u4ECA\\u5929\"):React.createElement(Text,{style:{fontSize:20,color:selected_request_index===index?'white':'black'}},\"\\u661F\\u671F\",day),React.createElement(Text,{style:{fontSize:20,color:selected_request_index===index?'white':'black'}},date))));}),React.createElement(Animated.View,{style:{padding:10,transform:[{translateX:SlideInRight.interpolate({inputRange:[0,1],outputRange:[total_width,0]})}]}},React.createElement(TouchableOpacity,{style:{height:100,width:100,padding:10,backgroundColor:selected_request_index===-1?'#368cbf':'rgba(0,0,0,0.2)',borderRadius:10},underlayColor:\"#ff8944\",ref:'welrnf',onClick:function onClick(){return _this3.selectRequest(-1);}},React.createElement(View,null,React.createElement(Text,{style:{fontSize:20,color:selected_request_index===-1?'white':'black'}},\"\\u65B0\\u589E\")))))),React.createElement(View,{style:{width:'100%',borderRadius:40,backgroundColor:'#b5e9e9'}},React.createElement(AbsenceExcuse,{ref:\"main\",student_id:student_id,class_id:class_id,school_id:school_id,request:selected_request,onCreateRequestSuccess:function onCreateRequestSuccess(request_id){return _this3.onCreateRequestSuccess(request_id);},onDeleteRequestSuccess:function onDeleteRequestSuccess(deleted_request_id){return _this3.onDeleteRequestSuccess(deleted_request_id);},checkUniqueStudentDate:function checkUniqueStudentDate(id,date){return _this3.checkUniqueStudentDate(id,date);}}))));}}]);return AbsenceExcusePage;}(React.Component);var mapStateToProps=function mapStateToProps(state){return{isConnected:state.parent.isConnected};};export default connect(mapStateToProps)(AbsenceExcusePage);","map":{"version":3,"sources":["/home/caleb_lee/gina_web_app/components/parent/absenceexcusepage.js"],"names":["React","AbsenceExcuse","formatDate","ENV","connect","Dimensions","get","height","AbsenceExcusePage","props","state","todays_date","Date","SlideInRight","Animated","Value","SlideInLeft","total_height","total_width","width","left","top","requests","day_of_week","selected_request_index","isConnected","alert","fetchAbsenceExcuse","initializePage","Platform","OS","student_id","route","params","date","query","fetch","method","headers","Accept","then","res","json","resJson","statusCode","message","data","denormalize","setState","catch","err","i","length","sequence","timing","toValue","duration","useNativeDriver","start","index","access_mode","refs","fetchAccessMode","request_id","new_request_index","id","deleted_request_id","updated_requests","push","duplicateDateFound","class_id","school_id","selected_request","flex","alignItems","map","request","day","getDay","getMonth","getDate","padding","transform","translateX","interpolate","inputRange","outputRange","backgroundColor","borderRadius","selectRequest","fontSize","color","onCreateRequestSuccess","onDeleteRequestSuccess","checkUniqueStudentDate","Component","mapStateToProps","parent"],"mappings":"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","sourcesContent":["import React from 'react'\nimport {\n    View, TouchableOpacity, Text, Animated, ScrollView, Alert, KeyboardAvoidingView, Platform, Dimensions\n} from 'react-native'\nimport AbsenceExcuse from './absenceexcuse'\nimport { formatDate } from '../util'\nimport ENV from '../../variables'\nimport { connect } from 'react-redux'\n\nconst { height } = Dimensions.get('window')\n\nclass AbsenceExcusePage extends React.Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            todays_date: formatDate(new Date()),\n            SlideInRight: new Animated.Value(0),\n            SlideInLeft: new Animated.Value(0),\n            total_height: 1,\n            total_width: 1,\n            height: 0,\n            width: 0,\n            left: 0,\n            top: 0,\n            requests: [],\n            day_of_week: ['天', '一', '二', '三', '四', '五', '六'],\n            selected_request_index: -1\n        }\n    }\n\n    componentDidMount() {\n        const { isConnected } = this.props\n        if (!isConnected) {\n            alert('網路連不到! 請稍後再試試看')\n            return\n        }\n        this.fetchAbsenceExcuse()\n        this.initializePage()\n    }\n\n    isIOS() {\n        return Platform.OS === 'ios'\n    }\n\n    async fetchAbsenceExcuse() {\n        const { student_id } = this.props.route.params\n        const date = formatDate(new Date())\n        const query = `https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/${ENV}/absence-excuse/student/${student_id}?date=${date}`\n        await fetch(query, {\n            method: 'GET',\n            headers: {\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            }\n        })\n            .then(res => res.json())\n            .then(resJson => {\n                const { statusCode, message, data } = resJson\n                if (statusCode > 200 || message === 'Internal server error') {\n                    alert('Sorry 電腦出狀況了！請截圖和與工程師聯繫' + message)\n                    return\n                }\n                this.denormalize(data)\n                this.setState({ requests: data })\n            })\n            .catch(err => {\n                alert('Sorry 電腦出狀況了！請截圖和與工程師聯繫: error occurred when fetching absence request')\n            })\n    }\n\n    denormalize(data) {\n        for (var i = 0; i < data.length; i++) {\n            data[i].date = new Date(data[i].date)\n        }\n    }\n\n    initializePage() {\n        Animated.sequence([\n            Animated.timing(\n                this.state.SlideInRight, \n                {\n                    toValue: 1,\n                    duration: 1000,\n                    useNativeDriver: true\n                }\n            ),\n            Animated.timing(\n                this.state.SlideInLeft,\n                {\n                    toValue: 1,\n                    duration: 1000,\n                    useNativeDriver: true\n                }\n            )\n        ]).start()\n        \n    }\n\n    selectRequest(index) {\n        const access_mode = this.refs['main'].fetchAccessMode()\n        if (access_mode === 'edit') {\n            alert('還在編輯中喔請完成再離開 多謝')\n            return\n        }\n        this.setState({ selected_request_index: index })\n    }\n\n    async onCreateRequestSuccess(request_id) {\n        await this.fetchAbsenceExcuse()\n        const { requests } = this.state\n        let new_request_index = -1\n        for (var i = 0; i < requests.length; i++) {\n            if (requests[i].id === request_id) {\n                new_request_index = i\n                break\n            }\n        }\n        this.setState({\n            selected_request_index: new_request_index\n        })\n    }\n\n    onDeleteRequestSuccess(deleted_request_id) {\n        const { requests } = this.state\n        const updated_requests = []\n        for (var i = 0; i < requests.length; i++) {\n            if (requests[i].id !== deleted_request_id) {\n                updated_requests.push(requests[i])\n            }\n        }\n        this.setState({\n            requests: updated_requests,\n            selected_request_index: 0\n        })\n    }\n\n    checkUniqueStudentDate(id, date) {\n        const { requests } = this.state\n        var duplicateDateFound = false\n        for (var i = 0; i < requests.length; i++) {\n            if (id !== requests[i].id && formatDate(date) === formatDate(requests[i].date)) {\n                duplicateDateFound = true\n                break\n            }\n        }\n\n        if (!duplicateDateFound) {\n            return\n        }\n\n        alert('已經在這個日期請過假了')\n\n        this.refs['main'].duplicateDateFound()\n    }\n\n    render () {\n        const { SlideInRight, SlideInLeft, total_width, requests, todays_date, day_of_week, selected_request_index } = this.state\n        const { student_id, class_id, school_id } = this.props.route.params\n        const selected_request = requests[selected_request_index]\n        return (\n            <KeyboardAvoidingView\n                style={{flex: 1, width: '100%', alignItems: 'center' }}\n                behavior={'padding'}\n                keyboardVerticalOffset={85}\n                enabled\n            >\n                <ScrollView style={{ width: '100%'}}>\n                <View style={{ width: '100%' }}>\n                    <ScrollView\n                        horizontal\n                        showsHorizontalScrollIndicator={false}\n                    >\n                        {requests.map((request, index) => {\n                            const day = day_of_week[request.date.getDay()]\n                            const date = `${request.date.getMonth()+1}/${request.date.getDate()}`\n                            return (\n                                <Animated.View\n                                    key={request.id}\n                                    style={{\n                                        padding: 10,\n                                        transform: [\n                                            {\n                                                translateX: SlideInRight.interpolate({\n                                                    inputRange: [0,1],\n                                                    outputRange: [total_width, 0]\n                                                })\n                                            }\n                                        ]\n                                    }}\n                                >\n                                    <TouchableOpacity\n                                        style={{\n                                            height: 100,\n                                            width: 100,\n                                            padding: 10,\n                                            backgroundColor: selected_request_index === index ? '#368cbf' : 'rgba(0,0,0,0.2)',\n                                            borderRadius: 10\n                                        }}\n                                        underlayColor='#368cbf'\n                                        onClick={() => this.selectRequest(index)}\n                                    >\n                                        <View>\n                                            {formatDate(request.date) === todays_date ?\n                                                <Text style={{ fontSize: 20, color: selected_request_index === index ? 'white' : 'black' }}>今天</Text>\n                                                : <Text style={{ fontSize: 20, color: selected_request_index === index ? 'white' : 'black' }}>星期{day}</Text>\n                                            }\n                                            <Text style={{ fontSize: 20, color: selected_request_index === index ? 'white' : 'black' }}>{date}</Text>\n                                        </View>\n                                    </TouchableOpacity>\n                                </Animated.View>\n                            )\n                        })}\n                        \n                        <Animated.View\n                            style={{\n                                padding: 10,\n                                transform: [\n                                    {\n                                        translateX: SlideInRight.interpolate({\n                                            inputRange: [0,1],\n                                            outputRange: [total_width, 0]\n                                        })\n                                    }\n                                ]\n                            }}\n                        >\n                            <TouchableOpacity\n                                style={{\n                                    height: 100,\n                                    width: 100,\n                                    padding: 10,\n                                    backgroundColor: selected_request_index === -1 ? '#368cbf' : 'rgba(0,0,0,0.2)',\n                                    borderRadius: 10\n                                }}\n                                underlayColor='#ff8944'\n                                ref={'welrnf'}\n                                onClick={() => this.selectRequest(-1)}\n                            >\n                                <View>\n                                    <Text style={{ fontSize: 20, color: selected_request_index === -1 ? 'white' : 'black' }}>新增</Text>\n                                </View>\n                            </TouchableOpacity>\n                        </Animated.View>\n                    </ScrollView>\n                </View>\n\n                <View\n                    style={{\n                        width: '100%',\n                        borderRadius: 40,\n                        backgroundColor: '#b5e9e9'\n                    }}  \n                >\n                    <AbsenceExcuse\n                        ref='main'\n                        student_id={student_id}\n                        class_id={class_id}\n                        school_id={school_id}\n                        request={selected_request}\n                        onCreateRequestSuccess={(request_id) => this.onCreateRequestSuccess(request_id)}\n                        onDeleteRequestSuccess={(deleted_request_id) => this.onDeleteRequestSuccess(deleted_request_id)}\n                        checkUniqueStudentDate={(id, date) => this.checkUniqueStudentDate(id, date)}\n                    />\n                </View>\n                </ScrollView>\n            </KeyboardAvoidingView>\n        )\n    }\n}\n\nconst mapStateToProps = (state) => {\n    return {\n        isConnected: state.parent.isConnected\n    }\n}\n\nexport default connect(mapStateToProps) (AbsenceExcusePage)"]},"metadata":{},"sourceType":"module"}