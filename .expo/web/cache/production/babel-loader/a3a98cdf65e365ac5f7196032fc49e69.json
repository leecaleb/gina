{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _inherits from\"@babel/runtime/helpers/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import React from'react';import View from\"react-native-web/dist/exports/View\";import Image from\"react-native-web/dist/exports/Image\";import Text from\"react-native-web/dist/exports/Text\";import TouchableHighlight from\"react-native-web/dist/exports/TouchableHighlight\";import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import KeyboardAvoidingView from\"react-native-web/dist/exports/KeyboardAvoidingView\";import Alert from\"react-native-web/dist/exports/Alert\";import TextInput from\"react-native-web/dist/exports/TextInput\";import{Toast}from'native-base';import{connect}from'react-redux';import{bindActionCreators}from'redux';import WellnessForm from\"./wellnessform\";import{sendWellnessData,formatDate,post,formatTime,put}from\"../util\";import{markPresent,sendWellnessDataFail,editTeacherOnDuty}from\"../../redux/school/actions/index\";var TeacherModal=function(_React$Component){_inherits(TeacherModal,_React$Component);var _super=_createSuper(TeacherModal);function TeacherModal(props){var _this;_classCallCheck(this,TeacherModal);_this=_super.call(this,props);_this.state={temperature:''};return _this;}_createClass(TeacherModal,[{key:\"editTemperature\",value:function editTemperature(temperature){var normalized_temperature=temperature.slice(-1)==='.'?temperature.slice(0,2):temperature.length===3?temperature.slice(0,2)+'.'+temperature.slice(-1):temperature;this.setState({temperature:normalized_temperature});}},{key:\"clock\",value:function clock(){var _this$props=this.props,isConnected=_this$props.isConnected,teacher_id=_this$props.teacher_id,teachers=_this$props.teachers;var teacher=teachers[teacher_id];if(!isConnected){Toast.show({text:'拍謝 網路連不到! 等一下再試試看',buttonText:'Okay',position:\"top\",type:\"warning\",duration:2000});return;}if(teacher.present){var attendance_id=teacher.attendance[teacher.attendance.length-1];this.clockout(attendance_id);}else{this.clockin();}}},{key:\"clockout\",value:function clockout(attendance_id){var response,success,statusCode,message,data;return _regeneratorRuntime.async(function clockout$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return _regeneratorRuntime.awrap(put(\"/staff-attendance/\"+attendance_id,{out_time:formatDate(new Date())+' '+formatTime(new Date())}));case 2:response=_context.sent;success=response.success,statusCode=response.statusCode,message=response.message,data=response.data;if(!success){Alert.alert('Sorry 打卡時電腦出狀況了！','請截圖和與工程師聯繫\\n\\n'+message,[{text:'Ok'}]);}this.props.fetchTeacherAttendance();this.props.hideModal();case 7:case\"end\":return _context.stop();}}},null,this,null,Promise);}},{key:\"clockin\",value:function clockin(){var _this$props2,isConnected,teacher_id,temperature,response,success,statusCode,message,data;return _regeneratorRuntime.async(function clockin$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_this$props2=this.props,isConnected=_this$props2.isConnected,teacher_id=_this$props2.teacher_id;temperature=this.state.temperature;if(!isConnected){Toast.show({text:'拍謝 網路連不到! 等一下再試試看',buttonText:'Okay',position:\"top\",type:\"warning\",duration:2000});}_context2.next=5;return _regeneratorRuntime.awrap(post('/staff-attendance',{teacher_id:teacher_id,in_time:formatDate(new Date())+' '+formatTime(new Date()),temperature:temperature?temperature:0}));case 5:response=_context2.sent;success=response.success,statusCode=response.statusCode,message=response.message,data=response.data;if(success){_context2.next=10;break;}Alert.alert('Sorry 打卡時電腦出狀況了！','請截圖和與工程師聯繫\\n\\n'+message,[{text:'Ok'}]);return _context2.abrupt(\"return\");case 10:this.props.fetchTeacherAttendance();this.props.hideModal();case 12:case\"end\":return _context2.stop();}}},null,this,null,Promise);}},{key:\"editTeacherOnDuty\",value:function editTeacherOnDuty(teacher_id){var _this$props3=this.props,teacherOnDuty=_this$props3.teacherOnDuty,teachers=_this$props3.teachers;var name='未登入';if(teacherOnDuty===teacher_id){this.props.editTeacherOnDuty('');}else{this.props.editTeacherOnDuty(teacher_id);name=teachers[teacher_id].name;}this.props.navigation.setOptions({headerRight:function headerRight(){return React.createElement(View,{style:{paddingRight:20}},React.createElement(Text,{style:{fontSize:30}},\"\\u503C\\u73ED\\u8001\\u5E2B\\uFF1A\"+name));}});}},{key:\"render\",value:function render(){var _this2=this;var _this$props4=this.props,show=_this$props4.show,student_id=_this$props4.student_id,teacher_id=_this$props4.teacher_id,teachers=_this$props4.teachers,unmarked=_this$props4.unmarked,absent=_this$props4.absent,teacherOnDuty=_this$props4.teacherOnDuty,attendance=_this$props4.attendance;var temperature=this.state.temperature;var teacher=teachers[teacher_id];return React.createElement(View,{style:{flex:1,width:'80%',height:'70%',backgroundColor:absent.has(teacher_id)?'#ffe1d0':unmarked.has(teacher_id)?'#fff1b5':'#dcf3d0',zIndex:3,position:'absolute'}},React.createElement(View,{style:{flex:3,flexDirection:'row',justifyContent:'space-evenly',alignItems:'center'}},React.createElement(View,{style:{flex:1,alignItems:'center'}},React.createElement(Image,{source:teacher.profile_picture===''?require(\"../../assets/icon-teacher-thumbnail.png\"):{uri:teacher.profile_picture},style:styles.thumbnailImage}),React.createElement(TextInput,{style:{fontSize:60},keyboardType:\"decimal-pad\",placeholder:\"\\u9AD4\\u6EAB\",value:''+temperature,onChangeText:function onChangeText(temperature){return _this2.editTemperature(temperature);}})),React.createElement(View,{style:{flex:1}},React.createElement(Text,{style:{fontSize:60}},teacher.name),React.createElement(TouchableHighlight,{onPress:function onPress(){return _this2.editTeacherOnDuty(teacher_id);},underlayColor:\"transparent\"},React.createElement(View,{style:{flexDirection:'row',alignItems:'center'}},React.createElement(Image,{source:teacherOnDuty===teacher_id?require(\"../../assets/icon-checked-box.png\"):require(\"../../assets/icon-unchecked-box.png\"),style:{width:80,aspectRatio:1}}),React.createElement(Text,{style:{fontSize:40}},\"\\u503C\\u73ED\\u8001\\u5E2B\"))))),React.createElement(View,{style:{flex:2,paddingHorizontal:30,justifyContent:'space-evenly',alignItems:'center'}},teacher.attendance&&teacher.attendance.map(function(attendance_id){var record=attendance[attendance_id];return React.createElement(View,{key:attendance_id,style:{flex:1,flexDirection:'row',width:'60%',justifyContent:'space-around'}},React.createElement(View,{style:{flex:1}},React.createElement(Text,{style:{fontSize:50}},record.in_time)),React.createElement(View,{style:{flex:1}},React.createElement(Text,{style:{fontSize:50}},record.out_time)));}),React.createElement(View,{style:{flexDirection:'row',alignSelf:'flex-end',backgroundColor:'white',padding:10}},React.createElement(Text,{style:{fontSize:25}},\"\\u4ECA\\u65E5\\u7E3D\\u8A08: \",Math.round(teacher.total_minutes*100)/100))),React.createElement(View,{style:{flex:1,flexDirection:'row',alignItems:'center'}},React.createElement(View,{style:{flex:1,flexDirection:'row',alignItems:'center'}},React.createElement(TouchableHighlight,{style:{backgroundColor:'red',flex:1,height:80,justifyContent:'center',alignItems:'center',margin:8},onPress:this.props.hideModal},React.createElement(Text,{style:{fontSize:40}},\"\\u53D6\\u6D88\")),React.createElement(TouchableHighlight,{style:{backgroundColor:'grey',flex:1,height:80,justifyContent:'center',alignItems:'center',margin:8},onPress:function onPress(){return _this2.clock();}},React.createElement(Text,{style:{fontSize:40}},\"\\u6253\\u5361\")))));}}]);return TeacherModal;}(React.Component);var styles=StyleSheet.create({thumbnailImage:{width:200,height:200,borderRadius:100}});var mapStateToProps=function mapStateToProps(state){return{attendance:state.school.attendance,teachers:state.school.teachers,teacherOnDuty:state.school.teacherOnDuty,unmarked:state.school.teacher_unmarked,absent:state.school.teacher_absent,isConnected:state.school.isConnected};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return _objectSpread({},bindActionCreators({markPresent:markPresent,sendWellnessDataFail:sendWellnessDataFail,editTeacherOnDuty:editTeacherOnDuty},dispatch));};export default connect(mapStateToProps,mapDispatchToProps)(TeacherModal);","map":{"version":3,"sources":["/home/caleb_lee/gina_web_app/components/teacher/teachermodal.js"],"names":["React","Toast","connect","bindActionCreators","WellnessForm","sendWellnessData","formatDate","post","formatTime","put","markPresent","sendWellnessDataFail","editTeacherOnDuty","TeacherModal","props","state","temperature","normalized_temperature","slice","length","setState","isConnected","teacher_id","teachers","teacher","show","text","buttonText","position","type","duration","present","attendance_id","attendance","clockout","clockin","out_time","Date","response","success","statusCode","message","data","Alert","alert","fetchTeacherAttendance","hideModal","in_time","teacherOnDuty","name","navigation","setOptions","headerRight","paddingRight","fontSize","student_id","unmarked","absent","flex","width","height","backgroundColor","has","zIndex","flexDirection","justifyContent","alignItems","profile_picture","require","uri","styles","thumbnailImage","editTemperature","aspectRatio","paddingHorizontal","map","record","alignSelf","padding","Math","round","total_minutes","margin","clock","Component","StyleSheet","create","borderRadius","mapStateToProps","school","teacher_unmarked","teacher_absent","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { View, Image, Text, TouchableHighlight, StyleSheet, KeyboardAvoidingView, Alert, TextInput } from 'react-native'\nimport { Toast } from 'native-base'\nimport { connect } from 'react-redux'\nimport { bindActionCreators } from 'redux'\nimport WellnessForm from './wellnessform'\nimport { sendWellnessData, formatDate, post, formatTime, put } from '../util'\nimport { markPresent, sendWellnessDataFail, editTeacherOnDuty } from '../../redux/school/actions/index'\n\nclass TeacherModal extends React.Component{\n  constructor(props) {\n    super(props)\n    this.state={\n        temperature: ''\n    }\n  }\n\n  editTemperature(temperature) {\n    const normalized_temperature = \n      temperature.slice(-1) === '.' ?\n        temperature.slice(0,2)\n        :\n      temperature.length === 3 ? \n        temperature.slice(0,2) + '.' + temperature.slice(-1)\n        : temperature\n      this.setState({ temperature: normalized_temperature })\n  }\n\n  clock() {\n    const { isConnected, teacher_id, teachers } = this.props\n    const teacher = teachers[teacher_id]\n\n    if (!isConnected) {\n      Toast.show({\n          text: '拍謝 網路連不到! 等一下再試試看',\n          buttonText: 'Okay',\n          position: \"top\",\n          type: \"warning\",\n          duration: 2000\n      })\n      return\n    }\n\n    if (teacher.present) {\n      const attendance_id = teacher.attendance[teacher.attendance.length - 1]\n      this.clockout(attendance_id)\n    } else {\n      this.clockin()\n    }\n  }\n\n  async clockout(attendance_id) {\n    const response = await put(`/staff-attendance/${attendance_id}`, {\n      out_time: formatDate(new Date()) + ' ' + formatTime(new Date())\n  })\n    const { success, statusCode, message, data } = response\n    if (!success) {\n      Alert.alert(\n        'Sorry 打卡時電腦出狀況了！',\n        '請截圖和與工程師聯繫\\n\\n' + message,\n        [{ text: 'Ok' }]\n      )\n    }\n\n    this.props.fetchTeacherAttendance()\n    this.props.hideModal()\n  }\n\n  async clockin() {\n    const { isConnected, teacher_id } = this.props\n    const { temperature } = this.state\n\n    if (!isConnected) {\n        Toast.show({\n            text: '拍謝 網路連不到! 等一下再試試看',\n            buttonText: 'Okay',\n            position: \"top\",\n            type: \"warning\",\n            duration: 2000\n        })\n    }\n\n    const response = await post('/staff-attendance', {\n        teacher_id,\n        in_time: formatDate(new Date()) + ' ' + formatTime(new Date()),\n        temperature: temperature ? temperature : 0\n    })\n\n    const { success, statusCode, message, data } = response\n    if (!success) {\n        Alert.alert(\n            'Sorry 打卡時電腦出狀況了！',\n            '請截圖和與工程師聯繫\\n\\n' + message,\n            [{ text: 'Ok' }]\n        )\n        return \n    }\n    this.props.fetchTeacherAttendance()\n    this.props.hideModal()\n  }\n\n  editTeacherOnDuty(teacher_id) {\n    const { teacherOnDuty, teachers } = this.props\n    var name = '未登入'\n    if (teacherOnDuty === teacher_id) {\n      this.props.editTeacherOnDuty('')\n    } else {\n      this.props.editTeacherOnDuty(teacher_id)\n      name = teachers[teacher_id].name\n    }\n    \n    this.props.navigation.setOptions({ \n        headerRight: () => (\n            <View style={{ paddingRight: 20 }}>\n                <Text style={{ fontSize: 30 }}>{`值班老師：${name}`}</Text>\n            </View>\n        )\n    })\n  }\n\n  // getTotalTime(record) {\n  //   const { teacher_id, teachers, attendance } = this.props\n  //   let total_hour = 0\n  //   let total_min = 0\n  //   for(var i = 0; i < teachers[teacher_id].attendance.length; i++){\n  //     const { in_time, out_time } = attendance[teachers[teacher_id].attendance[i]]\n  //     total_hour += parseInt(in_time)\n  //     total_min +=\n  //   }\n  // }\n\n  render() {\n    const { show, student_id, teacher_id, teachers, unmarked, absent, teacherOnDuty, attendance } = this.props\n    const { temperature } = this.state\n    const teacher = teachers[teacher_id]\n    // console.log('teacher: ', teacher)\n    // const { wellness } = this.props\n    // const record_id = wellness.by_student_id[student_id][0]\n    // TODO: temperature\n    return (\n        <View\n          style={{\n            flex: 1,\n            width: '80%',\n            height: '70%',\n            backgroundColor:\n              absent.has(teacher_id) ? '#ffe1d0'\n                : unmarked.has(teacher_id) ? '#fff1b5'\n                : '#dcf3d0',\n            zIndex: 3,\n            position: 'absolute'\n          }}\n        >\n          <View style={{ flex: 3, flexDirection: 'row', justifyContent: 'space-evenly', alignItems: 'center' }}>\n            <View style={{ flex: 1, alignItems: 'center' }}>\n              <Image\n                source={\n                    teacher.profile_picture === '' ?\n                      require('../../assets/icon-teacher-thumbnail.png')\n                      : {uri: teacher.profile_picture }\n              }\n                style={styles.thumbnailImage}\n              />\n              <TextInput\n              style={{ fontSize: 60 }}\n              keyboardType='decimal-pad'\n              placeholder='體溫'\n              value={'' + temperature}\n              onChangeText={(temperature) => this.editTemperature(temperature)}\n          />\n            </View>\n            <View style={{ flex: 1 }}>\n              <Text style={{ fontSize: 60 }}>{teacher.name}</Text>\n              <TouchableHighlight\n                onPress={() => this.editTeacherOnDuty(teacher_id)}\n                underlayColor='transparent'\n              >\n                <View style={{ flexDirection: 'row', alignItems: 'center' }}>\n                  <Image\n                    source={teacherOnDuty === teacher_id ? \n                      require('../../assets/icon-checked-box.png')\n                    : require('../../assets/icon-unchecked-box.png')}\n                    style={{ width: 80, aspectRatio: 1 }}\n                  />\n                  <Text style={{ fontSize: 40 }}>值班老師</Text>\n                </View>\n              </TouchableHighlight>\n            </View>\n          </View>\n          \n          <View style={{ flex: 2, paddingHorizontal: 30, justifyContent: 'space-evenly', alignItems: 'center' }}>\n            {teacher.attendance && teacher.attendance.map((attendance_id) => {\n              const record = attendance[attendance_id]\n              return (\n                <View key={attendance_id} style={{ flex: 1, flexDirection: 'row', width: '60%', justifyContent: 'space-around' }}>\n                  <View style={{ flex: 1 }}>\n                    <Text style={{ fontSize: 50 }}>{record.in_time}</Text>\n                  </View>\n                  <View style={{ flex: 1 }}>\n                    <Text style={{ fontSize: 50 }}>{record.out_time}</Text>\n                  </View>\n                </View>\n              )\n            })}\n\n            {/* <TouchableHighlight\n              style={{ backgroundColor: 'red', flex: 1, height: 60, justifyContent: 'center', alignItems: 'center', margin: 8 }}\n              onPress={() => this.clock()}\n            >\n              <Text style={{ fontSize: 30 }}>打卡</Text>\n            </TouchableHighlight> */}\n            <View style={{ flexDirection: 'row', alignSelf: 'flex-end',  backgroundColor: 'white', padding: 10 }}>\n              <Text style={{ fontSize: 25}}>今日總計: {Math.round(teacher.total_minutes*100) / 100}</Text>\n            </View>\n          </View>\n\n          <View style={{ flex: 1, flexDirection: 'row', alignItems: 'center' }}>\n            {/* {unmarked.has(teacher_id) ? */}\n              <View style={{ flex: 1, flexDirection: 'row', alignItems: 'center' }}>\n                <TouchableHighlight\n                  style={{ backgroundColor: 'red', flex: 1, height: 80, justifyContent: 'center', alignItems: 'center', margin: 8 }}\n                  onPress={this.props.hideModal}\n                >\n                  <Text style={{ fontSize: 40 }}>取消</Text>\n                </TouchableHighlight>\n                <TouchableHighlight\n                  style={{ backgroundColor: 'grey', flex: 1, height: 80, justifyContent: 'center', alignItems: 'center', margin: 8 }}\n                  onPress={() => this.clock()}\n                >\n                  <Text style={{ fontSize: 40 }}>打卡</Text>\n                </TouchableHighlight>\n              </View>\n              {/* : null\n            } */}\n          </View>\n        </View>\n    )\n  }\n}\n\nconst styles = StyleSheet.create({\n  thumbnailImage: {\n      width: 200,\n      height: 200,\n      borderRadius: 100\n  }\n})\n\nconst mapStateToProps = (state) => {\n  return {\n    // students: state.classInfo.students,\n    attendance: state.school.attendance,\n    teachers: state.school.teachers,\n    teacherOnDuty: state.school.teacherOnDuty,\n    unmarked: state.school.teacher_unmarked,\n    absent: state.school.teacher_absent,\n    // wellness: state.healthstatus,\n    isConnected: state.school.isConnected\n  }\n}\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    ...bindActionCreators({markPresent, sendWellnessDataFail, editTeacherOnDuty}, dispatch)\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps) (TeacherModal)"]},"metadata":{},"sourceType":"module"}