{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _toConsumableArray from\"@babel/runtime/helpers/toConsumableArray\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _assertThisInitialized from\"@babel/runtime/helpers/assertThisInitialized\";import _inherits from\"@babel/runtime/helpers/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import React from'react';import{Card,Toast}from'native-base';import View from\"react-native-web/dist/exports/View\";import ScrollView from\"react-native-web/dist/exports/ScrollView\";import Text from\"react-native-web/dist/exports/Text\";import Image from\"react-native-web/dist/exports/Image\";import TouchableHighlight from\"react-native-web/dist/exports/TouchableHighlight\";import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import TextInput from\"react-native-web/dist/exports/TextInput\";import KeyboardAvoidingView from\"react-native-web/dist/exports/KeyboardAvoidingView\";import Alert from\"react-native-web/dist/exports/Alert\";import DateTimePicker from'@react-native-community/datetimepicker';import{formatDate,formatTime,fetchClassData as _fetchClassData,beautifyDate}from\"../../util\";import{bindActionCreators}from'redux';import{connect}from'react-redux';import{updateDiaperAmount,addDiaperRecord,editDiaperTime,switchPeeOrPoo,editPooCondition,removeDiaperRecordSuccess,removeDiaperRecordFail,fetchClassDiaperData,createDiaperRecordSuccess,createDiaperRecordFail,editDiaperRecordSuccess,editDiaperRecordFail,editDiaperAmountSuccess,editDiaperAmountFail,clearDiaperlogErrorMessage}from\"../../../redux/school/actions/index\";import PickerComponent from\"../../picker\";import PooEntry from\"./pooentry\";import PooTextInput from\"./pootextinput\";var DiaperLog=function(_React$Component){_inherits(DiaperLog,_React$Component);var _super=_createSuper(DiaperLog);function DiaperLog(props){var _this;_classCallCheck(this,DiaperLog);_this=_super.call(this,props);_this.state={isLoading:true,date:new Date(),other_option:'',show_time_picker:false,record_id_for_edit:'',cloth_diaper:false,record_id:''};_this.handleSend=_this.handleSend.bind(_assertThisInitialized(_this));return _this;}_createClass(DiaperLog,[{key:\"componentDidMount\",value:function componentDidMount(){var _this$props$diaper_re=this.props.diaper_records,new_data_for_create=_this$props$diaper_re.new_data_for_create,old_data_for_edit=_this$props$diaper_re.old_data_for_edit;var isConnected=this.props.class.isConnected;if(new_data_for_create.size+old_data_for_edit.size===0&&isConnected){this.fetchClassData();}else{this.setState({isLoading:false});}if(!isConnected){Toast.show({text:'拍謝 網路連不到! 等一下再試試看',buttonText:'Okay',position:\"top\",type:\"warning\",duration:2000});}}},{key:\"checkUnsent\",value:function checkUnsent(student_id){var _this$props$diaper_re2=this.props.diaper_records,new_data_for_create=_this$props$diaper_re2.new_data_for_create,old_data_for_edit=_this$props$diaper_re2.old_data_for_edit,by_student_id=_this$props$diaper_re2.by_student_id,students_pending_amount_update=_this$props$diaper_re2.students_pending_amount_update;var records=by_student_id[student_id].records;var found=false;if(students_pending_amount_update.has(student_id)){return true;}for(var i=0;i<records.length;i++){if(new_data_for_create.has(records[i])||old_data_for_edit.has(records[i])){found=true;break;}}return found;}},{key:\"fetchClassData\",value:function fetchClassData(){var isConnected,date,start_date,end_date,diaperData;return _regeneratorRuntime.async(function fetchClassData$(_context){while(1){switch(_context.prev=_context.next){case 0:isConnected=this.props.class.isConnected;if(isConnected){_context.next=4;break;}Toast.show({text:'拍謝 網路連不到! 等一下再試試看',buttonText:'Okay',position:\"top\",type:\"warning\",duration:2000});return _context.abrupt(\"return\");case 4:date=new Date();start_date=formatDate(date);date.setDate(date.getDate()+1);end_date=formatDate(date);_context.next=10;return _regeneratorRuntime.awrap(_fetchClassData('diaper',this.props.class.class_id,start_date,end_date));case 10:diaperData=_context.sent;this.denormalize(diaperData);this.props.fetchClassDiaperData(diaperData.data);this.setState({isLoading:false});case 14:case\"end\":return _context.stop();}}},null,this,null,Promise);}},{key:\"denormalize\",value:function denormalize(diaperData){if(!diaperData.data.records.all_id.length){return;}var by_id=diaperData.data.records.by_id;for(var record_id in by_id){by_id[record_id].time=new Date(by_id[record_id].time);}}},{key:\"handleUpdateDiaperAmount\",value:function handleUpdateDiaperAmount(student_id,amount){this.props.updateDiaperAmount(student_id,amount);}},{key:\"addDiaperRecord\",value:function addDiaperRecord(student_id){var teacher_id=this.props.route.params.teacher_id;this.props.addDiaperRecord(student_id,new Date(),this.state.cloth_diaper,teacher_id);}},{key:\"setTime\",value:function setTime(time){var teacher_id=this.props.route.params.teacher_id;var record_id_for_edit=this.state.record_id_for_edit;if(time!==undefined){this.setState({show_time_picker:false,record_id_for_edit:''});this.props.editDiaperTime(record_id_for_edit,time,teacher_id);}else{this.setState({show_time_picker:false,record_id_for_edit:''});}}},{key:\"switchPeeOrPoo\",value:function switchPeeOrPoo(record_id){var teacher_id=this.props.route.params.teacher_id;this.props.switchPeeOrPoo(record_id,teacher_id);}},{key:\"editPooCondition\",value:function editPooCondition(record_id,condition){var teacher_id=this.props.route.params.teacher_id;if(condition==='取消編輯'){return;}else if(condition==='其他'){this.setState({record_id:record_id,other_option:'Please Fill Out'});}else{this.setState({other_option:''});this.props.editPooCondition(record_id,condition,teacher_id);}}},{key:\"confirmRemove\",value:function confirmRemove(student_id,record_id){var _this2=this;Alert.alert('確定要刪除？','',[{text:'OK',onPress:function onPress(){return _this2.removeDiaperRecord(student_id,record_id);}},{text:'Cancel',style:'cancel'}]);}},{key:\"removeDiaperRecord\",value:function removeDiaperRecord(student_id,record_id){var _this3=this;var new_data_for_create=this.props.diaper_records.new_data_for_create;var isConnected=this.props.class.isConnected;if(new_data_for_create.has(record_id)){this.props.removeDiaperRecordSuccess(student_id,record_id);return;}if(!isConnected){Toast.show({text:'拍謝 網路連不到! 等一下再試試看',buttonText:'Okay',position:\"top\",type:\"warning\",duration:2000});return;}var query=\"https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/dev/diaper\";fetch(query,{method:'DELETE',headers:{Accept:'application/json','Content-Type':'application/json'},body:JSON.stringify({record_id:record_id})}).then(function(res){return res.json();}).then(function(resJson){var statusCode=resJson.statusCode,message=resJson.message;if(statusCode>200||message==='Internal Server Error'){_this3.props.removeDiaperRecordFail(message);}_this3.props.removeDiaperRecordSuccess(student_id,record_id);}).catch(function(err){_this3.props.removeDiaperRecordFail(err);});}},{key:\"handleSend\",value:function handleSend(){var _this$props$diaper_re3,new_data_for_create,old_data_for_edit,students_pending_amount_update,isConnected,create_records_result,sendDiaperAmountDataResult;return _regeneratorRuntime.async(function handleSend$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_this$props$diaper_re3=this.props.diaper_records,new_data_for_create=_this$props$diaper_re3.new_data_for_create,old_data_for_edit=_this$props$diaper_re3.old_data_for_edit,students_pending_amount_update=_this$props$diaper_re3.students_pending_amount_update;isConnected=this.props.class.isConnected;if(isConnected){_context2.next=5;break;}Toast.show({text:'拍謝 網路連不到! 等一下再試試看',buttonText:'Okay',position:\"top\",type:\"warning\",duration:2000});return _context2.abrupt(\"return\");case 5:if(!(new_data_for_create.size||old_data_for_edit.size)){_context2.next=15;break;}_context2.next=8;return _regeneratorRuntime.awrap(this.createRecords());case 8:create_records_result=_context2.sent;if(!create_records_result.success){_context2.next=13;break;}this.props.createDiaperRecordSuccess();_context2.next=15;break;case 13:this.props.createDiaperRecordFail(create_records_result.data);return _context2.abrupt(\"return\");case 15:if(!students_pending_amount_update.size){_context2.next=25;break;}_context2.next=18;return _regeneratorRuntime.awrap(this.sendDiaperAmountData());case 18:sendDiaperAmountDataResult=_context2.sent;if(!sendDiaperAmountDataResult.success){_context2.next=23;break;}this.props.editDiaperAmountSuccess();_context2.next=25;break;case 23:this.props.editDiaperAmountFail(sendDiaperAmountDataResult.err_message);return _context2.abrupt(\"return\");case 25:this.props.navigation.goBack();case 26:case\"end\":return _context2.stop();}}},null,this,null,Promise);}},{key:\"sendDiaperAmountData\",value:function sendDiaperAmountData(){var _this4=this;var isConnected,url,response;return _regeneratorRuntime.async(function sendDiaperAmountData$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:isConnected=this.props.class.isConnected;if(isConnected){_context3.next=4;break;}Toast.show({text:'拍謝 網路連不到! 等一下再試試看',buttonText:'Okay',position:\"top\",type:\"warning\",duration:2000});return _context3.abrupt(\"return\");case 4:url='https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/dev/diaper/';_context3.next=7;return _regeneratorRuntime.awrap(Promise.all(Array.from(this.props.diaper_records.students_pending_amount_update).map(function(student_id){return fetch(url+student_id,{method:'PUT',body:JSON.stringify({amount:_this4.props.diaper_records.by_student_id[student_id].amount}),headers:{Accept:'application/json','Content-Type':'application/json'}}).then(function(res){return res.json();}).then(function(resJson){return resJson;}).catch(function(err){throw err;});})).then(function(result){return{success:true,status_code:200,data:result};}).catch(function(err){return{success:false,status_code:500,err_message:'error occured while sending diaper amount data: '+err};}));case 7:response=_context3.sent;return _context3.abrupt(\"return\",response);case 9:case\"end\":return _context3.stop();}}},null,this,null,Promise);}},{key:\"createRecords\",value:function createRecords(){var _this$props$diaper_re4,new_data_for_create,old_data_for_edit,records,data_objs,all_record_id,request_body,url,createRecordsRes;return _regeneratorRuntime.async(function createRecords$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_this$props$diaper_re4=this.props.diaper_records,new_data_for_create=_this$props$diaper_re4.new_data_for_create,old_data_for_edit=_this$props$diaper_re4.old_data_for_edit,records=_this$props$diaper_re4.records;data_objs=[];all_record_id=[].concat(_toConsumableArray(new_data_for_create),_toConsumableArray(old_data_for_edit));all_record_id.forEach(function(record_id){data_objs.push(_objectSpread({},records.by_id[record_id]));});this.normalize(data_objs);request_body={date:formatDate(new Date()),data_objs:data_objs};url='https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/dev/diaper/';_context4.next=9;return _regeneratorRuntime.awrap(fetch(url,{method:'POST',headers:{Accept:'application/json','Content-Type':'application/json'},body:JSON.stringify(request_body)}).then(function(res){return res.json();}).then(function(resJson){if(resJson.statusCode===200){return{success:true,status_code:200,data:resJson};}return{success:false,status_code:500,data:resJson.message};}).catch(function(err){return{success:false,status_code:500,err_message:err};}));case 9:createRecordsRes=_context4.sent;return _context4.abrupt(\"return\",createRecordsRes);case 11:case\"end\":return _context4.stop();}}},null,this,null,Promise);}},{key:\"editDiaperRecords\",value:function editDiaperRecords(){return _regeneratorRuntime.async(function editDiaperRecords$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:return _context5.abrupt(\"return\");case 1:case\"end\":return _context5.stop();}}},null,null,null,Promise);}},{key:\"normalize\",value:function normalize(data_objs){for(var i=0;i<data_objs.length;i++){data_objs[i].time=formatTime(data_objs[i].time);}}},{key:\"render\",value:function render(){var _this5=this;if(this.props.diaper_records.err_message!==''){Alert.alert('Error!',this.props.diaper_records.err_message,[{text:'OK',onPress:function onPress(){return _this5.props.clearDiaperlogErrorMessage();}}]);}var teacher_id=this.props.route.params.teacher_id;var _this$state=this.state,show_time_picker=_this$state.show_time_picker,cloth_diaper=_this$state.cloth_diaper;var _this$props$diaper_re5=this.props.diaper_records,by_student_id=_this$props$diaper_re5.by_student_id,records=_this$props$diaper_re5.records;var students=this.props.class.students;var date=this.state.date;return React.createElement(KeyboardAvoidingView,{style:{flex:1,paddingBottom:15},enabled:true},React.createElement(View,{style:{flexDirection:'row',alignItems:'center',justifyContent:'space-evenly'}},React.createElement(Text,{style:{fontSize:40}},beautifyDate(date)),React.createElement(View,{style:{flexDirection:'row'}},React.createElement(TouchableHighlight,{style:{backgroundColor:cloth_diaper?'rgba(255,255,255,0.2)':'#ffe1d0',padding:10,marginRight:20},onPress:function onPress(){return _this5.setState({cloth_diaper:false});}},React.createElement(Text,{style:{fontSize:40}},\"\\u5C3F\\u5E03\")),React.createElement(TouchableHighlight,{style:{backgroundColor:cloth_diaper?'#ffe1d0':'rgba(255,255,255,0.2)',padding:10,marginRight:20},onPress:function onPress(){return _this5.setState({cloth_diaper:true});}},React.createElement(Text,{style:{fontSize:40}},\"\\u5B78\\u7FD2\\u8932\")),React.createElement(TouchableHighlight,{style:{backgroundColor:'#dcf3d0',padding:10},onPress:this.handleSend},React.createElement(Text,{style:{fontSize:40}},\"\\u9001\\u51FA\")))),React.createElement(ScrollView,{contentContainerStyle:{alignItems:'center'},keyboardShouldPersistTaps:\"handled\"},Object.keys(students).map(function(student_id){if(by_student_id[student_id]===null){return null;}var record_id_list=by_student_id[student_id].records;return React.createElement(View,{key:student_id,style:{width:'98%'}},React.createElement(Card,{style:{flex:1,flexDirection:'row',paddingVertical:15}},React.createElement(View,{style:{width:'23%',alignItems:'center',justifyContent:'center'}},React.createElement(TouchableHighlight,{onPress:function onPress(){return _this5.addDiaperRecord(student_id);},underlayColor:\"transparent\"},React.createElement(Image,{source:students[student_id].profile_picture===''?require(\"../../../assets/icon-thumbnail.png\"):{uri:students[student_id].profile_picture},style:styles.thumbnailImage}))),React.createElement(View,{style:{width:'77%'}},React.createElement(View,{style:{flex:1}},React.createElement(View,{style:{flex:1,flexDirection:'row',alignItems:'center'}},React.createElement(View,{style:{flex:1,flexDirection:'row',alignItems:'center'}},React.createElement(Text,{style:{fontSize:30}},students[student_id].name),_this5.checkUnsent(student_id)?React.createElement(Text,{style:{fontSize:15,color:'red',marginLeft:15}},\"\\u672A\\u9001\\u51FA\"):null),React.createElement(View,{style:{flex:1,alignItems:'flex-end',paddingRight:15}},cloth_diaper?null:React.createElement(View,{style:{width:'33%',aspectRatio:1,backgroundColor:'#b5e9e9',alignItems:'center',padding:5}},React.createElement(Text,null,\"\\u5C3F\\u5E03\\u91CF\"),React.createElement(TextInput,{style:{flex:1,fontSize:37},value:\"\"+by_student_id[student_id].amount,onChangeText:function onChangeText(amount){return _this5.handleUpdateDiaperAmount(student_id,amount);}})))),record_id_list.map(function(record_id){var record=records.by_id[record_id];if(record.cloth_diaper!==cloth_diaper)return null;return React.createElement(View,{key:record_id,style:{flex:1,flexDirection:'row',marginVertical:6,justifyContent:'space-between',paddingRight:15}},React.createElement(TouchableHighlight,{style:{width:record.pee_or_poo==='大便'?'23%':'35%',height:'100%',justifyContent:'center',backgroundColor:'#fef6dd',borderRadius:10},onPress:function onPress(){return _this5.setState({record_id_for_edit:record_id,show_time_picker:true});}},React.createElement(Text,{style:{fontSize:35,textAlign:'center'}},record.time.getHours()+\":\"+record.time.getMinutes())),React.createElement(TouchableHighlight,{style:{width:record.pee_or_poo==='大便'?'23%':'35%',height:'100%',justifyContent:'center',backgroundColor:'#fef6dd',borderRadius:10},onPress:function onPress(){return _this5.switchPeeOrPoo(record_id);}},React.createElement(Text,{style:{fontSize:30,textAlign:'center'}},\"\"+record.pee_or_poo)),record.pee_or_poo==='大便'?React.createElement(PooEntry,{teacher_id:teacher_id,record_id:record_id,record:record}):null,React.createElement(TouchableHighlight,{style:{width:'20%',height:'100%',justifyContent:'center',backgroundColor:'#ffe1d0',borderRadius:10},onPress:function onPress(){return _this5.confirmRemove(student_id,record_id);}},React.createElement(Text,{style:{fontSize:30,textAlign:'center'}},\"\\u79FB\\u9664\")));}),show_time_picker&&React.createElement(DateTimePicker,{style:{width:'100%'},mode:'time',display:'spinner',value:new Date(),onChange:function onChange(event,time){return _this5.setTime(time);},minimumDate:new Date()})))));})));}}]);return DiaperLog;}(React.Component);var styles=StyleSheet.create({thumbnailImage:{width:140,height:140,borderRadius:70}});var mapStateToProps=function mapStateToProps(state){return{diaper_records:state.diaper,class:state.classInfo};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return _objectSpread({},bindActionCreators({updateDiaperAmount:updateDiaperAmount,addDiaperRecord:addDiaperRecord,editDiaperTime:editDiaperTime,switchPeeOrPoo:switchPeeOrPoo,editPooCondition:editPooCondition,removeDiaperRecordSuccess:removeDiaperRecordSuccess,removeDiaperRecordFail:removeDiaperRecordFail,fetchClassDiaperData:fetchClassDiaperData,createDiaperRecordSuccess:createDiaperRecordSuccess,createDiaperRecordFail:createDiaperRecordFail,editDiaperRecordSuccess:editDiaperRecordSuccess,editDiaperRecordFail:editDiaperRecordFail,editDiaperAmountSuccess:editDiaperAmountSuccess,editDiaperAmountFail:editDiaperAmountFail,clearDiaperlogErrorMessage:clearDiaperlogErrorMessage},dispatch));};export default connect(mapStateToProps,mapDispatchToProps)(DiaperLog);","map":{"version":3,"sources":["/home/caleb_lee/gina_web_app/components/teacher/logs/diaperlog.js"],"names":["React","Card","Toast","DateTimePicker","formatDate","formatTime","fetchClassData","beautifyDate","bindActionCreators","connect","updateDiaperAmount","addDiaperRecord","editDiaperTime","switchPeeOrPoo","editPooCondition","removeDiaperRecordSuccess","removeDiaperRecordFail","fetchClassDiaperData","createDiaperRecordSuccess","createDiaperRecordFail","editDiaperRecordSuccess","editDiaperRecordFail","editDiaperAmountSuccess","editDiaperAmountFail","clearDiaperlogErrorMessage","PickerComponent","PooEntry","PooTextInput","DiaperLog","props","state","isLoading","date","Date","other_option","show_time_picker","record_id_for_edit","cloth_diaper","record_id","handleSend","bind","diaper_records","new_data_for_create","old_data_for_edit","isConnected","class","size","setState","show","text","buttonText","position","type","duration","student_id","by_student_id","students_pending_amount_update","records","found","has","i","length","start_date","setDate","getDate","end_date","class_id","diaperData","denormalize","data","all_id","by_id","time","amount","teacher_id","route","params","undefined","condition","Alert","alert","onPress","removeDiaperRecord","style","query","fetch","method","headers","Accept","body","JSON","stringify","then","res","json","resJson","statusCode","message","catch","err","createRecords","create_records_result","success","sendDiaperAmountData","sendDiaperAmountDataResult","err_message","navigation","goBack","url","Promise","all","Array","from","map","result","status_code","response","data_objs","all_record_id","forEach","push","normalize","request_body","createRecordsRes","students","flex","paddingBottom","flexDirection","alignItems","justifyContent","fontSize","backgroundColor","padding","marginRight","Object","keys","record_id_list","width","paddingVertical","profile_picture","require","uri","styles","thumbnailImage","name","checkUnsent","color","marginLeft","paddingRight","aspectRatio","handleUpdateDiaperAmount","record","marginVertical","pee_or_poo","height","borderRadius","textAlign","getHours","getMinutes","confirmRemove","event","setTime","Component","StyleSheet","create","mapStateToProps","diaper","classInfo","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { Card, Toast } from 'native-base'\nimport { View, ScrollView, Text, Image, TouchableHighlight, StyleSheet, TextInput, KeyboardAvoidingView, Alert } from 'react-native'\nimport DateTimePicker from '@react-native-community/datetimepicker'\nimport { formatDate, formatTime, fetchClassData, beautifyDate } from '../../util'\nimport { bindActionCreators } from 'redux';\nimport { connect } from 'react-redux';\nimport {\n    updateDiaperAmount,\n    addDiaperRecord,\n    editDiaperTime,\n    switchPeeOrPoo,\n    editPooCondition,\n    removeDiaperRecordSuccess,\n    removeDiaperRecordFail,\n    fetchClassDiaperData,\n    createDiaperRecordSuccess,\n    createDiaperRecordFail,\n    editDiaperRecordSuccess,\n    editDiaperRecordFail,\n    editDiaperAmountSuccess,\n    editDiaperAmountFail,\n    clearDiaperlogErrorMessage\n} from '../../../redux/school/actions/index'\nimport PickerComponent from '../../picker'\nimport PooEntry from './pooentry'\nimport PooTextInput from './pootextinput'\n\nclass DiaperLog extends React.Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            isLoading: true,\n            date: new Date(),\n            other_option: '',\n            show_time_picker: false,\n            record_id_for_edit: '',\n            cloth_diaper: false,\n            record_id: ''\n        }\n        this.handleSend = this.handleSend.bind(this)\n    }\n\n    componentDidMount() {\n        const { new_data_for_create, old_data_for_edit } = this.props.diaper_records\n        const { isConnected } = this.props.class\n        if ((new_data_for_create.size + old_data_for_edit.size === 0) && isConnected) {\n            this.fetchClassData()\n        } else {\n            this.setState({\n                isLoading: false\n            })\n        }\n        if (!isConnected) {\n            Toast.show({\n                text: '拍謝 網路連不到! 等一下再試試看',\n                buttonText: 'Okay',\n                position: \"top\",\n                type: \"warning\",\n                duration: 2000\n            })\n        }\n    }\n\n    checkUnsent(student_id) {\n        const { new_data_for_create, old_data_for_edit, by_student_id, students_pending_amount_update } = this.props.diaper_records\n        const { records } = by_student_id[student_id]\n        var found = false\n        if (students_pending_amount_update.has(student_id)) {\n            return true\n        }\n        for (var i = 0; i < records.length; i++) {\n            if (new_data_for_create.has(records[i]) || old_data_for_edit.has(records[i])) {\n                found = true\n                break\n            }\n        }\n        return found\n    }\n\n    async fetchClassData() {\n        const { isConnected } = this.props.class\n        if (!isConnected) {\n            Toast.show({\n                text: '拍謝 網路連不到! 等一下再試試看',\n                buttonText: 'Okay',\n                position: \"top\",\n                type: \"warning\",\n                duration: 2000\n            })\n            return\n        }\n        const date = new Date()\n        const start_date = formatDate(date)\n        date.setDate(date.getDate() + 1)\n        const end_date = formatDate(date)\n        const diaperData = await fetchClassData('diaper', this.props.class.class_id, start_date, end_date)\n        this.denormalize(diaperData)\n        // console.log('diaperData: ', diaperData)\n        this.props.fetchClassDiaperData(diaperData.data)\n        this.setState({\n            isLoading: false\n        })\n        // console.log('this.props.diaper_records: ', this.props.diaper_records)\n    }\n\n    denormalize(diaperData) {\n        // console.log('denormalize: ', diaperData)\n        if (!diaperData.data.records.all_id.length) {\n            return\n        }\n        const { by_id } = diaperData.data.records\n        for (const record_id in by_id) {\n            by_id[record_id].time = new Date(by_id[record_id].time)\n        }\n    }\n\n    handleUpdateDiaperAmount(student_id, amount) {\n        this.props.updateDiaperAmount(student_id, amount)\n    }\n\n    addDiaperRecord(student_id) {\n        const { teacher_id } = this.props.route.params\n        this.props.addDiaperRecord(student_id, new Date(), this.state.cloth_diaper, teacher_id)\n    }\n\n    setTime(time) {\n        const { teacher_id } = this.props.route.params\n        const { record_id_for_edit } = this.state\n        if (time !== undefined) {\n            this.setState({ \n                show_time_picker: false,\n                record_id_for_edit: ''\n            })\n            this.props.editDiaperTime(record_id_for_edit, time, teacher_id)\n        } else {\n            this.setState({ \n                show_time_picker: false,\n                record_id_for_edit: ''\n            })\n        }\n    }\n\n    switchPeeOrPoo(record_id) {\n        const { teacher_id } = this.props.route.params\n        this.props.switchPeeOrPoo(record_id, teacher_id)\n    }\n\n    editPooCondition(record_id, condition) {\n        // console.log(record_id, condition)\n        const { teacher_id } = this.props.route.params\n        if (condition === '取消編輯') {\n            return \n        } else if (condition === '其他') {\n            this.setState({\n                record_id,\n                other_option: 'Please Fill Out'\n            })\n        } else {\n            // console.log('HERE')\n            this.setState({ other_option: '' })\n            this.props.editPooCondition(record_id, condition, teacher_id)\n        }\n    }\n\n    confirmRemove(student_id, record_id) {\n        Alert.alert(\n            '確定要刪除？',\n            '',\n            [\n                { text: 'OK', onPress: () => this.removeDiaperRecord(student_id, record_id) },\n                { text: 'Cancel', style: 'cancel'}\n            ]\n        )\n    }\n\n    removeDiaperRecord(student_id, record_id) {\n        const { new_data_for_create } = this.props.diaper_records\n        const { isConnected } = this.props.class\n        \n        if (new_data_for_create.has(record_id)) {\n            this.props.removeDiaperRecordSuccess(student_id, record_id)\n            return\n        }\n        if (!isConnected) {\n            Toast.show({\n                text: '拍謝 網路連不到! 等一下再試試看',\n                buttonText: 'Okay',\n                position: \"top\",\n                type: \"warning\",\n                duration: 2000\n            })\n            return\n        }\n\n        const query = `https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/dev/diaper`\n        fetch(query, {\n            method: 'DELETE',\n            headers: {\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                record_id\n            })\n        })\n            .then(res => res.json())\n            .then(resJson => {\n                const { statusCode, message } = resJson\n                if (statusCode > 200 || message === 'Internal Server Error') {\n                    this.props.removeDiaperRecordFail(message)\n                }\n                this.props.removeDiaperRecordSuccess(student_id, record_id)\n            })\n            .catch(err => {\n                this.props.removeDiaperRecordFail(err)\n            })\n    }\n\n    async handleSend() { // TODO: test function\n        const { new_data_for_create, old_data_for_edit, students_pending_amount_update } = this.props.diaper_records\n        const { isConnected } = this.props.class\n        if (!isConnected) {\n            Toast.show({\n                text: '拍謝 網路連不到! 等一下再試試看',\n                buttonText: 'Okay',\n                position: \"top\",\n                type: \"warning\",\n                duration: 2000\n            })\n            return\n        }\n\n        if (new_data_for_create.size || old_data_for_edit.size) {\n            const create_records_result = await this.createRecords()\n            if (create_records_result.success) {\n                // console.log(create_records_result)\n                this.props.createDiaperRecordSuccess()\n            } else {\n                this.props.createDiaperRecordFail(create_records_result.data)\n                return\n            }\n        }\n\n        if (students_pending_amount_update.size) {\n            const sendDiaperAmountDataResult = await this.sendDiaperAmountData()\n            if (sendDiaperAmountDataResult.success) {\n                this.props.editDiaperAmountSuccess()\n            } else {\n                this.props.editDiaperAmountFail(sendDiaperAmountDataResult.err_message)\n                return\n            }\n        }\n        \n        this.props.navigation.goBack()\n    }\n\n    async sendDiaperAmountData() {\n        const { isConnected } = this.props.class\n        if (!isConnected) {\n            Toast.show({\n                text: '拍謝 網路連不到! 等一下再試試看',\n                buttonText: 'Okay',\n                position: \"top\",\n                type: \"warning\",\n                duration: 2000\n            })\n            return\n        }\n        let url = 'https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/dev/diaper/'\n\n        const response = await Promise.all(\n            Array.from(this.props.diaper_records.students_pending_amount_update).map(student_id => {\n                return fetch(url + student_id, {\n                    method: 'PUT',\n                    body: JSON.stringify({\n                        amount: this.props.diaper_records.by_student_id[student_id].amount\n                    }),\n                    headers: {\n                        Accept: 'application/json',\n                        'Content-Type': 'application/json'\n                    }\n                })\n                .then(res => res.json())\n                .then(resJson => {\n                    return resJson\n                })\n                .catch(err => { throw err })\n            })\n        )\n        .then(result => {\n            return {\n                success: true,\n                status_code: 200,\n                data: result\n            }\n        })\n        .catch(err => {\n            return {\n                success: false,\n                status_code: 500,\n                err_message: 'error occured while sending diaper amount data: ' + err\n            }\n        })\n        return response\n    }\n\n    async createRecords() {\n        const { new_data_for_create, old_data_for_edit, records } = this.props.diaper_records\n        const data_objs = []\n        const all_record_id = [...new_data_for_create, ...old_data_for_edit]\n        // console.log('new_data_for_create: ', new_data_for_create)\n        all_record_id.forEach(record_id => {\n            data_objs.push({\n                ...records.by_id[record_id]\n            })\n        })\n        this.normalize(data_objs)\n        const request_body = {\n            date: formatDate(new Date()),\n            data_objs\n        }\n        let url = 'https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/dev/diaper/'\n        const createRecordsRes =\n            await fetch(url, {\n                method: 'POST',\n                headers: {\n                    Accept: 'application/json',\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify(request_body)\n            })\n            .then(res => res.json())\n            .then(resJson => {\n                // console.log(\"resJson: \", resJson)\n                if (resJson.statusCode === 200) {\n                    return {\n                        success: true,\n                        status_code: 200,\n                        data: resJson\n                    }\n                }\n                return {\n                    success: false,\n                    status_code: 500,\n                    data: resJson.message\n                }\n            })\n            .catch(err => {\n                return {\n                    success: false,\n                    status_code: 500,\n                    err_message: err\n                }\n            })\n\n        return createRecordsRes\n    }\n\n    async editDiaperRecords() {\n        //TODO implement\n        return\n    }\n\n    normalize(data_objs) {\n        // console.log('data_objs: ', data_objs)\n        for (var i = 0; i < data_objs.length; i++) {\n            data_objs[i].time = formatTime(data_objs[i].time)\n        }\n    }\n\n    render() {\n        // TODO: Provide some options for poo condition\n        if (this.props.diaper_records.err_message !== ''){\n            Alert.alert(\n                'Error!',\n                this.props.diaper_records.err_message,\n                [{text: 'OK', onPress: () => this.props.clearDiaperlogErrorMessage()}]\n            )\n        }\n        const { teacher_id } = this.props.route.params\n        const { show_time_picker, cloth_diaper } = this.state\n        const { by_student_id, records } = this.props.diaper_records\n        const { students } = this.props.class\n        const date = this.state.date\n        // console.log('this.props.diaper_records: ', this.props.diaper_records)\n        return (\n            <KeyboardAvoidingView\n                style={{\n                    flex: 1,\n                    paddingBottom: 15\n                }}\n                // behavior='padding'\n                // keyboardVerticalOffset={100}\n                enabled\n            >\n                <View style={{ flexDirection: 'row', alignItems: 'center', justifyContent: 'space-evenly' }}>\n                    <Text style={{ fontSize: 40 }}>{beautifyDate(date)}</Text>\n                    <View style={{ flexDirection: 'row' }}>\n                        <TouchableHighlight\n                            style={{\n                                backgroundColor: cloth_diaper ? 'rgba(255,255,255,0.2)' : '#ffe1d0',\n                                padding: 10,\n                                marginRight: 20\n                            }}\n                            onPress={() => this.setState({ cloth_diaper: false })}\n                        >\n                            <Text style={{ fontSize: 40 }}>尿布</Text>\n                        </TouchableHighlight>\n\n                        <TouchableHighlight\n                            style={{\n                                backgroundColor: cloth_diaper ? '#ffe1d0' : 'rgba(255,255,255,0.2)',\n                                padding: 10,\n                                marginRight: 20\n                            }}\n                            onPress={() => this.setState({ cloth_diaper: true })}\n                        >\n                            <Text style={{ fontSize: 40 }}>學習褲</Text>\n                        </TouchableHighlight>\n\n                        <TouchableHighlight\n                            style={{ backgroundColor: '#dcf3d0', padding: 10 }}\n                            onPress={this.handleSend}\n                        >\n                            <Text style={{ fontSize: 40 }}>送出</Text>\n                        </TouchableHighlight>\n                    </View>\n                </View>\n                <ScrollView \n                    contentContainerStyle={{ alignItems: 'center' }}\n                    keyboardShouldPersistTaps='handled'\n                >\n                    {Object.keys(students).map((student_id) => {\n                        if (by_student_id[student_id] === null) {\n                            return null\n                        }\n                        const record_id_list = by_student_id[student_id].records\n                        return (\n                            <View key={student_id} style={{ width: '98%' }}>\n                                <Card style={{ flex: 1, flexDirection: 'row', paddingVertical: 15 }}>\n                                    <View style={{ width: '23%', alignItems: 'center', justifyContent: 'center' }}>\n                                        <TouchableHighlight\n                                            // style={styles.childThumbnail}\n                                            onPress={() => this.addDiaperRecord(student_id)}\n                                            underlayColor=\"transparent\"\n                                        >\n                                            <Image\n                                                source={\n                                                    students[student_id].profile_picture === '' ?\n                                                        require('../../../assets/icon-thumbnail.png')\n                                                        : {uri: students[student_id].profile_picture}\n                                                }\n                                                style={styles.thumbnailImage}/>\n                                        </TouchableHighlight> \n                                    </View>\n                                    <View style={{ width: '77%' }}>\n                                        <View style={{ flex: 1 }}>\n                                            <View style={{ flex: 1, flexDirection: 'row', alignItems: 'center' }}>\n                                                <View style={{ flex: 1, flexDirection: 'row', alignItems: 'center' }}>\n                                                    <Text style={{ fontSize: 30 }}>\n                                                        {students[student_id].name}\n                                                    </Text>\n                                                    {this.checkUnsent(student_id) ? \n                                                        <Text style={{ fontSize: 15, color: 'red', marginLeft: 15}}>未送出</Text>\n                                                        : null\n                                                    }\n                                                </View>\n                                                <View style={{ flex: 1, alignItems: 'flex-end', paddingRight: 15 }}>\n                                                    {cloth_diaper ? \n                                                        null\n                                                        :\n                                                        <View style={{ width: '33%', aspectRatio: 1, backgroundColor: '#b5e9e9', alignItems: 'center', padding: 5 }}>\n                                                            <Text>尿布量</Text>\n                                                            <TextInput\n                                                                style={{ flex:1, fontSize: 37 }}\n                                                                value={\"\" + by_student_id[student_id].amount}\n                                                                onChangeText={amount => this.handleUpdateDiaperAmount(student_id, amount)}\n                                                            />\n                                                        </View>\n                                                    }\n                                                </View>\n                                            </View>\n                                            {record_id_list.map(record_id => {\n                                                const record = records.by_id[record_id]\n                                                if (record.cloth_diaper !== cloth_diaper) return null\n                                                return (\n                                                    <View key={record_id} style={{ flex: 1, flexDirection: 'row', marginVertical: 6, justifyContent: 'space-between', paddingRight: 15 }}>\n                                                        {/* TIME */}\n                                                        <TouchableHighlight\n                                                            style={{\n                                                                width: record.pee_or_poo === '大便' ? '23%' : '35%',\n                                                                // marginRight: '3%',\n                                                                height: '100%',\n                                                                justifyContent: 'center',\n                                                                backgroundColor: '#fef6dd',\n                                                                borderRadius: 10\n                                                            }}\n                                                            onPress={() => this.setState({ record_id_for_edit: record_id, show_time_picker: true })}\n                                                        >\n                                                            <Text style={{ fontSize: 35, textAlign: 'center' }}>\n                                                                {`${record.time.getHours()}:${record.time.getMinutes()}`}\n                                                            </Text>\n                                                        </TouchableHighlight>\n\n                                                        {/* PEE OR POO*/}\n                                                        <TouchableHighlight\n                                                            style={{\n                                                                width: record.pee_or_poo === '大便' ? '23%' : '35%',\n                                                                // marginRight: '3%',\n                                                                height: '100%',\n                                                                justifyContent: 'center',\n                                                                backgroundColor: '#fef6dd',\n                                                                borderRadius: 10\n                                                            }}\n                                                            onPress={() => this.switchPeeOrPoo(record_id)}\n                                                        >\n                                                            <Text style={{ fontSize: 30, textAlign: 'center' }}>\n                                                                {`${record.pee_or_poo}`}\n                                                            </Text>\n                                                        </TouchableHighlight>\n\n                                                        {/* POO CONDITION*/}\n                                                        {record.pee_or_poo === '大便' ?\n                                                            <PooEntry\n                                                                teacher_id={teacher_id}\n                                                                record_id={record_id}\n                                                                record={record}\n                                                            />\n                                                            // <View\n                                                            //     style={{\n                                                            //         width: '23%',\n                                                            //         // marginRight: '3%',\n                                                            //         height: '100%',\n                                                            //         justifyContent: 'center',\n                                                            //         backgroundColor: '#fef6dd',\n                                                            //         borderRadius: 10\n                                                            //     }}\n                                                            // >\n                                                            //     {this.state.other_option === '' && this.state.record_id != record_id ?\n                                                            //         <PickerComponent\n                                                            //             style={{\n                                                            //                 // height: 20,\n                                                            //                 // width: '50%',\n                                                            //                 // marginLeft: 25\n                                                            //                 alignItems: 'center',\n                                                            //                 padding: 5\n                                                            //             }}\n                                                            //             selectedValue={record.poo_condition}\n                                                            //             options={[\n                                                            //                 \"正常\",\n                                                            //                 \"硬\",\n                                                            //                 \"軟糊\",\n                                                            //                 \"稀水\",\n                                                            //                 \"其他\",\n                                                            //                 \"取消編輯\"\n                                                            //             ]}\n                                                            //             textStyle={{fontSize: 30}}\n                                                            //             handleOnClick={() => { }}\n                                                            //             handleSelectValue={(condition) => this.editPooCondition(record_id, condition)}\n                                                            //         />\n                                                            //         :\n                                                            //         <PooTextInput\n                                                            //             editPooCondition={(condition) => this.editPooCondition(record_id, condition)}\n                                                            //         />\n                                                            //     }\n                                                                    \n                                                            // </View>\n                                                            : null\n                                                        }\n\n                                                        {/* REMOVE RECORD*/}\n                                                        <TouchableHighlight\n                                                            style={{\n                                                                width: '20%',\n                                                                // marginRight: '2%',\n                                                                height: '100%',\n                                                                justifyContent: 'center',\n                                                                backgroundColor: '#ffe1d0',\n                                                                borderRadius: 10\n                                                            }}\n                                                            onPress={() => this.confirmRemove(student_id, record_id)}\n                                                        >\n                                                            <Text style={{ fontSize: 30, textAlign: 'center' }}>\n                                                                移除\n                                                            </Text>\n                                                        </TouchableHighlight>\n                                                    </View>\n                                                )\n                                            })}\n                                            {show_time_picker &&\n                                                <DateTimePicker\n                                                    style={{ width: '100%'}}\n                                                    mode={'time'}\n                                                    display={'spinner'}\n                                                    value={new Date}\n                                                    onChange={(event, time) => this.setTime(time)}\n                                                    minimumDate={new Date()}\n                                                />\n                                            }\n                                        </View>\n                                    </View>\n                                </Card>\n                            </View>\n                        )\n                    })}\n                </ScrollView>\n            </KeyboardAvoidingView>\n        )\n    }\n}\n\nconst styles = StyleSheet.create({\n    thumbnailImage: {\n        width: 140,\n        height: 140,\n        borderRadius: 70\n    }\n})\n\nconst mapStateToProps = (state) => {\n    return {\n        diaper_records: state.diaper,\n        class: state.classInfo\n    }\n}\n\nconst mapDispatchToProps = (dispatch) => {\n    return {\n        ...bindActionCreators({\n            updateDiaperAmount,\n            addDiaperRecord,\n            editDiaperTime,\n            switchPeeOrPoo,\n            editPooCondition,\n            removeDiaperRecordSuccess,\n            removeDiaperRecordFail,\n            fetchClassDiaperData,\n            createDiaperRecordSuccess,\n            createDiaperRecordFail,\n            editDiaperRecordSuccess,\n            editDiaperRecordFail,\n            editDiaperAmountSuccess,\n            editDiaperAmountFail,\n            clearDiaperlogErrorMessage\n        }, dispatch)\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps) (DiaperLog)"]},"metadata":{},"sourceType":"module"}