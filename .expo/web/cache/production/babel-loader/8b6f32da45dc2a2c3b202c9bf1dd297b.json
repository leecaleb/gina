{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _assertThisInitialized from\"@babel/runtime/helpers/assertThisInitialized\";import _inherits from\"@babel/runtime/helpers/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import React from'react';import View from\"react-native-web/dist/exports/View\";import Text from\"react-native-web/dist/exports/Text\";import Image from\"react-native-web/dist/exports/Image\";import TextInput from\"react-native-web/dist/exports/TextInput\";import TouchableOpacity from\"react-native-web/dist/exports/TouchableOpacity\";import Alert from\"react-native-web/dist/exports/Alert\";import{Card,Body}from'native-base';import{formatDate,fetchData as _fetchData,post,beautifyTime,formatTime,get}from\"../util\";import Reloading from\"../reloading\";var MessageCard=function(_React$Component){_inherits(MessageCard,_React$Component);var _super=_createSuper(MessageCard);function MessageCard(props){var _this;_classCallCheck(this,MessageCard);_this=_super.call(this,props);_this.state={child_id:_this.props.child_id,isLoading:true,data_available:false,items_to_bring:[],activities:[],text:'',teacher_id:'',message_id:null,message_for_teacher:'',isConnected:true,scrollHeight:'100%',message_read:false};_this.fetchData=_this.fetchData.bind(_assertThisInitialized(_this));return _this;}_createClass(MessageCard,[{key:\"componentDidMount\",value:function componentDidMount(){var date=this.props.date;this.fetchData(this.state.child_id,new Date(date.getTime()));}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps){if(this.props.date!==prevProps.date){this.setState({isLoading:true,message_for_teacher:'',scrollHeight:'100%'});this.fetchData(this.props.child_id,new Date(this.props.date.getTime()));}else if(this.props.child_id!==prevProps.child_id){this.setState({isLoading:true,message_for_teacher:'',scrollHeight:'100%'});this.fetchData(this.props.child_id,new Date());}else if(this.props.isConnected!=prevProps.isConnected){this.setState({isConnected:this.props.isConnected});}}},{key:\"setScrollHeight\",value:function setScrollHeight(scrollHeight){this.setState({scrollHeight:scrollHeight});}},{key:\"fetchData\",value:function fetchData(child_id,propDate){var date,start_date,end_date,messageData;return _regeneratorRuntime.async(function fetchData$(_context){while(1){switch(_context.prev=_context.next){case 0:date=new Date(propDate.getTime());if(!(date.getHours()<17)){_context.next=4;break;}this.setState({isLoading:false,message_for_teacher:'',data_available:false});return _context.abrupt(\"return\");case 4:start_date=formatDate(date);date.setDate(date.getDate()+1);end_date=formatDate(date);_context.next=9;return _regeneratorRuntime.awrap(_fetchData('message',child_id,start_date,end_date));case 9:messageData=_context.sent;if(!(messageData.data===undefined||messageData.data[start_date]===undefined)){_context.next=13;break;}this.setState({isLoading:false,message_for_teacher:'',data_available:false});return _context.abrupt(\"return\");case 13:this.denormalize(messageData.data[start_date]);case 14:case\"end\":return _context.stop();}}},null,this,null,Promise);}},{key:\"denormalize\",value:function denormalize(message_data){var items_list=['母奶粉','尿布','水壺','衣物'];var activities_list=['嬰兒按摩','音樂律動','教具操作','繪本欣賞','認知圖片','體能活動','藝術創作','多元語言'];var items_to_bring=[];var activities=[];for(var i=0;i<message_data.items_to_bring.length-1;i++){if(message_data.items_to_bring[i]){items_to_bring.push(items_list[i]);}}if(message_data.items_to_bring[message_data.items_to_bring.length-1]){items_to_bring.push(message_data.other_item);}for(var i=0;i<message_data.activities.length-1;i++){if(message_data.activities[i]){activities.push(activities_list[i]);}}if(message_data.activities[message_data.activities.length-1]){activities.push(message_data.other_activity);}this.setState({isLoading:false,data_available:true,message_id:message_data.message_id,items_to_bring:items_to_bring,activities:activities,text:message_data.text,teacher_id:message_data.teacher_id,message_for_teacher:message_data.message_for_teacher,message_read:message_data.message_read});}},{key:\"sendMessage\",value:function sendMessage(){var _this$props,class_id,parent_id,date,_this$state,message_for_teacher,message_id,isConnected,body,response,success,statusCode,message,data;return _regeneratorRuntime.async(function sendMessage$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_this$props=this.props,class_id=_this$props.class_id,parent_id=_this$props.parent_id,date=_this$props.date;_this$state=this.state,message_for_teacher=_this$state.message_for_teacher,message_id=_this$state.message_id,isConnected=_this$state.isConnected;if(!(!this.editable()||message_for_teacher==='')){_context2.next=4;break;}return _context2.abrupt(\"return\");case 4:if(isConnected){_context2.next=7;break;}alert('網路連不到! 請稍後再試試看');return _context2.abrupt(\"return\");case 7:body={student_id:this.props.child_id,parent_id:parent_id,message_id:message_id,message_for_teacher:message_for_teacher,timestamp:formatDate(date)+' '+formatTime(date)};_context2.next=10;return _regeneratorRuntime.awrap(post(\"/message/class/\"+class_id,body));case 10:response=_context2.sent;success=response.success,statusCode=response.statusCode,message=response.message,data=response.data;if(success){_context2.next=15;break;}alert(\"Sorry \\u50B3\\u9001\\u8A0A\\u606F\\u6642\\u96FB\\u8166\\u51FA\\u72C0\\u6CC1\\u4E86\\uFF01\\u8ACB\\u622A\\u5716\\u548C\\u8207\\u5DE5\\u7A0B\\u5E2B\\u806F\\u7E6B\\n\\n\"+message);return _context2.abrupt(\"return\");case 15:alert(\"\\u8A0A\\u606F\\u50B3\\u9054\\u6210\\u529F\\uFF01\");this.fetchData(this.state.child_id,new Date(date.getTime()));case 17:case\"end\":return _context2.stop();}}},null,this,null,Promise);}},{key:\"editable\",value:function editable(){var date=this.props.date;var threshold=new Date();if(threshold.getDay()===6){threshold.setDate(threshold.getDate()-1);}else if(threshold.getDay()===0){threshold.setDate(threshold.getDate()-2);}threshold.setHours(17,0,0,0);return date.getTime()>=threshold.getTime()||this.before4am();}},{key:\"before4am\",value:function before4am(){var date=this.props.date;var today=new Date();var prev_day=new Date();if(today.getDay()===1){prev_day.setDate(prev_day.getDate()-3);return date.toDateString()===prev_day.toDateString()&&today.getHours()<4;}else if(today.getDay()>1&&today.getDay()<6){prev_day.setDate(prev_day.getDate()-1);return date.toDateString()===prev_day.toDateString()&&today.getHours()<4;}return false;}},{key:\"showMessageForTeacher\",value:function showMessageForTeacher(){var date=this.props.date;var today=new Date();today.setHours(0,0,0,1);if(date.toDateString()===today.toDateString()&&this.editable()){return true;}else if(date<today){return true;}return false;}},{key:\"render\",value:function render(){var _this2=this;var _this$state2=this.state,items_to_bring=_this$state2.items_to_bring,activities=_this$state2.activities,text=_this$state2.text,teacher_id=_this$state2.teacher_id,isLoading=_this$state2.isLoading,data_available=_this$state2.data_available,message_for_teacher=_this$state2.message_for_teacher,scrollHeight=_this$state2.scrollHeight,message_read=_this$state2.message_read;var date=this.props.date;return React.createElement(Card,{style:{width:'93%'}},React.createElement(View,{style:{flex:1,flexDirection:'row'}},React.createElement(View,{style:{width:56,height:56,alignItems:'center',justifyContent:'center'}},React.createElement(Image,{source:require(\"../../assets/icon-message.png\"),style:{width:48,height:48}})),React.createElement(View,{style:{flex:1}},React.createElement(View,{style:{paddingTop:8}},React.createElement(Text,{style:{fontSize:20}},\"\\u8A0A\\u606F\")),isLoading?React.createElement(Reloading,null):data_available?React.createElement(View,{style:{flex:1,paddingVertical:8,paddingRight:8}},React.createElement(View,{style:{padding:5,marginBottom:6,backgroundColor:'#F5F5F5'}},React.createElement(Text,{style:{color:'rgba(0,0,0,0.8)',fontSize:15}},\"\\u611B\\u7684\\u5C0F\\u8A9E\"),React.createElement(Text,{style:{fontSize:25,paddingVertical:7}},text)),React.createElement(View,{style:{flexDirection:'row'}},React.createElement(View,{style:{flex:1,padding:5,backgroundColor:'#F5F5F5',marginRight:3}},React.createElement(Text,{style:{color:'rgba(0,0,0,0.8)',fontSize:15}},\"\\u5BB6\\u9577\\u6E96\\u5099\"),items_to_bring.length?React.createElement(View,{style:{alignItems:'center',paddingVertical:7}},items_to_bring.map(function(item,index){return React.createElement(Text,{key:index,style:{padding:5,backgroundColor:'lightgrey',marginBottom:3,fontSize:25}},item);})):null),React.createElement(View,{style:{flex:1,padding:5,backgroundColor:'#F5F5F5',marginLeft:3}},React.createElement(Text,{style:{color:'rgba(0,0,0,0.8)',fontSize:15}},\"\\u4ECA\\u65E5\\u6D3B\\u52D5\"),activities.length?React.createElement(View,{style:{alignItems:'center',paddingVertical:7}},activities.map(function(activity,index){return React.createElement(Text,{key:index,style:{padding:5,backgroundColor:'lightgrey',marginBottom:3,fontSize:25}},activity);})):null)),React.createElement(View,{style:{backgroundColor:'#ffddb7',marginTop:5}},React.createElement(View,{style:{padding:5,flexDirection:'row',justifyContent:'space-between'}},React.createElement(Text,{style:{fontSize:15}},\"\\u7D66\\u8001\\u5E2B\\u7684\\u8A71\"),message_for_teacher!==''&&React.createElement(Text,{style:{fontSize:15}},message_read?'已讀':'未讀')),React.createElement(TextInput,{editable:this.editable(),style:{height:scrollHeight,justifyContent:'center',backgroundColor:'rgba(255,255,255,0.7)',paddingTop:10,padding:10,fontSize:25},placeholder:this.editable()?'點擊我開始填寫...':isLoading?'下載中...':'已不能填寫',scrollEnabled:false,multiline:true,value:message_for_teacher,onChangeText:function onChangeText(message_for_teacher){return _this2.setState({message_for_teacher:message_for_teacher});},onChange:function onChange(e){return _this2.setScrollHeight(e.target.scrollHeight);},onLayout:function onLayout(event){var scrollHeight=event.nativeEvent.target.scrollHeight;_this2.setState({scrollHeight:scrollHeight});}}),React.createElement(TouchableOpacity,{disabled:!this.editable(),style:{padding:10,justifyContent:'center'},onClick:function onClick(){return _this2.sendMessage();}},React.createElement(Text,{style:{fontSize:25,alignSelf:'center'}},\"\\u9001\\u51FA\")))):React.createElement(View,{style:{flex:1,paddingVertical:8,paddingRight:8}},React.createElement(Text,{style:{fontSize:17}},\"\\u6C92\\u6709\\u65B0\\u7D00\\u9304\"),this.showMessageForTeacher()&&React.createElement(View,{style:{backgroundColor:'#ffddb7',marginTop:5}},React.createElement(View,{style:{padding:5,flexDirection:'row',justifyContent:'space-between'}},React.createElement(Text,{style:{fontSize:15}},\"\\u7D66\\u8001\\u5E2B\\u7684\\u8A71\"),message_for_teacher!==''&&React.createElement(Text,{style:{fontSize:15}},message_read?'已讀':'未讀')),React.createElement(TextInput,{editable:this.editable(),style:{height:scrollHeight,justifyContent:'center',backgroundColor:'rgba(255,255,255,0.7)',paddingTop:10,padding:10,fontSize:25},placeholder:this.editable()?'點擊我開始填寫...':isLoading?'下載中...':'已不能填寫',scrollEnabled:false,multiline:true,value:message_for_teacher,onChangeText:function onChangeText(message_for_teacher){return _this2.setState({message_for_teacher:message_for_teacher});},onChange:function onChange(e){return _this2.setScrollHeight(e.target.scrollHeight);}}),React.createElement(TouchableOpacity,{disabled:!this.editable(),style:{padding:10,justifyContent:'center'},onClick:function onClick(){return _this2.sendMessage();}},React.createElement(Text,{style:{fontSize:25,alignSelf:'center'}},\"\\u9001\\u51FA\")))))));}}]);return MessageCard;}(React.Component);export{MessageCard as default};","map":{"version":3,"sources":["/home/caleb_lee/gina_web_app/components/parent/messagecard.js"],"names":["React","Card","Body","formatDate","fetchData","post","beautifyTime","formatTime","get","Reloading","MessageCard","props","state","child_id","isLoading","data_available","items_to_bring","activities","text","teacher_id","message_id","message_for_teacher","isConnected","scrollHeight","message_read","bind","date","Date","getTime","prevProps","setState","propDate","getHours","start_date","setDate","getDate","end_date","messageData","data","undefined","denormalize","message_data","items_list","activities_list","i","length","push","other_item","other_activity","class_id","parent_id","editable","alert","body","student_id","timestamp","response","success","statusCode","message","threshold","getDay","setHours","before4am","today","prev_day","toDateString","width","flex","flexDirection","height","alignItems","justifyContent","require","paddingTop","fontSize","paddingVertical","paddingRight","padding","marginBottom","backgroundColor","color","marginRight","map","item","index","marginLeft","activity","marginTop","e","setScrollHeight","target","event","nativeEvent","sendMessage","alignSelf","showMessageForTeacher","Component"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { View, Text, Image, TextInput, TouchableOpacity, Alert } from 'react-native'\nimport { Card, Body } from 'native-base'\nimport { formatDate, fetchData, post, beautifyTime, formatTime, get } from '../util'\nimport Reloading from '../reloading'\n\nexport default class MessageCard extends React.Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      child_id: this.props.child_id,\n      isLoading: true,\n      data_available: false,\n      items_to_bring: [],\n      activities: [],\n      text: '',\n      teacher_id: '',\n      message_id: null,\n      message_for_teacher: '',\n      isConnected: true,\n      scrollHeight: '100%',\n      message_read: false\n    }\n    this.fetchData = this.fetchData.bind(this)\n  }\n\n  componentDidMount() {\n    const { date } = this.props\n    this.fetchData(this.state.child_id, new Date(date.getTime()))\n    // this.fetchDiaperAmount(child_id)\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.date !== prevProps.date) {\n      this.setState({ isLoading: true, message_for_teacher: '', scrollHeight: '100%' })\n      this.fetchData(this.props.child_id, new Date(this.props.date.getTime()));\n    } else if (this.props.child_id !== prevProps.child_id) {\n      this.setState({ isLoading: true, message_for_teacher: '', scrollHeight: '100%' })\n      this.fetchData(this.props.child_id, new Date());\n    } else if (this.props.isConnected != prevProps.isConnected) {\n      this.setState({\n        isConnected: this.props.isConnected\n      })\n    }\n  }\n\n  setScrollHeight(scrollHeight) {\n    this.setState({ scrollHeight })\n  }\n\n  async fetchData(child_id, propDate) {\n    let date = new Date(propDate.getTime())\n    if (date.getHours() < 17) {\n      this.setState({\n        isLoading: false,\n        message_for_teacher: '',\n        data_available: false\n      })\n      return\n    }\n    const start_date = formatDate(date)\n    date.setDate(date.getDate() + 1)\n    const end_date = formatDate(date)\n    const messageData = await fetchData('message', child_id, start_date, end_date)\n    if (messageData.data === undefined || messageData.data[start_date] === undefined) {\n      this.setState({\n        isLoading: false,\n        message_for_teacher: '',\n        data_available: false\n      })\n      return\n    }\n    this.denormalize(messageData.data[start_date])\n  }\n\n  // async fetchDiaperAmount(student_id) {\n  //   const response = await get(`/diaper/amount?student_id=${student_id}`)\n  //   const { success, statusCode, message, data } = response\n  //   if(!success) {\n  //     alert('Sorry 讀取尿布量時電腦出狀況了！請截圖和與工程師聯繫' + message)\n  //     return\n  //   }\n  //   console.log(response)\n  //   if (data <= 3) {\n  //     console.log('here')\n  //     this.setState({\n  //       data_available: true,\n  //       items_to_bring: [`尿布剩${data}片`]\n  //     })\n  //   }\n  // }\n\n  denormalize(message_data) {\n    const items_list = ['母奶粉', '尿布', '水壺', '衣物']\n    const activities_list = ['嬰兒按摩', '音樂律動', '教具操作', '繪本欣賞', '認知圖片', '體能活動', '藝術創作', '多元語言']\n    const items_to_bring = []\n    const activities = []\n    for (var i = 0; i < message_data.items_to_bring.length-1; i++) {\n      if (message_data.items_to_bring[i]) {\n        items_to_bring.push(items_list[i])\n      }\n    }\n\n    if (message_data.items_to_bring[message_data.items_to_bring.length-1]) {\n      items_to_bring.push(message_data.other_item)\n    }\n\n    for (var i = 0; i < message_data.activities.length - 1; i++) {\n      if (message_data.activities[i]) {\n        activities.push(activities_list[i])\n      }\n    }\n\n    if (message_data.activities[message_data.activities.length - 1]) {\n      activities.push(message_data.other_activity)\n    }\n\n    this.setState({\n      isLoading: false,\n      data_available: true,\n      message_id: message_data.message_id,\n      items_to_bring,\n      activities,\n      text: message_data.text,\n      teacher_id: message_data.teacher_id,\n      message_for_teacher: message_data.message_for_teacher,\n      message_read: message_data.message_read\n    })\n  }\n\n  async sendMessage() {\n    const { class_id, parent_id, date } = this.props\n    const { message_for_teacher, message_id, isConnected } = this.state\n    if (!this.editable() || message_for_teacher === '') return\n    if (!isConnected) {\n      alert('網路連不到! 請稍後再試試看')\n      return\n    }\n\n    // const now = new Date()\n    const body = {\n      student_id: this.props.child_id,\n      parent_id,\n      message_id,\n      message_for_teacher,\n      timestamp: formatDate(date) + ' ' + formatTime(date)\n    }\n    const response = await post(`/message/class/${class_id}`, body)\n    const { success, statusCode, message, data } = response\n    if (!success) {\n      alert(`Sorry 傳送訊息時電腦出狀況了！請截圖和與工程師聯繫\\n\\n` + message)\n      return \n    }\n    alert(`訊息傳達成功！`)\n    // const { date } = this.props\n    this.fetchData(this.state.child_id, new Date(date.getTime()))\n  }\n\n  editable() {\n    const { date } = this.props\n    // console.log('date: ', date)\n    let threshold = new Date()\n    if (threshold.getDay() === 6) { // if today is saturday\n      threshold.setDate(threshold.getDate() - 1)\n    } else if (threshold.getDay() === 0) { // if today is sunday\n      threshold.setDate(threshold.getDate() - 2)\n    }\n    threshold.setHours(17, 0, 0, 0)\n    return date.getTime() >= threshold.getTime() || this.before4am()\n  }\n\n  before4am() {\n    const { date } = this.props\n    let today = new Date()\n    let prev_day = new Date() \n    if (today.getDay() === 1) { // if today is monday, prev_day is last friday\n      prev_day.setDate(prev_day.getDate() - 3)\n      return date.toDateString() === prev_day.toDateString() && today.getHours() < 4\n    } else if (today.getDay() > 1 && today.getDay() < 6) { // today is [ tues, fri ]\n      prev_day.setDate(prev_day.getDate() - 1)\n      return date.toDateString() === prev_day.toDateString() && today.getHours() < 4\n    }\n    return false\n  }\n\n  showMessageForTeacher(){\n    const { date } = this.props\n    let today = new Date()\n    today.setHours(0,0,0,1)\n\n    if (date.toDateString() === today.toDateString() && this.editable()) {\n      return true\n    } else if (date < today) {\n      return true\n    }\n    return false\n  }\n\n  render() {\n    const { items_to_bring, activities, text, teacher_id, isLoading, data_available, message_for_teacher, scrollHeight, message_read } = this.state\n    const { date } = this.props\n    // console.log(date.toDateString())\n    return (\n      <Card style={{ width: '93%' }}>\n        <View style={{ flex: 1, flexDirection: 'row' }}>\n          <View style={{ width: 56, height: 56, alignItems: 'center', justifyContent: 'center'}}>\n            <Image\n              source={require('../../assets/icon-message.png')}\n              style={{\n                  width: 48,\n                  height: 48\n              }}\n            />\n          </View>\n          <View style={{ flex: 1 }}>\n            <View style={{ paddingTop: 8 }}>\n              <Text style={{ fontSize: 20 }}>訊息</Text>\n            </View>\n            {isLoading ? \n              <Reloading />\n              : data_available ? \n                <View style={{ flex: 1, paddingVertical: 8, paddingRight: 8 }}>\n                  <View style={{ padding: 5, marginBottom: 6, backgroundColor: '#F5F5F5' }}>\n                    <Text style={{color: 'rgba(0,0,0,0.8)', fontSize: 15}}>愛的小語</Text>\n                    <Text style={{ fontSize: 25, paddingVertical: 7 }}>{text}</Text>\n                  </View>\n                  <View\n                    style={{ flexDirection: 'row' }}\n                  >\n                    <View style={{ flex: 1, padding: 5, backgroundColor: '#F5F5F5', marginRight: 3 }}>\n                      <Text style={{color: 'rgba(0,0,0,0.8)', fontSize: 15}}>家長準備</Text>\n                      {items_to_bring.length ?\n                        <View style={{ alignItems: 'center', paddingVertical: 7}}>\n                          {items_to_bring.map((item, index) => {\n                            return(\n                              <Text \n                                key={index} \n                                style={{ \n                                  padding: 5, \n                                  backgroundColor: 'lightgrey', \n                                  marginBottom: 3,\n                                  fontSize: 25\n                                }}\n                              >\n                                {item}\n                              </Text>\n                            )\n                          })}\n                        </View>\n                        : null\n                      }\n                    </View>\n                    <View style={{ flex: 1, padding: 5, backgroundColor: '#F5F5F5', marginLeft: 3 }}>\n                      <Text style={{color: 'rgba(0,0,0,0.8)', fontSize: 15}}>今日活動</Text>\n                      {activities.length ?\n                        <View style={{ alignItems: 'center', paddingVertical: 7}}>\n                          {activities.map((activity, index) => {\n                            return(\n                              <Text \n                                key={index}\n                                style={{ \n                                  padding: 5, \n                                  backgroundColor: 'lightgrey', \n                                  marginBottom: 3,\n                                  fontSize: 25\n                                }}\n                              >\n                                {activity}\n                              </Text>\n                            )\n                          })}\n                        </View>\n                        : null\n                      }\n                    </View>\n                  </View>\n\n                  {/* message for teacher */}\n                  <View style={{ backgroundColor: '#ffddb7', marginTop: 5}}>\n                    <View style={{ padding: 5, flexDirection: 'row', justifyContent: 'space-between' }}>\n                      <Text style={{ fontSize: 15 }}>給老師的話</Text>\n                      {message_for_teacher !== '' && <Text style={{ fontSize: 15 }}>{message_read ? '已讀' : '未讀'}</Text>}\n                    </View>\n                    \n                    <TextInput\n                      editable={this.editable()}\n                      style={{\n                        // marginHorizontal: 15,\n                        height: scrollHeight,\n                        justifyContent: 'center',\n                        backgroundColor: 'rgba(255,255,255,0.7)',\n                        paddingTop: 10,\n                        padding: 10,\n                        fontSize: 25\n                      }}\n                      // textAlignVertical={\"top\"}\n                      placeholder={this.editable() ? \n                        '點擊我開始填寫...' \n                        : isLoading ?\n                          '下載中...'\n                          :'已不能填寫'}\n                      scrollEnabled={false}\n                      multiline={true}\n                      // blurOnSubmit={true}\n                      // maxLength={200}\n                      value={message_for_teacher}\n                      onChangeText={(message_for_teacher) => this.setState({ message_for_teacher })}\n                      onChange={(e) => this.setScrollHeight(e.target.scrollHeight)}\n                      onLayout={(event) => {\n                        const { scrollHeight } = event.nativeEvent.target\n                        this.setState({\n                            scrollHeight\n                        })\n                      }}\n                    />\n                    <TouchableOpacity\n                      disabled={!this.editable()}\n                      style={{ padding: 10, justifyContent: 'center' }}\n                      onClick={() => this.sendMessage()}\n                    >\n                      <Text style={{ fontSize: 25, alignSelf: 'center' }}>送出</Text>\n                    </TouchableOpacity>\n                  </View>\n                </View>\n                : <View style={{ flex: 1, paddingVertical: 8, paddingRight: 8 }}>\n                    <Text style={{ fontSize: 17 }}>沒有新紀錄</Text>\n                  {/* message for teacher */}\n                  {this.showMessageForTeacher() && \n                  <View style={{ backgroundColor: '#ffddb7', marginTop: 5}}>\n                    <View style={{ padding: 5, flexDirection: 'row', justifyContent: 'space-between' }}>\n                      <Text style={{ fontSize: 15 }}>給老師的話</Text>\n                      {message_for_teacher !== '' && <Text style={{ fontSize: 15 }}>{message_read ? '已讀' : '未讀'}</Text>}\n                    </View>\n                    \n                    <TextInput\n                      editable={this.editable()}\n                      style={{\n                        // marginHorizontal: 15,\n                        height: scrollHeight,\n                        justifyContent: 'center',\n                        backgroundColor: 'rgba(255,255,255,0.7)',\n                        paddingTop: 10,\n                        padding: 10,\n                        fontSize: 25\n                      }}\n                      // textAlignVertical={\"top\"}\n                      placeholder={this.editable() ? \n                        '點擊我開始填寫...' \n                        : isLoading ?\n                          '下載中...'\n                          :'已不能填寫'}\n                      scrollEnabled={false}\n                      multiline={true}\n                      // blurOnSubmit={true}\n                      // maxLength={200}\n                      value={message_for_teacher}\n                      onChangeText={(message_for_teacher) => this.setState({ message_for_teacher })}\n                      onChange={(e) => this.setScrollHeight(e.target.scrollHeight)}\n                    />\n                    <TouchableOpacity\n                      disabled={!this.editable()}\n                      style={{ padding: 10, justifyContent: 'center' }}\n                      onClick={() => this.sendMessage()}\n                    >\n                      <Text style={{ fontSize: 25, alignSelf: 'center' }}>送出</Text>\n                    </TouchableOpacity>\n                  </View>\n                  }\n                </View>\n            }\n          </View>\n        </View>\n      </Card>\n    );\n  }\n}"]},"metadata":{},"sourceType":"module"}