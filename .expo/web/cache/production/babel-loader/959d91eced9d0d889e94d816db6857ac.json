{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _inherits from\"@babel/runtime/helpers/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import React from'react';import View from\"react-native-web/dist/exports/View\";import TouchableOpacity from\"react-native-web/dist/exports/TouchableOpacity\";import Text from\"react-native-web/dist/exports/Text\";import Animated from\"react-native-web/dist/exports/Animated\";import ScrollView from\"react-native-web/dist/exports/ScrollView\";import Alert from\"react-native-web/dist/exports/Alert\";import SectionList from\"react-native-web/dist/exports/SectionList\";import Dimensions from\"react-native-web/dist/exports/Dimensions\";import Platform from\"react-native-web/dist/exports/Platform\";import MedicationRequestMain from\"./medicationrequestmain\";import{formatDate,beautifyTime,beautifyDate,beautifyMonthDate,get}from\"../util\";import{bindActionCreators}from'redux';import{connect}from'react-redux';import{getMedRequestSuccess}from\"../../redux/parent/actions/index\";import ENV from\"../../variables\";var _Dimensions$get=Dimensions.get('window'),width=_Dimensions$get.width;var MedicationRequestPage=function(_React$Component){_inherits(MedicationRequestPage,_React$Component);var _super=_createSuper(MedicationRequestPage);function MedicationRequestPage(props){var _this;_classCallCheck(this,MedicationRequestPage);_this=_super.call(this,props);_this.state={today:new Date(),tomorrow:new Date(),SlideInRight:new Animated.Value(0),SlideInLeft:new Animated.Value(0),total_height:1,total_width:1,height:0,width:0,left:0,top:0,requests:[],day_of_week:['天','一','二','三','四','五','六'],selected_request_index:-1};return _this;}_createClass(MedicationRequestPage,[{key:\"componentDidMount\",value:function componentDidMount(){var selected_request_index=this.props.route.params.selected_request_index;var tomorrow=this.state.tomorrow;tomorrow.setDate(tomorrow.getDate()+1);this.setState({tomorrow:tomorrow});this.fetchMedicationRequest();this.initializePage();if(selected_request_index!==undefined){this.selectRequest(selected_request_index);}}},{key:\"isIOS\",value:function isIOS(){return Platform.OS==='ios';}},{key:\"fetchMedicationRequest\",value:function fetchMedicationRequest(){var isConnected,_this$props$route$par,student_id,onGoBack,date,response,success,statusCode,message,data;return _regeneratorRuntime.async(function fetchMedicationRequest$(_context){while(1){switch(_context.prev=_context.next){case 0:isConnected=this.props.isConnected;if(isConnected){_context.next=4;break;}alert('網路連不到! 請稍後再試試看');return _context.abrupt(\"return\");case 4:_this$props$route$par=this.props.route.params,student_id=_this$props$route$par.student_id,onGoBack=_this$props$route$par.onGoBack;date=formatDate(new Date());_context.next=8;return _regeneratorRuntime.awrap(get(\"/medicationrequest/student/\"+student_id+\"?date=\"+date));case 8:response=_context.sent;success=response.success,statusCode=response.statusCode,message=response.message,data=response.data;if(success){_context.next=13;break;}alert('Sorry 取得托藥單時電腦出狀況了！請稍後再試試或請截圖和與工程師聯繫\\n\\n'+message);return _context.abrupt(\"return\");case 13:this.denormalize(data);this.setState({requests:data});onGoBack();case 16:case\"end\":return _context.stop();}}},null,this,null,Promise);}},{key:\"denormalize\",value:function denormalize(object_array){for(var i=0;i<object_array.length;i++){object_array[i].title=new Date(object_array[i].title);for(var j=0;j<object_array[i].data.length;j++){object_array[i].data[j].timestamp=new Date(object_array[i].data[j].timestamp);}}}},{key:\"initializePage\",value:function initializePage(){Animated.sequence([Animated.timing(this.state.SlideInRight,{toValue:1,duration:1000,useNativeDriver:true}),Animated.timing(this.state.SlideInLeft,{toValue:1,duration:1000,useNativeDriver:true})]).start();}},{key:\"viewRequest\",value:function viewRequest(){var _this2=this;this.setState({SlideInLeft:new Animated.Value(0)},function(){Animated.timing(_this2.state.SlideInLeft,{toValue:1,duration:1000,useNativeDriver:true}).start();});}},{key:\"selectRequest\",value:function selectRequest(index){var access_mode=this.refs['main'].fetchAccessMode();if(access_mode==='edit'){alert('還在編輯中喔請完成再離開 多謝');return;}this.setState({selected_request_index:index});}},{key:\"onCreateRequestSuccess\",value:function onCreateRequestSuccess(request_id){var requests,new_request_index,i;return _regeneratorRuntime.async(function onCreateRequestSuccess$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return _regeneratorRuntime.awrap(this.fetchMedicationRequest());case 2:requests=this.state.requests;this.get_todays_requests(requests);new_request_index=-1;i=0;case 6:if(!(i<requests.length)){_context2.next=13;break;}if(!(requests[i].id===request_id)){_context2.next=10;break;}new_request_index=i;return _context2.abrupt(\"break\",13);case 10:i++;_context2.next=6;break;case 13:this.setState({selected_request_index:new_request_index});case 14:case\"end\":return _context2.stop();}}},null,this,null,Promise);}},{key:\"get_todays_requests\",value:function get_todays_requests(object_array){var med_requests=[];for(var i=0;i<object_array.length;i++){var timestamp=new Date(object_array[i].timestamp);if(timestamp.toDateString()===new Date().toDateString()){object_array[i].timestamp=timestamp;med_requests.push(object_array[i]);}else break;}this.props.getMedRequestSuccess(med_requests);}},{key:\"onDeleteRequestSuccess\",value:function onDeleteRequestSuccess(deleted_request_id){var requests=this.state.requests;var updated_requests=[];for(var i=0;i<requests.length;i++){if(requests[i].id!==deleted_request_id){updated_requests.push(requests[i]);}}this.setState({requests:updated_requests,selected_request_index:0});this.get_todays_requests(updated_requests);}},{key:\"deleteRequestConfirm\",value:function deleteRequestConfirm(request_id){var confirmed=confirm('確定要刪除？');if(confirmed){this.deleteRequest(request_id);}}},{key:\"deleteRequest\",value:function deleteRequest(request_id){var _this3=this;var isConnected=this.props.isConnected;if(!isConnected){alert('網路連不到! 請稍後再試試看');return;}var class_id=this.props.route.params.class_id;fetch(\"https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/\"+ENV+\"/medicationrequest/\"+request_id,{method:'DELETE',headers:{Accept:'application/json','Content-Type':'application/json'},body:JSON.stringify({class_id:class_id})}).then(function(res){return res.json();}).then(function(resJson){var statusCode=resJson.statusCode,message=resJson.message,data=resJson.data;if(statusCode>200||message==='Internal Server Error'){alert('Sorry 電腦出狀況了！請截圖和與工程師聯繫'+message);return;}_this3.fetchMedicationRequest();}).catch(function(err){alert('Sorry 電腦出狀況了！請截圖和與工程師聯繫: error occurred when deleting medication request');});}},{key:\"render\",value:function render(){var _this4=this;var _this$state=this.state,SlideInRight=_this$state.SlideInRight,SlideInLeft=_this$state.SlideInLeft,total_width=_this$state.total_width,requests=_this$state.requests,today=_this$state.today,tomorrow=_this$state.tomorrow,day_of_week=_this$state.day_of_week,selected_request_index=_this$state.selected_request_index;var _this$props$route$par2=this.props.route.params,student_id=_this$props$route$par2.student_id,class_id=_this$props$route$par2.class_id;return React.createElement(View,{style:{flex:1,paddingHorizontal:20}},requests.length===0&&React.createElement(View,{style:{padding:20,justifyContent:'center',alignItems:'center'}},React.createElement(Text,{style:{fontSize:50}},\"\\u7121\\u6258\\u85E5\\u55AE\")),React.createElement(SectionList,{sections:requests,keyExtractor:function keyExtractor(item,index){return item+index;},renderItem:function renderItem(_ref){var item=_ref.item,index=_ref.index,section=_ref.section;return React.createElement(View,{style:{width:'100%',aspectRatio:5,flexDirection:'row',marginVertical:7,justifyContent:'space-between',alignItems:'center'}},React.createElement(TouchableOpacity,{style:{width:'65%',height:'100%',padding:20,backgroundColor:'#368cbf',borderRadius:40,justifyContent:'center',alignItems:'center'},onClick:function onClick(){return _this4.props.navigation.push('AddMedicationRequestPage',{onGoBack:function onGoBack(){return _this4.fetchMedicationRequest();},student_id:student_id,class_id:class_id,index:index,data:section.data});}},React.createElement(Text,{style:{fontSize:30}},beautifyTime(item.timestamp))),React.createElement(TouchableOpacity,{style:{width:'30%',height:'100%',padding:20,backgroundColor:'#fa625f',justifyContent:'center',borderRadius:40},onClick:function onClick(){return _this4.deleteRequestConfirm(item.id);}},React.createElement(Text,{style:{fontSize:width*0.07,textAlign:'center'}},\"\\u522A\\u9664\")));},renderSectionHeader:function renderSectionHeader(_ref2){var title=_ref2.section.title;return React.createElement(View,{style:{width:'100%',backgroundColor:'rgba(0,0,0,0.5)',flexDirection:'row',alignItems:'center',justifyContent:'space-between',padding:_this4.isIOS()?20:12,marginTop:15,marginBottom:7,borderRadius:40}},React.createElement(Text,{style:{fontSize:30,color:'white'}},\"\"+beautifyMonthDate(title)),React.createElement(Text,{style:{fontSize:30,color:'white'}},\"\\u661F\\u671F\"+day_of_week[title.getDay()]));}}),React.createElement(View,{style:{width:'100%',paddingVertical:10,justifyContent:'center',backgroundColor:'transparent'}},React.createElement(TouchableOpacity,{style:{backgroundColor:'#f4d41f',padding:this.isIOS()?20:12,justifyContent:'center',borderRadius:40},onClick:function onClick(){return _this4.props.navigation.push('AddMedicationRequestPage',{onGoBack:function onGoBack(){return _this4.fetchMedicationRequest();},student_id:student_id,class_id:class_id,index:-1,data:null});}},React.createElement(Text,{style:{fontSize:30,alignSelf:'center'}},\"\\u65B0\\u589E\"))));}}]);return MedicationRequestPage;}(React.Component);var mapStateToProps=function mapStateToProps(state){return{isConnected:state.parent.isConnected};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return _objectSpread({},bindActionCreators({getMedRequestSuccess:getMedRequestSuccess},dispatch));};export default connect(mapStateToProps,mapDispatchToProps)(MedicationRequestPage);","map":{"version":3,"sources":["/home/caleb_lee/gina_web_app/components/parent/medicationrequestpage.js"],"names":["React","MedicationRequestMain","formatDate","beautifyTime","beautifyDate","beautifyMonthDate","get","bindActionCreators","connect","getMedRequestSuccess","ENV","Dimensions","width","MedicationRequestPage","props","state","today","Date","tomorrow","SlideInRight","Animated","Value","SlideInLeft","total_height","total_width","height","left","top","requests","day_of_week","selected_request_index","route","params","setDate","getDate","setState","fetchMedicationRequest","initializePage","undefined","selectRequest","Platform","OS","isConnected","alert","student_id","onGoBack","date","response","success","statusCode","message","data","denormalize","object_array","i","length","title","j","timestamp","sequence","timing","toValue","duration","useNativeDriver","start","index","access_mode","refs","fetchAccessMode","request_id","get_todays_requests","new_request_index","id","med_requests","toDateString","push","deleted_request_id","updated_requests","confirmed","confirm","deleteRequest","class_id","fetch","method","headers","Accept","body","JSON","stringify","then","res","json","resJson","catch","err","flex","paddingHorizontal","padding","justifyContent","alignItems","fontSize","item","section","aspectRatio","flexDirection","marginVertical","backgroundColor","borderRadius","navigation","deleteRequestConfirm","textAlign","isIOS","marginTop","marginBottom","color","getDay","paddingVertical","alignSelf","Component","mapStateToProps","parent","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import React from 'react'\nimport {\n    View, TouchableOpacity, Text, Animated, ScrollView, Alert, SectionList, Dimensions, Platform\n} from 'react-native'\nimport MedicationRequestMain from './medicationrequestmain'\nimport { formatDate, beautifyTime, beautifyDate, beautifyMonthDate, get } from '../util'\nimport { bindActionCreators } from 'redux'\nimport { connect } from 'react-redux'\nimport { getMedRequestSuccess } from '../../redux/parent/actions/index'\nimport ENV from '../../variables'\n\n\nconst { width } = Dimensions.get('window')\n\nclass MedicationRequestPage extends React.Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            today: new Date(),\n            tomorrow: new Date(),\n            SlideInRight: new Animated.Value(0),\n            SlideInLeft: new Animated.Value(0),\n            total_height: 1,\n            total_width: 1,\n            height: 0,\n            width: 0,\n            left: 0,\n            top: 0,\n            requests: [],\n            day_of_week: ['天', '一', '二', '三', '四', '五', '六'],\n            selected_request_index: -1\n        }\n    }\n\n    componentDidMount() {\n        const { selected_request_index } = this.props.route.params\n        const { tomorrow } = this.state\n        tomorrow.setDate(tomorrow.getDate() + 1)\n        this.setState({\n            tomorrow\n        })\n        this.fetchMedicationRequest()\n        this.initializePage()\n        if (selected_request_index !== undefined) {\n            // console.log(selected_request_index)\n            this.selectRequest(selected_request_index)\n        }\n    }\n\n    isIOS() {\n        return Platform.OS === 'ios'\n    }\n\n    async fetchMedicationRequest() {\n        const { isConnected } = this.props\n        if (!isConnected) {\n            alert('網路連不到! 請稍後再試試看')\n            return\n        }\n        const {student_id, onGoBack} = this.props.route.params\n        const date = formatDate(new Date())\n        const response = await get(`/medicationrequest/student/${student_id}?date=${date}`)\n        const { success, statusCode, message, data } = response\n        // console.log('fetchMedicationRequest: ', response)\n        if (!success) {\n            alert('Sorry 取得托藥單時電腦出狀況了！請稍後再試試或請截圖和與工程師聯繫\\n\\n' + message)\n            return\n        }\n        this.denormalize(data)\n        this.setState({ requests: data })\n        onGoBack()\n    }\n\n    denormalize(object_array) {\n        for (var i = 0; i < object_array.length; i++) {\n            object_array[i].title = new Date(object_array[i].title)\n            for (var j = 0; j < object_array[i].data.length; j++) {\n                object_array[i].data[j].timestamp = new Date(object_array[i].data[j].timestamp)\n            }\n        }\n    }\n\n    initializePage() {\n        Animated.sequence([\n            Animated.timing(\n                this.state.SlideInRight, \n                {\n                    toValue: 1,\n                    duration: 1000,\n                    useNativeDriver: true\n                }\n            ),\n            Animated.timing(\n                this.state.SlideInLeft,\n                {\n                    toValue: 1,\n                    duration: 1000,\n                    useNativeDriver: true\n                }\n            )\n        ]).start()\n        \n    }\n\n    viewRequest() {\n        this.setState({\n            SlideInLeft: new Animated.Value(0)\n        }, () => {\n            Animated.timing(\n                this.state.SlideInLeft,\n                {\n                    toValue: 1,\n                    duration: 1000,\n                    useNativeDriver: true\n                }\n            ).start()\n        })\n    }\n\n    selectRequest(index) {\n        const access_mode = this.refs['main'].fetchAccessMode()\n        if (access_mode === 'edit') {\n            alert('還在編輯中喔請完成再離開 多謝')\n            return\n        }\n        this.setState({ selected_request_index: index })\n    }\n\n    async onCreateRequestSuccess(request_id) {\n        await this.fetchMedicationRequest()\n        const { requests } = this.state\n        this.get_todays_requests(requests)\n        let new_request_index = -1\n        for (var i = 0; i < requests.length; i++) {\n            if (requests[i].id === request_id) {\n                new_request_index = i\n                break\n            }\n        }\n        this.setState({\n            selected_request_index: new_request_index\n        })\n    }\n\n    get_todays_requests(object_array) {\n        let med_requests = []\n        for (var i = 0; i < object_array.length; i++) {\n            const timestamp = new Date(object_array[i].timestamp)\n            if (timestamp.toDateString() === (new Date).toDateString()) {\n                object_array[i].timestamp = timestamp\n                med_requests.push(object_array[i])\n            } else break\n        }\n        this.props.getMedRequestSuccess(med_requests)\n    }\n\n    onDeleteRequestSuccess(deleted_request_id) {\n        const { requests } = this.state\n        const updated_requests = []\n        for (var i = 0; i < requests.length; i++) {\n            if (requests[i].id !== deleted_request_id) {\n                updated_requests.push(requests[i])\n            }\n        }\n        this.setState({\n            requests: updated_requests,\n            selected_request_index: 0\n        })\n        this.get_todays_requests(updated_requests)\n    }\n\n    deleteRequestConfirm(request_id) {\n        const confirmed = confirm('確定要刪除？')\n        if (confirmed) {\n            this.deleteRequest(request_id)\n        }\n    }\n\n    deleteRequest(request_id) {\n        const { isConnected } = this.props\n        if (!isConnected) {\n            alert('網路連不到! 請稍後再試試看')\n            return\n        }\n        const { class_id } = this.props.route.params\n        fetch(`https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/${ENV}/medicationrequest/${request_id}`, {\n          method: 'DELETE',\n          headers: {\n            Accept: 'application/json',\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            class_id\n          })\n        })\n          .then((res) => res.json())\n          .then((resJson) => {\n            const { statusCode, message, data } = resJson\n            if (statusCode > 200 || message === 'Internal Server Error') {\n              alert('Sorry 電腦出狀況了！請截圖和與工程師聯繫' + message)\n              return\n            }\n            this.fetchMedicationRequest()\n          })\n          .catch(err => {\n            alert('Sorry 電腦出狀況了！請截圖和與工程師聯繫: error occurred when deleting medication request')\n          })\n      }\n\n    render () {\n        const { SlideInRight, SlideInLeft, total_width, requests, today, tomorrow, day_of_week, selected_request_index } = this.state\n        const { student_id, class_id } = this.props.route.params\n        // const selected_request = requests[selected_request_index]\n        return (\n            <View\n                style={{\n                    flex: 1,\n                    paddingHorizontal: 20\n                }}\n            >\n                {requests.length === 0 && \n                    <View style={{ padding: 20, justifyContent: 'center', alignItems: 'center' }}>\n                        <Text style={{ fontSize: 50 }}>無托藥單</Text>\n                    </View>\n                }\n                <SectionList\n                    sections={requests}\n                    keyExtractor={(item, index) => item + index}\n                    renderItem={({ item, index, section }) => \n                        <View \n                            style={{ \n                                width: '100%', \n                                aspectRatio: 5, \n                                flexDirection: 'row', \n                                marginVertical: 7, \n                                justifyContent: 'space-between', \n                                alignItems: 'center'\n                            }}\n                        >\n                            <TouchableOpacity \n                                style={{ \n                                    width:'65%',\n                                    height: '100%',\n                                    padding: 20, \n                                    backgroundColor: '#368cbf',\n                                    borderRadius: 40,\n                                    justifyContent: 'center',\n                                    alignItems: 'center'\n                                }}\n                                onClick={() => this.props.navigation.push('AddMedicationRequestPage', {\n                                    onGoBack: () => this.fetchMedicationRequest(),\n                                    student_id,\n                                    class_id,\n                                    index,\n                                    data: section.data\n                                })}\n                            >\n                                <Text style={{ fontSize: 30 }}>{beautifyTime(item.timestamp)}</Text>\n                            </TouchableOpacity>\n                            <TouchableOpacity\n                                style={{ \n                                    width:'30%', \n                                    height: '100%',\n                                    padding: 20, \n                                    backgroundColor: '#fa625f', \n                                    justifyContent: 'center',\n                                    borderRadius: 40\n                                }}\n                                onClick={() => this.deleteRequestConfirm(item.id)}\n                            >\n                                <Text style={{ fontSize: width * 0.07, textAlign: 'center' }}>\n                                    刪除\n                                </Text>\n                            </TouchableOpacity>\n                        </View>\n                    }\n                    renderSectionHeader={({ section: { title } }) => (\n                        <View\n                            style={{ \n                                width: '100%', \n                                backgroundColor: 'rgba(0,0,0,0.5)', \n                                flexDirection: 'row', \n                                alignItems: 'center', \n                                justifyContent: 'space-between',\n                                padding: this.isIOS() ? 20 : 12,\n                                marginTop: 15,\n                                marginBottom: 7,\n                                borderRadius: 40\n                            }}\n                        >\n                            <Text style={{ fontSize: 30, color: 'white' }}>{`${beautifyMonthDate(title)}`}</Text>\n                            <Text style={{ fontSize: 30, color: 'white' }}>{`星期${day_of_week[title.getDay()]}`}</Text>\n                        </View>\n                    )}\n                />\n\n                <View style={{ width: '100%', paddingVertical: 10, justifyContent: 'center', backgroundColor: 'transparent' }}>\n                    <TouchableOpacity\n                        style={{ backgroundColor: '#f4d41f', padding: this.isIOS() ? 20 : 12, justifyContent: 'center', borderRadius: 40 }}\n                        onClick={() => this.props.navigation.push('AddMedicationRequestPage', {\n                            onGoBack: () => this.fetchMedicationRequest(),\n                            student_id, \n                            class_id,\n                            index: -1,\n                            data: null\n                        })}\n                    >\n                        <Text style={{ fontSize: 30, alignSelf: 'center' }}>\n                            新增\n                        </Text>\n                    </TouchableOpacity>\n                </View>\n\n                \n            </View>\n        )\n    }\n}\n\nconst mapStateToProps = (state) => {\n    return {\n        isConnected: state.parent.isConnected\n    }\n}\n\nconst mapDispatchToProps = (dispatch) => {\n    return {\n        ...bindActionCreators({getMedRequestSuccess}, dispatch)\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(MedicationRequestPage)"]},"metadata":{},"sourceType":"module"}