{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nvar _jsxFileName = \"/home/caleb_lee/gina_web_app/components/teacher/admin/teachers.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function () { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from 'react';\nimport View from \"react-native-web/dist/exports/View\";\nimport ScrollView from \"react-native-web/dist/exports/ScrollView\";\nimport TouchableHighlight from \"react-native-web/dist/exports/TouchableHighlight\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport Platform from \"react-native-web/dist/exports/Platform\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport * as ImagePicker from 'expo-image-picker';\nimport * as Permissions from 'expo-permissions';\nimport { put, delete_by_id, get } from \"../../util\";\nimport { updateTeacherProfilePicture, fetchTeachersSuccess } from \"../../../redux/school/actions/index\";\nimport Modal from \"./modal\";\nimport AddTeacher from \"./addteacher\";\nimport EditTeacher from \"./editteacher\";\n\nvar Teachers = function (_React$Component) {\n  _inherits(Teachers, _React$Component);\n\n  var _super = _createSuper(Teachers);\n\n  function Teachers(props) {\n    var _this;\n\n    _classCallCheck(this, Teachers);\n\n    _this = _super.call(this, props);\n\n    _this.getPermissionAsync = function _callee() {\n      var _await$Permissions$as, status;\n\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (!(Platform.OS === 'ios')) {\n                _context.next = 8;\n                break;\n              }\n\n              _context.next = 3;\n              return _regeneratorRuntime.awrap(Permissions.askAsync(Permissions.CAMERA_ROLL));\n\n            case 3:\n              _await$Permissions$as = _context.sent;\n              status = _await$Permissions$as.status;\n\n              if (!(status !== 'granted')) {\n                _context.next = 8;\n                break;\n              }\n\n              alert(\"Sorry, we need camera roll permissions to make this work!\");\n              return _context.abrupt(\"return\");\n\n            case 8:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    };\n\n    _this._pickImage = function _callee2(teacher_id, url) {\n      var result, base64;\n      return _regeneratorRuntime.async(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              _context2.next = 3;\n              return _regeneratorRuntime.awrap(ImagePicker.launchImageLibraryAsync({\n                mediaTypes: ImagePicker.MediaTypeOptions.All,\n                allowsEditing: true,\n                aspect: [1, 1],\n                quality: 0.4,\n                base64: true\n              }));\n\n            case 3:\n              result = _context2.sent;\n\n              if (!result.cancelled) {\n                base64 = result.base64;\n\n                _this.getProfilePictureURL(base64, teacher_id, url);\n              }\n\n              _context2.next = 10;\n              break;\n\n            case 7:\n              _context2.prev = 7;\n              _context2.t0 = _context2[\"catch\"](0);\n              console.log(_context2.t0);\n\n            case 10:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, null, null, [[0, 7]], Promise);\n    };\n\n    _this.state = {\n      showModal: false,\n      modal_type: '',\n      selected_teacher_id: ''\n    };\n    return _this;\n  }\n\n  _createClass(Teachers, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.getPermissionAsync();\n    }\n  }, {\n    key: \"getProfilePictureURL\",\n    value: function getProfilePictureURL(image, teacher_id, url) {\n      var school_name, teachers, body, response, success, statusCode, message, data;\n      return _regeneratorRuntime.async(function getProfilePictureURL$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              school_name = this.props.route.params.school_name;\n              teachers = this.props.teachers;\n              body = {\n                image: image,\n                url: url,\n                path: school_name + \"/teacher/profile_picture_\" + teacher_id + \"_\" + new Date().getMilliseconds() + \".jpg\"\n              };\n              _context3.next = 5;\n              return _regeneratorRuntime.awrap(put(\"/user/\" + teacher_id + \"/profile-picture\", body));\n\n            case 5:\n              response = _context3.sent;\n              success = response.success, statusCode = response.statusCode, message = response.message, data = response.data;\n\n              if (success) {\n                _context3.next = 10;\n                break;\n              }\n\n              alert(\"Sorry \" + teachers[teacher_id].name + \"\\u7167\\u7247\\u4E0A\\u50B3\\u6642\\u96FB\\u8166\\u51FA\\u72C0\\u6CC1\\u4E86\\uFF01\\u8ACB\\u622A\\u5716\\u548C\\u8207\\u5DE5\\u7A0B\\u5E2B\\u806F\\u7E6B\\n\\n\" + message);\n              return _context3.abrupt(\"return\");\n\n            case 10:\n              this.props.updateTeacherProfilePicture(teacher_id, data.image_url);\n\n            case 11:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, null, this, null, Promise);\n    }\n  }, {\n    key: \"fetchTeacherData\",\n    value: function fetchTeacherData() {\n      var school_id, response, success, statusCode, message, data, admins, teachers, classes;\n      return _regeneratorRuntime.async(function fetchTeacherData$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              school_id = this.props.route.params.school_id;\n              _context4.next = 3;\n              return _regeneratorRuntime.awrap(get(\"/school/\" + school_id + \"/teacher\"));\n\n            case 3:\n              response = _context4.sent;\n              success = response.success, statusCode = response.statusCode, message = response.message, data = response.data;\n\n              if (success) {\n                _context4.next = 8;\n                break;\n              }\n\n              alert('Sorry 取得教師資料時電腦出狀況了！請截圖和與工程師聯繫\\n\\n' + message);\n              return _context4.abrupt(\"return\");\n\n            case 8:\n              admins = data.admins, teachers = data.teachers, classes = data.classes;\n              this.props.fetchTeachersSuccess(admins, teachers, classes);\n\n            case 10:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, null, this, null, Promise);\n    }\n  }, {\n    key: \"getModalContent\",\n    value: function getModalContent() {\n      var _this2 = this;\n\n      var school_id = this.props.route.params.school_id;\n      var _this$props = this.props,\n          classes = _this$props.classes,\n          teachers = _this$props.teachers;\n      var _this$state = this.state,\n          modal_type = _this$state.modal_type,\n          selected_teacher_id = _this$state.selected_teacher_id;\n\n      if (modal_type === 'add_teacher') {\n        return React.createElement(AddTeacher, {\n          classes: classes,\n          school_id: school_id,\n          fetchTeacherData: function fetchTeacherData() {\n            return _this2.fetchTeacherData();\n          },\n          goBack: function goBack() {\n            return _this2.hideModal();\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 99,\n            columnNumber: 14\n          }\n        });\n      } else if (modal_type === 'edit_teacher') {\n        return React.createElement(EditTeacher, {\n          classes: classes,\n          teacher_id: selected_teacher_id,\n          teacher: teachers[selected_teacher_id],\n          fetchTeacherData: function fetchTeacherData() {\n            return _this2.fetchTeacherData();\n          },\n          goBack: function goBack() {\n            return _this2.hideModal();\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 106,\n            columnNumber: 14\n          }\n        });\n      }\n    }\n  }, {\n    key: \"hideModal\",\n    value: function hideModal() {\n      this.setState({\n        showModal: false\n      });\n    }\n  }, {\n    key: \"confirmDeleteTeacher\",\n    value: function confirmDeleteTeacher(teacher_id) {\n      var teachers = this.props.teachers;\n      var confirmed = confirm(teachers[teacher_id].name + \" \\u522A\\u9664\\u78BA\\u8A8D\");\n\n      if (confirmed) {\n        this.deleteTeacher(teacher_id);\n      }\n    }\n  }, {\n    key: \"deleteTeacher\",\n    value: function deleteTeacher(teacher_id) {\n      var response, success, statusCode, message, data;\n      return _regeneratorRuntime.async(function deleteTeacher$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.next = 2;\n              return _regeneratorRuntime.awrap(delete_by_id(\"/user/\" + teacher_id));\n\n            case 2:\n              response = _context5.sent;\n              success = response.success, statusCode = response.statusCode, message = response.message, data = response.data;\n\n              if (success) {\n                _context5.next = 7;\n                break;\n              }\n\n              alert(\"Sorry \" + teachers[teacher_id].name + \"\\u522A\\u9664\\u6642\\u96FB\\u8166\\u51FA\\u72C0\\u6CC1\\u4E86\\uFF01\\u8ACB\\u622A\\u5716\\u548C\\u8207\\u5DE5\\u7A0B\\u5E2B\\u806F\\u7E6B\\n\\n\" + message);\n              return _context5.abrupt(\"return\");\n\n            case 7:\n              this.fetchTeacherData();\n\n            case 8:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, null, this, null, Promise);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var teachers = this.props.teachers;\n      var showModal = this.state.showModal;\n      return React.createElement(View, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 144,\n          columnNumber: 7\n        }\n      }, React.createElement(Modal, {\n        show: showModal,\n        component: this.getModalContent(),\n        hideModal: function hideModal() {\n          return _this3.hideModal();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 145,\n          columnNumber: 9\n        }\n      }), React.createElement(ScrollView, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 150,\n          columnNumber: 9\n        }\n      }, React.createElement(View, {\n        style: {\n          padding: 20\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 151,\n          columnNumber: 11\n        }\n      }, React.createElement(TouchableHighlight, {\n        style: {\n          padding: 10,\n          alignSelf: 'flex-end',\n          backgroundColor: '#ffddb7'\n        },\n        onPress: function onPress() {\n          return _this3.setState({\n            showModal: true,\n            modal_type: 'add_teacher'\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 152,\n          columnNumber: 13\n        }\n      }, React.createElement(Text, {\n        style: {\n          fontSize: 40\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 156,\n          columnNumber: 15\n        }\n      }, \"\\u65B0\\u589E\\u6559\\u5E2B\"))), Object.keys(teachers).map(function (id, index) {\n        var teacher = teachers[id];\n        return React.createElement(View, {\n          key: id,\n          style: {\n            flex: 1,\n            backgroundColor: 'lightgrey',\n            flexDirection: 'row',\n            marginBottom: 10,\n            padding: 15\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 162,\n            columnNumber: 15\n          }\n        }, React.createElement(TouchableHighlight, {\n          style: {},\n          onPress: function onPress() {\n            return _this3._pickImage(id, teacher.profile_picture);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 164,\n            columnNumber: 17\n          }\n        }, React.createElement(Image, {\n          source: teacher.profile_picture === '' ? require(\"../../../assets/icon-teacher-thumbnail.png\") : {\n            uri: teacher.profile_picture\n          },\n          style: {\n            width: 200,\n            height: 200,\n            borderRadius: 100\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 168,\n            columnNumber: 19\n          }\n        })), React.createElement(View, {\n          style: {\n            flex: 5,\n            paddingLeft: 15\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 182,\n            columnNumber: 17\n          }\n        }, React.createElement(View, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 184,\n            columnNumber: 19\n          }\n        }, React.createElement(Text, {\n          style: {\n            fontSize: 50\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 185,\n            columnNumber: 21\n          }\n        }, teacher.name))), React.createElement(View, {\n          style: {\n            flex: 1,\n            justifyContent: 'space-evenly'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 190,\n            columnNumber: 17\n          }\n        }, React.createElement(View, {\n          style: {\n            backgroundColor: 'white'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 191,\n            columnNumber: 19\n          }\n        }, React.createElement(TouchableHighlight, {\n          style: {\n            padding: 15,\n            justifyContent: 'center'\n          },\n          onPress: function onPress() {\n            return _this3.setState({\n              showModal: true,\n              modal_type: 'edit_teacher',\n              selected_teacher_id: id\n            });\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 192,\n            columnNumber: 21\n          }\n        }, React.createElement(Text, {\n          style: {\n            fontSize: 25,\n            alignSelf: 'center'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 196,\n            columnNumber: 23\n          }\n        }, \"\\u7DE8\\u8F2F\"))), React.createElement(View, {\n          style: {\n            backgroundColor: '#fa625f'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 200,\n            columnNumber: 19\n          }\n        }, React.createElement(TouchableHighlight, {\n          style: {\n            padding: 15,\n            justifyContent: 'center'\n          },\n          onPress: function onPress() {\n            return _this3.confirmDeleteTeacher(id);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 201,\n            columnNumber: 21\n          }\n        }, React.createElement(Text, {\n          style: {\n            fontSize: 25,\n            alignSelf: 'center'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 205,\n            columnNumber: 23\n          }\n        }, \"\\u522A\\u9664\")))));\n      })));\n    }\n  }]);\n\n  return Teachers;\n}(React.Component);\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    teachers: state.school.teachers,\n    classes: state.school.classes\n  };\n};\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n  return _objectSpread({}, bindActionCreators({\n    updateTeacherProfilePicture: updateTeacherProfilePicture,\n    fetchTeachersSuccess: fetchTeachersSuccess\n  }, dispatch));\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Teachers);","map":{"version":3,"sources":["/home/caleb_lee/gina_web_app/components/teacher/admin/teachers.js"],"names":["React","connect","bindActionCreators","ImagePicker","Permissions","put","delete_by_id","get","updateTeacherProfilePicture","fetchTeachersSuccess","Modal","AddTeacher","EditTeacher","Teachers","props","getPermissionAsync","Platform","OS","askAsync","CAMERA_ROLL","status","alert","_pickImage","teacher_id","url","launchImageLibraryAsync","mediaTypes","MediaTypeOptions","All","allowsEditing","aspect","quality","base64","result","cancelled","getProfilePictureURL","console","log","state","showModal","modal_type","selected_teacher_id","image","school_name","route","params","teachers","body","path","Date","getMilliseconds","response","success","statusCode","message","data","name","image_url","school_id","admins","classes","fetchTeacherData","hideModal","setState","confirmed","confirm","deleteTeacher","getModalContent","padding","alignSelf","backgroundColor","fontSize","Object","keys","map","id","index","teacher","flex","flexDirection","marginBottom","profile_picture","require","uri","width","height","borderRadius","paddingLeft","justifyContent","confirmDeleteTeacher","Component","mapStateToProps","school","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { View, ScrollView, TouchableHighlight, Image, Text, Platform, Alert } from 'react-native'\nimport { connect } from 'react-redux'\nimport { bindActionCreators } from 'redux'\nimport * as ImagePicker from 'expo-image-picker';\nimport * as Permissions from 'expo-permissions';\nimport { put, delete_by_id, get } from '../../util'\nimport { updateTeacherProfilePicture, fetchTeachersSuccess  } from '../../../redux/school/actions/index'\nimport Modal from './modal'\nimport AddTeacher from './addteacher';\nimport EditTeacher from './editteacher';\n\n/*\nPage where we view and edit Teacher profiles:\n  -creating teacher profile\n  -editing teacher profile\n  -removing teacher profile\n*/\n\nclass Teachers extends React.Component{\n  constructor(props) {\n    super(props)\n    this.state={\n      showModal: false,\n      modal_type: '',\n      selected_teacher_id: ''\n    }\n  }\n\n  componentDidMount() {\n    this.getPermissionAsync()\n  }\n\n  getPermissionAsync = async () => {\n    if (Platform.OS === 'ios') {\n      const { status } = await Permissions.askAsync(Permissions.CAMERA_ROLL);\n      if (status !== 'granted') {\n        alert(`Sorry, we need camera roll permissions to make this work!`)\n        return \n      }\n    }\n  };\n\n  _pickImage = async (teacher_id, url) => {\n    try {\n      let result = await ImagePicker.launchImageLibraryAsync({\n        mediaTypes: ImagePicker.MediaTypeOptions.All,\n        allowsEditing: true,\n        aspect: [1,1],\n        quality: 0.4,\n        base64: true\n      });\n      if (!result.cancelled) {\n        const { base64 } = result\n        this.getProfilePictureURL(base64, teacher_id, url)\n      }\n      // console.log(result);\n    } catch (E) {\n      console.log(E);\n    }\n  };\n\n  async getProfilePictureURL(image, teacher_id, url) {\n    const { school_name } = this.props.route.params\n    const { teachers } = this.props\n    const body = {\n      image,\n      url,\n      path: `${school_name}/teacher/profile_picture_${teacher_id}_${(new Date()).getMilliseconds()}.jpg`\n    }\n    const response = await put(`/user/${teacher_id}/profile-picture`, body)\n    // console.log(response)\n    const { success, statusCode, message, data } = response\n    if (!success) {\n      alert(`Sorry ${teachers[teacher_id].name}照片上傳時電腦出狀況了！請截圖和與工程師聯繫\\n\\n` + message)\n      return \n    }\n    this.props.updateTeacherProfilePicture(teacher_id, data.image_url)\n  }\n\n  async fetchTeacherData() {\n    const { school_id } = this.props.route.params\n    const response = await get(`/school/${school_id}/teacher`)\n    const { success, statusCode, message, data } = response\n    if (!success) {\n        alert('Sorry 取得教師資料時電腦出狀況了！請截圖和與工程師聯繫\\n\\n' + message)\n        return \n    }\n\n    const {admins, teachers, classes} = data\n    this.props.fetchTeachersSuccess(admins, teachers, classes)\n}\n\n  getModalContent() {\n    const { school_id } = this.props.route.params\n    const { classes, teachers } = this.props\n    const { modal_type, selected_teacher_id } = this.state\n    if (modal_type === 'add_teacher') {\n      return <AddTeacher\n                classes={classes}\n                school_id={school_id}\n                fetchTeacherData={() => this.fetchTeacherData()}\n                goBack={() => this.hideModal()}\n            />\n    } else if (modal_type === 'edit_teacher') {\n      return <EditTeacher\n                classes={classes}\n                teacher_id={selected_teacher_id}\n                teacher={teachers[selected_teacher_id]}\n                fetchTeacherData={() => this.fetchTeacherData()}\n                goBack={() => this.hideModal()}\n            />\n    }\n  }\n\n  hideModal() {\n    this.setState({\n      showModal: false\n    })\n  }\n\n  confirmDeleteTeacher(teacher_id) {\n    const {teachers} = this.props\n    const confirmed = confirm(`${teachers[teacher_id].name} 刪除確認`)\n    if (confirmed) {\n      this.deleteTeacher(teacher_id)\n    }\n  }\n\n  async deleteTeacher(teacher_id) {\n    const response = await delete_by_id(`/user/${teacher_id}`)\n    const { success, statusCode, message, data } = response\n    if (!success) {\n      alert(`Sorry ${teachers[teacher_id].name}刪除時電腦出狀況了！請截圖和與工程師聯繫\\n\\n` + message)\n      return \n    }\n    this.fetchTeacherData()\n  }\n\n  render() {\n    const { teachers } = this.props\n    const { showModal } = this.state\n    return (\n      <View>\n        <Modal\n          show={showModal}\n          component={this.getModalContent()}\n          hideModal={() => this.hideModal()}\n        />\n        <ScrollView>\n          <View style={{ padding: 20 }}>\n            <TouchableHighlight\n              style={{ padding: 10, alignSelf: 'flex-end', backgroundColor: '#ffddb7' }}\n              onPress={() => this.setState({ showModal: true, modal_type: 'add_teacher' })}\n            >\n              <Text style={{ fontSize: 40 }}>新增教師</Text>\n            </TouchableHighlight>\n          </View>\n          {Object.keys(teachers).map((id, index) => {\n            const teacher = teachers[id]\n            return (\n              <View key={id} style={{ flex:1, backgroundColor: 'lightgrey', flexDirection: 'row', marginBottom: 10, padding: 15 }}>\n                {/* profile picture */}\n                <TouchableHighlight\n                  style={{ }}\n                  onPress={() => this._pickImage(id, teacher.profile_picture)}\n                >\n                  <Image\n                    source={\n                      teacher.profile_picture === '' ?\n                        require('../../../assets/icon-teacher-thumbnail.png')\n                        : {uri: teacher.profile_picture}\n                    }\n                    style={{\n                      width: 200,\n                      height: 200,\n                      borderRadius: 100\n                    }}\n                  />\n                </TouchableHighlight>\n                \n                <View style={{ flex: 5, paddingLeft: 15 }}>\n                  {/* Name */}\n                  <View>\n                    <Text style={{ fontSize: 50 }}>{teacher.name}</Text>\n                  </View>\n                </View>\n\n                {/* Right */}\n                <View style={{ flex: 1, justifyContent: 'space-evenly' }}>\n                  <View style={{ backgroundColor: 'white' }}>\n                    <TouchableHighlight\n                      style={{padding: 15, justifyContent: 'center'}}\n                      onPress={() => this.setState({ showModal: true, modal_type: 'edit_teacher', selected_teacher_id: id })}\n                    >\n                      <Text style={{ fontSize: 25, alignSelf: 'center' }}>編輯</Text>\n                    </TouchableHighlight>\n                  </View>\n\n                  <View style={{ backgroundColor: '#fa625f' }}>\n                    <TouchableHighlight\n                      style={{padding: 15, justifyContent: 'center'}}\n                      onPress={() => this.confirmDeleteTeacher(id)}\n                    >\n                      <Text style={{ fontSize: 25, alignSelf: 'center' }}>刪除</Text>\n                    </TouchableHighlight>\n                  </View>\n\n                </View>\n              </View>\n            )\n          })}\n        </ScrollView>\n      </View>\n    )\n  }\n}\n\nconst mapStateToProps = (state) => {\n  return {\n    teachers: state.school.teachers,\n    classes: state.school.classes\n  }\n}\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    ...bindActionCreators({\n      updateTeacherProfilePicture,\n      fetchTeachersSuccess\n    }, dispatch)\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps) (Teachers)"]},"metadata":{},"sourceType":"module"}