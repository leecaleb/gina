{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _assertThisInitialized from\"@babel/runtime/helpers/assertThisInitialized\";import _inherits from\"@babel/runtime/helpers/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import React from'react';import View from\"react-native-web/dist/exports/View\";import Text from\"react-native-web/dist/exports/Text\";import ActivityIndicator from\"react-native-web/dist/exports/ActivityIndicator\";import*as Font from'expo-font';import Auth from'@aws-amplify/auth';import SchoolApp from\"../teacher/schoolapp\";import Signin from\"./signin\";import Signup from\"./signup\";import ParentApp from\"../parent/parentapp\";import ConfirmSignUp from\"./confirmsignup\";import Reloading from\"../reloading\";import YellowBox from\"react-native-web/dist/exports/YellowBox\";import ENV from\"../../variables\";YellowBox.ignoreWarnings(['Non-serializable values were found in the navigation state']);var AuthLoading=function(_React$Component){_inherits(AuthLoading,_React$Component);var _super=_createSuper(AuthLoading);function AuthLoading(props){var _this;_classCallCheck(this,AuthLoading);_this=_super.call(this,props);_this.state={status:'',id:'',username:''};_this.getCurrentUser=_this.getCurrentUser.bind(_assertThisInitialized(_this));return _this;}_createClass(AuthLoading,[{key:\"componentDidMount\",value:function componentDidMount(){return _regeneratorRuntime.async(function componentDidMount$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return _regeneratorRuntime.awrap(Font.loadAsync({'Roboto':require(\"../../node_modules/native-base/Fonts/Roboto.ttf\"),'Roboto_medium':require(\"../../node_modules/native-base/Fonts/Roboto_medium.ttf\")}));case 2:this.getCurrentUser();case 3:case\"end\":return _context.stop();}}},null,this,null,Promise);}},{key:\"getCurrentUser\",value:function getCurrentUser(){var _this2=this;this.setState({status:'loading'});Auth.currentAuthenticatedUser().then(function(user){console.log(user.username);fetch(\"https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/\"+ENV+\"/user?username=\"+user.username,{method:'GET',headers:{Accept:'application/json','Content-Type':'application/json'}}).then(function(res){return res.json();}).then(function(resJson){var statusCode=resJson.statusCode,message=resJson.message,data=resJson.data;if(statusCode===200){_this2.setState({status:data.role,id:data.id,username:user.username});}else{_this2.setState({status:'signedout'});}}).catch(function(err){console.log('err: ',err);_this2.setState({status:'signedout'});});}).catch(function(err){if(err=='not authenticated'){_this2.setState({status:'signedout'});}_this2.setState({status:'signedout'});});}},{key:\"changeAuthState\",value:function changeAuthState(state,username){this.setState({status:state,username:username});}},{key:\"handleSignOut\",value:function handleSignOut(){var _this3=this;Auth.signOut().then(function(){_this3.getCurrentUser();}).catch(function(err){return console.log(err);});}},{key:\"render\",value:function render(){var _this4=this;console.log('ENV: ',ENV);var _this$state=this.state,status=_this$state.status,username=_this$state.username;console.log('status: ',status);return React.createElement(View,{style:{flex:1}},status.includes('parent')?React.createElement(ParentApp,{parent_id:this.state.id,handleSignOut:function handleSignOut(){return _this4.handleSignOut();}}):status==='school'?React.createElement(SchoolApp,{school_id:this.state.id,school_name:username,handleSignOut:function handleSignOut(){return _this4.handleSignOut();}}):status==='ConfirmSignUpPage'?React.createElement(ConfirmSignUp,{getCurrentUser:this.getCurrentUser,username:this.state.username}):status==='signedout'||status==='school'?React.createElement(Signin,{loadAuth:this.getCurrentUser,changeAuthState:function changeAuthState(state,username){return _this4.changeAuthState(state,username);}}):React.createElement(View,{style:{flex:1,justifyContent:'center',alignItems:'center'}},React.createElement(Text,null,\"Loading...\"),React.createElement(ActivityIndicator,{size:\"large\"})));}}]);return AuthLoading;}(React.Component);export default AuthLoading;","map":{"version":3,"sources":["/home/caleb_lee/gina_web_app/components/auth/authloading.js"],"names":["React","Font","Auth","SchoolApp","Signin","Signup","ParentApp","ConfirmSignUp","Reloading","ENV","YellowBox","ignoreWarnings","AuthLoading","props","state","status","id","username","getCurrentUser","bind","loadAsync","require","setState","currentAuthenticatedUser","then","user","console","log","fetch","method","headers","Accept","res","json","resJson","statusCode","message","data","role","catch","err","signOut","flex","includes","handleSignOut","changeAuthState","justifyContent","alignItems","Component"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { View, Text, ActivityIndicator } from 'react-native'\nimport * as Font from 'expo-font'\nimport Auth from '@aws-amplify/auth'\nimport SchoolApp from '../teacher/schoolapp'\nimport Signin from './signin'\nimport Signup from './signup'\nimport ParentApp from '../parent/parentapp'\nimport ConfirmSignUp from './confirmsignup'\nimport Reloading from '../reloading'\nimport { YellowBox } from 'react-native';\nimport ENV from '../../variables'\n\nYellowBox.ignoreWarnings([\n    'Non-serializable values were found in the navigation state',\n]);\n\nclass AuthLoading extends React.Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            status: '',\n            id: '',\n            username: ''\n        }\n        this.getCurrentUser = this.getCurrentUser.bind(this)\n    }\n\n    async componentDidMount() {\n        await Font.loadAsync({\n            'Roboto': require('../../node_modules/native-base/Fonts/Roboto.ttf'),\n            'Roboto_medium': require('../../node_modules/native-base/Fonts/Roboto_medium.ttf'),\n        })\n        this.getCurrentUser()\n    }\n\n    getCurrentUser() {\n        this.setState({ status: 'loading' })\n        Auth.currentAuthenticatedUser()\n            .then(user => {\n                //user is authenticated\n                console.log(user.username)\n                fetch(`https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/${ENV}/user?username=${user.username}`, {\n                    method: 'GET',\n                    headers: {\n                        Accept: 'application/json',\n                        'Content-Type': 'application/json'\n                    }\n                })\n                    .then((res) => res.json())\n                    .then((resJson) => {\n                        // get id, name, role of admin and parents\n                        const { statusCode, message, data } = resJson\n                        // console.log('resJson: ', resJson)\n                        if (statusCode === 200) {\n                            this.setState({\n                                status: data.role,\n                                id: data.id,\n                                username: user.username\n                            })\n                        } else {\n                            this.setState({\n                                status: 'signedout'\n                            })\n                        }\n                    })\n                    .catch((err) => {\n                        console.log('err: ', err)\n                        this.setState({ status: 'signedout' })\n                    })\n            })\n            .catch(err => {\n                if (err == 'not authenticated') {\n                    this.setState({ status: 'signedout' })\n                }\n                this.setState({ status: 'signedout' })\n            })\n    }\n\n    changeAuthState(state, username) {\n        this.setState({\n            status: state,\n            username\n        })\n    }\n\n    handleSignOut() {\n        Auth.signOut()\n            .then(() => {\n                this.getCurrentUser()\n            })\n            .catch(err => console.log(err))\n    }\n\n    render() {\n        console.log('ENV: ', ENV)\n        const { status, username } = this.state\n        console.log('status: ', status)\n        return (\n            <View style={{ flex: 1 }}>\n                {\n                    status.includes('parent') ?\n                        <ParentApp parent_id={this.state.id} handleSignOut={() => this.handleSignOut()}/>\n                        : status === 'school' ? \n                            <SchoolApp school_id={this.state.id} school_name={username} handleSignOut={() => this.handleSignOut()} />\n                            : status === 'ConfirmSignUpPage' ?\n                                <ConfirmSignUp getCurrentUser={this.getCurrentUser} username={this.state.username}/>\n                                : status === 'signedout' || status === 'school' ?\n                                    <Signin loadAuth={this.getCurrentUser} changeAuthState={(state,username) => this.changeAuthState(state, username)} />\n                                    :\n                                        <View style={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}>\n                                            <Text>Loading...</Text>\n                                            <ActivityIndicator size=\"large\"></ActivityIndicator>\n                                        </View>\n                }\n            </View>\n        )\n    }\n}\n\n// const mapDispatchToProps = (dispatch) => {\n//     return ({\n//         ...bindActionCreators({ initializeClass }, dispatch)\n//     })\n// }\n\n// export default connect(null, mapDispatchToProps) (AuthLoading)\nexport default AuthLoading"]},"metadata":{},"sourceType":"module"}