{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _inherits from\"@babel/runtime/helpers/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import React from'react';import View from\"react-native-web/dist/exports/View\";import Image from\"react-native-web/dist/exports/Image\";import Text from\"react-native-web/dist/exports/Text\";import TouchableHighlight from\"react-native-web/dist/exports/TouchableHighlight\";import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import KeyboardAvoidingView from\"react-native-web/dist/exports/KeyboardAvoidingView\";import Alert from\"react-native-web/dist/exports/Alert\";import{Toast}from'native-base';import{connect}from'react-redux';import{bindActionCreators}from'redux';import WellnessForm from\"./wellnessform\";import{sendWellnessData,formatDate,post}from\"../util\";import{sendWellnessDataFail,sendWellnessDataSuccess}from\"../../redux/school/actions/index\";var StudentModal=function(_React$Component){_inherits(StudentModal,_React$Component);var _super=_createSuper(StudentModal);function StudentModal(props){var _this;_classCallCheck(this,StudentModal);_this=_super.call(this,props);_this.state={class_id:''};return _this;}_createClass(StudentModal,[{key:\"componentDidMount\",value:function componentDidMount(){var _this$props=this.props,class_id=_this$props.class_id,student_id=_this$props.student_id;if(class_id==='all'){this.getClassIdByStudentId(student_id);}else{this.setState({class_id:class_id});}}},{key:\"getClassIdByStudentId\",value:function getClassIdByStudentId(student_id){var classes=this.props.classes;var id=Object.keys(classes);var class_id_found='';for(var i=0;i<id.length;i++){var students=classes[id[i]].students;for(var j=0;j<students.length;j++){if(students[j]===student_id){class_id_found=id[i];}}}this.setState({class_id:class_id_found});}},{key:\"handleSend\",value:function handleSend(record_id){var _this$props2,wellness,isConnected,class_id,records,record,sendDataResult;return _regeneratorRuntime.async(function handleSend$(_context){while(1){switch(_context.prev=_context.next){case 0:_this$props2=this.props,wellness=_this$props2.wellness,isConnected=_this$props2.isConnected;class_id=this.state.class_id;records=wellness.records;record=records[record_id];if(!(record.temperature==='')){_context.next=7;break;}Alert.alert('未填寫!','',[{text:'OK'}]);return _context.abrupt(\"return\");case 7:if(!isConnected){Toast.show({text:'拍謝 網路連不到! 等一下再試試看',buttonText:'Okay',position:\"top\",type:\"warning\",duration:2000});}_context.next=10;return _regeneratorRuntime.awrap(sendWellnessData(wellness,class_id,formatDate(new Date())));case 10:sendDataResult=_context.sent;if(sendDataResult.success){this.props.fetchStudentAttendance();this.props.sendWellnessDataSuccess();this.props.hideModal();}else{this.props.sendWellnessDataFail(sendDataResult.message);}case 12:case\"end\":return _context.stop();}}},null,this,null,Promise);}},{key:\"markAbsent\",value:function markAbsent(){var _this$props3,student_id,school_id,class_id,body,response,success,statusCode,message,data;return _regeneratorRuntime.async(function markAbsent$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_this$props3=this.props,student_id=_this$props3.student_id,school_id=_this$props3.school_id;class_id=this.state.class_id;body={student_id:student_id,class_id:class_id,school_id:school_id,startDate:formatDate(new Date()),endDate:formatDate(new Date()),excuse_type:'none-medical',note:'校方填寫'};_context2.next=5;return _regeneratorRuntime.awrap(post('/absence-excuse',body));case 5:response=_context2.sent;success=response.success,statusCode=response.statusCode,message=response.message,data=response.data;if(success){_context2.next=10;break;}Alert.alert('Sorry 標記學生缺席時電腦出狀況了！','請截圖和與工程師聯繫\\n\\n'+message,[{text:'Ok'}]);return _context2.abrupt(\"return\");case 10:this.props.fetchStudentAttendance();this.props.hideModal();case 12:case\"end\":return _context2.stop();}}},null,this,null,Promise);}},{key:\"render\",value:function render(){var _this2=this;var _this$props4=this.props,show=_this$props4.show,student_id=_this$props4.student_id,teacher_id=_this$props4.teacher_id,students=_this$props4.students,student_unmarked=_this$props4.student_unmarked,student_absent=_this$props4.student_absent,teacherOnDuty=_this$props4.teacherOnDuty;var student=students[student_id];var wellness=this.props.wellness;var record_id=wellness.by_student_id[student_id][0];return React.createElement(View,{style:{flex:1,width:'80%',height:'70%',backgroundColor:student_absent.has(student_id)?'#ffe1d0':student_unmarked.has(student_id)?'#fff1b5':'#dcf3d0',zIndex:3,position:'absolute'}},React.createElement(View,{style:{flex:2,flexDirection:'row',justifyContent:'space-evenly',alignItems:'center'}},React.createElement(View,{style:{flex:1,alignItems:'center'}},React.createElement(Image,{source:student.profile_picture===''?require(\"../../assets/icon-thumbnail.png\"):{uri:student.profile_picture},style:styles.thumbnailImage})),React.createElement(View,{style:{flex:1,alignItems:'flex-start'}},React.createElement(Text,{style:{fontSize:60}},student.name),React.createElement(TouchableHighlight,{style:{padding:10,backgroundColor:'lightgrey',justifyContent:'center'},onPress:function onPress(){return _this2.markAbsent();}},React.createElement(Text,{style:{fontSize:40}},\"\\u7F3A\\u5E2D\")))),React.createElement(View,{style:{flex:2}},React.createElement(View,{style:{flex:3,alignItems:'center'}},React.createElement(Text,{style:{fontSize:20}},\"\\u8840\\u578B: \",student.blood_type,\" \"),React.createElement(Text,{style:{fontSize:20}},\"\\u5730\\u5740: \",student.address),React.createElement(Text,{style:{fontSize:20}},\"\\u5BB6\\u88E1\\u96FB\\u8A71: \",student.home_phone),React.createElement(Text,{style:{fontSize:20}},\"\\uFF08\\u7236\\uFF09\\u624B\\u6A5F: \",student.father_phone),React.createElement(Text,{style:{fontSize:20}},\"\\uFF08\\u6BCD\\uFF09\\u624B\\u6A5F: \",student.mother_phone)),React.createElement(View,{style:{flex:1,flexDirection:'row',paddingHorizontal:30}},student_unmarked.has(student_id)?React.createElement(WellnessForm,{student_id:student_id,teacher_id:teacherOnDuty,record_id:record_id,autoFocus:true}):null)),React.createElement(View,{style:{flex:1,flexDirection:'row',alignItems:'center'}},student_unmarked.has(student_id)?React.createElement(View,{style:{flex:1,flexDirection:'row',alignItems:'center'}},React.createElement(TouchableHighlight,{style:{backgroundColor:'red',flex:1,height:60,justifyContent:'center',alignItems:'center',margin:8},onPress:this.props.hideModal},React.createElement(Text,{style:{fontSize:30}},\"\\u53D6\\u6D88\")),React.createElement(TouchableHighlight,{style:{backgroundColor:'grey',flex:1,height:60,justifyContent:'center',alignItems:'center',margin:8},onPress:function onPress(){return _this2.handleSend(record_id);}},React.createElement(Text,{style:{fontSize:30}},\"\\u9001\\u51FA\"))):null));}}]);return StudentModal;}(React.Component);var styles=StyleSheet.create({thumbnailImage:{width:200,height:200,borderRadius:100}});var mapStateToProps=function mapStateToProps(state){return{classes:state.school.classes,student_absent:state.school.student_absent,student_unmarked:state.school.student_unmarked,students:state.school.students,wellness:state.healthstatus,isConnected:state.school.isConnected};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return _objectSpread({},bindActionCreators({sendWellnessDataFail:sendWellnessDataFail,sendWellnessDataSuccess:sendWellnessDataSuccess},dispatch));};export default connect(mapStateToProps,mapDispatchToProps)(StudentModal);","map":{"version":3,"sources":["/home/caleb_lee/gina_web_app/components/teacher/studentmodal.js"],"names":["React","Toast","connect","bindActionCreators","WellnessForm","sendWellnessData","formatDate","post","sendWellnessDataFail","sendWellnessDataSuccess","StudentModal","props","state","class_id","student_id","getClassIdByStudentId","setState","classes","id","Object","keys","class_id_found","i","length","students","j","record_id","wellness","isConnected","records","record","temperature","Alert","alert","text","show","buttonText","position","type","duration","Date","sendDataResult","success","fetchStudentAttendance","hideModal","message","school_id","body","startDate","endDate","excuse_type","note","response","statusCode","data","teacher_id","student_unmarked","student_absent","teacherOnDuty","student","by_student_id","flex","width","height","backgroundColor","has","zIndex","flexDirection","justifyContent","alignItems","profile_picture","require","uri","styles","thumbnailImage","fontSize","name","padding","markAbsent","blood_type","address","home_phone","father_phone","mother_phone","paddingHorizontal","margin","handleSend","Component","StyleSheet","create","borderRadius","mapStateToProps","school","healthstatus","mapDispatchToProps","dispatch"],"mappings":"s4DAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,C,+bAEA,OAASC,KAAT,KAAsB,aAAtB,CACA,OAASC,OAAT,KAAwB,aAAxB,CACA,OAASC,kBAAT,KAAmC,OAAnC,CACA,MAAOC,CAAAA,YAAP,sBACA,OAASC,gBAAT,CAA2BC,UAA3B,CAAuCC,IAAvC,eACA,OAASC,oBAAT,CAA+BC,uBAA/B,wC,GAEMC,CAAAA,Y,2GACJ,sBAAYC,KAAZ,CAAmB,8CACjB,uBAAMA,KAAN,EACA,MAAKC,KAAL,CAAW,CACPC,QAAQ,CAAE,EADH,CAAX,CAFiB,aAKlB,C,sFAEmB,iBACe,KAAKF,KADpB,CACVE,QADU,aACVA,QADU,CACAC,UADA,aACAA,UADA,CAElB,GAAID,QAAQ,GAAK,KAAjB,CAAwB,CACtB,KAAKE,qBAAL,CAA2BD,UAA3B,EACD,CAFD,IAEO,CACL,KAAKE,QAAL,CAAc,CAAEH,QAAQ,CAARA,QAAF,CAAd,EACD,CACF,C,oEAEqBC,U,CAAY,IACtBG,CAAAA,OADsB,CACV,KAAKN,KADK,CACtBM,OADsB,CAE9B,GAAMC,CAAAA,EAAE,CAAGC,MAAM,CAACC,IAAP,CAAYH,OAAZ,CAAX,CACA,GAAII,CAAAA,cAAc,CAAG,EAArB,CACA,IAAI,GAAIC,CAAAA,CAAC,CAAG,CAAZ,CAAeA,CAAC,CAAGJ,EAAE,CAACK,MAAtB,CAA8BD,CAAC,EAA/B,CAAmC,IACxBE,CAAAA,QADwB,CACZP,OAAO,CAACC,EAAE,CAACI,CAAD,CAAH,CADK,CACxBE,QADwB,CAE/B,IAAI,GAAIC,CAAAA,CAAC,CAAG,CAAZ,CAAeA,CAAC,CAAGD,QAAQ,CAACD,MAA5B,CAAoCE,CAAC,EAArC,CAAyC,CACrC,GAAID,QAAQ,CAACC,CAAD,CAAR,GAAgBX,UAApB,CAAgC,CAC5BO,cAAc,CAAGH,EAAE,CAACI,CAAD,CAAnB,CACH,CACJ,CACJ,CAED,KAAKN,QAAL,CAAc,CACVH,QAAQ,CAAEQ,cADA,CAAd,EAGH,C,8CAEgBK,S,gNACmB,KAAKf,K,CAA/BgB,Q,cAAAA,Q,CAAUC,W,cAAAA,W,CACVf,Q,CAAa,KAAKD,K,CAAlBC,Q,CACAgB,O,CAAYF,Q,CAAZE,O,CACFC,M,CAASD,OAAO,CAACH,SAAD,C,MAClBI,MAAM,CAACC,WAAP,GAAuB,E,0BACzBC,KAAK,CAACC,KAAN,CACE,MADF,CAEE,EAFF,CAGE,CAAC,CAACC,IAAI,CAAE,IAAP,CAAD,CAHF,E,wCAQF,GAAI,CAACN,WAAL,CAAkB,CACd3B,KAAK,CAACkC,IAAN,CAAW,CACPD,IAAI,CAAE,mBADC,CAEPE,UAAU,CAAE,MAFL,CAGPC,QAAQ,CAAE,KAHH,CAIPC,IAAI,CAAE,SAJC,CAKPC,QAAQ,CAAE,IALH,CAAX,EAOH,C,kDAE4BlC,gBAAgB,CAACsB,QAAD,CAAWd,QAAX,CAAqBP,UAAU,CAAC,GAAIkC,CAAAA,IAAJ,EAAD,CAA/B,C,UAAvCC,c,eACN,GAAIA,cAAc,CAACC,OAAnB,CAA4B,CACxB,KAAK/B,KAAL,CAAWgC,sBAAX,GACA,KAAKhC,KAAL,CAAWF,uBAAX,GACA,KAAKE,KAAL,CAAWiC,SAAX,GACH,CAJD,IAIO,CACL,KAAKjC,KAAL,CAAWH,oBAAX,CAAgCiC,cAAc,CAACI,OAA/C,EACD,C,uVAIiC,KAAKlC,K,CAA/BG,U,cAAAA,U,CAAYgC,S,cAAAA,S,CACZjC,Q,CAAa,KAAKD,K,CAAlBC,Q,CACFkC,I,CAAO,CACXjC,UAAU,CAAVA,UADW,CAEXD,QAAQ,CAARA,QAFW,CAGXiC,SAAS,CAATA,SAHW,CAIXE,SAAS,CAAE1C,UAAU,CAAC,GAAIkC,CAAAA,IAAJ,EAAD,CAJV,CAKXS,OAAO,CAAE3C,UAAU,CAAC,GAAIkC,CAAAA,IAAJ,EAAD,CALR,CAMXU,WAAW,CAAE,cANF,CAOXC,IAAI,CAAE,MAPK,C,mDASU5C,IAAI,CAAC,iBAAD,CAAoBwC,IAApB,C,SAArBK,Q,gBACEV,O,CAAuCU,Q,CAAvCV,O,CAASW,U,CAA8BD,Q,CAA9BC,U,CAAYR,O,CAAkBO,Q,CAAlBP,O,CAASS,I,CAASF,Q,CAATE,I,IACjCZ,O,2BACDV,KAAK,CAACC,KAAN,CACI,sBADJ,CAEI,iBAAmBY,OAFvB,CAGI,CAAC,CAAEX,IAAI,CAAE,IAAR,CAAD,CAHJ,E,0CAOJ,KAAKvB,KAAL,CAAWgC,sBAAX,GACA,KAAKhC,KAAL,CAAWiC,SAAX,G,8GAGO,kCAC6F,KAAKjC,KADlG,CACCwB,IADD,cACCA,IADD,CACOrB,UADP,cACOA,UADP,CACmByC,UADnB,cACmBA,UADnB,CAC+B/B,QAD/B,cAC+BA,QAD/B,CACyCgC,gBADzC,cACyCA,gBADzC,CAC2DC,cAD3D,cAC2DA,cAD3D,CAC2EC,aAD3E,cAC2EA,aAD3E,CAEP,GAAMC,CAAAA,OAAO,CAAGnC,QAAQ,CAACV,UAAD,CAAxB,CAFO,GAGCa,CAAAA,QAHD,CAGc,KAAKhB,KAHnB,CAGCgB,QAHD,CAIP,GAAMD,CAAAA,SAAS,CAAGC,QAAQ,CAACiC,aAAT,CAAuB9C,UAAvB,EAAmC,CAAnC,CAAlB,CACA,MACI,qBAAC,IAAD,EACE,KAAK,CAAE,CACL+C,IAAI,CAAE,CADD,CAELC,KAAK,CAAE,KAFF,CAGLC,MAAM,CAAE,KAHH,CAILC,eAAe,CACXP,cAAc,CAACQ,GAAf,CAAmBnD,UAAnB,EAAiC,SAAjC,CACE0C,gBAAgB,CAACS,GAAjB,CAAqBnD,UAArB,EAAmC,SAAnC,CACA,SAPD,CAQLoD,MAAM,CAAE,CARH,CASL7B,QAAQ,CAAE,UATL,CADT,EAaE,oBAAC,IAAD,EAAM,KAAK,CAAE,CAAEwB,IAAI,CAAE,CAAR,CAAWM,aAAa,CAAE,KAA1B,CAAiCC,cAAc,CAAE,cAAjD,CAAiEC,UAAU,CAAE,QAA7E,CAAb,EACE,oBAAC,IAAD,EAAM,KAAK,CAAE,CAAER,IAAI,CAAE,CAAR,CAAWQ,UAAU,CAAE,QAAvB,CAAb,EACE,oBAAC,KAAD,EACE,MAAM,CACJV,OAAO,CAACW,eAAR,GAA4B,EAA5B,CACIC,OAAO,mCADX,CAEM,CAACC,GAAG,CAAEb,OAAO,CAACW,eAAd,CAJV,CAME,KAAK,CAAEG,MAAM,CAACC,cANhB,EADF,CADF,CAWE,oBAAC,IAAD,EAAM,KAAK,CAAE,CAAEb,IAAI,CAAE,CAAR,CAAWQ,UAAU,CAAE,YAAvB,CAAb,EACE,oBAAC,IAAD,EAAM,KAAK,CAAE,CAAEM,QAAQ,CAAE,EAAZ,CAAb,EAAgChB,OAAO,CAACiB,IAAxC,CADF,CAEE,oBAAC,kBAAD,EACE,KAAK,CAAE,CAAEC,OAAO,CAAE,EAAX,CAAeb,eAAe,CAAE,WAAhC,CAA6CI,cAAc,CAAE,QAA7D,CADT,CAEE,OAAO,CAAE,yBAAM,CAAA,MAAI,CAACU,UAAL,EAAN,EAFX,EAIE,oBAAC,IAAD,EAAM,KAAK,CAAE,CAAEH,QAAQ,CAAE,EAAZ,CAAb,iBAJF,CAFF,CAXF,CAbF,CAmCE,oBAAC,IAAD,EAAM,KAAK,CAAE,CAAEd,IAAI,CAAE,CAAR,CAAb,EACE,oBAAC,IAAD,EAAM,KAAK,CAAE,CAAEA,IAAI,CAAE,CAAR,CAAWQ,UAAU,CAAE,QAAvB,CAAb,EACE,oBAAC,IAAD,EAAM,KAAK,CAAE,CAAEM,QAAQ,CAAE,EAAZ,CAAb,mBAAoChB,OAAO,CAACoB,UAA5C,KADF,CAEE,oBAAC,IAAD,EAAM,KAAK,CAAE,CAAEJ,QAAQ,CAAE,EAAZ,CAAb,mBAAoChB,OAAO,CAACqB,OAA5C,CAFF,CAGE,oBAAC,IAAD,EAAM,KAAK,CAAE,CAAEL,QAAQ,CAAE,EAAZ,CAAb,+BAAsChB,OAAO,CAACsB,UAA9C,CAHF,CAIE,oBAAC,IAAD,EAAM,KAAK,CAAE,CAAEN,QAAQ,CAAE,EAAZ,CAAb,qCAAuChB,OAAO,CAACuB,YAA/C,CAJF,CAKE,oBAAC,IAAD,EAAM,KAAK,CAAE,CAAEP,QAAQ,CAAE,EAAZ,CAAb,qCAAuChB,OAAO,CAACwB,YAA/C,CALF,CADF,CAQE,oBAAC,IAAD,EAAM,KAAK,CAAE,CAAEtB,IAAI,CAAE,CAAR,CAAWM,aAAa,CAAE,KAA1B,CAAiCiB,iBAAiB,CAAE,EAApD,CAAb,EACG5B,gBAAgB,CAACS,GAAjB,CAAqBnD,UAArB,EACC,oBAAC,YAAD,EACE,UAAU,CAAEA,UADd,CAEE,UAAU,CAAE4C,aAFd,CAGE,SAAS,CAAEhC,SAHb,CAIE,SAAS,CAAE,IAJb,EADD,CAOC,IARJ,CARF,CAnCF,CAuDE,oBAAC,IAAD,EAAM,KAAK,CAAE,CAAEmC,IAAI,CAAE,CAAR,CAAWM,aAAa,CAAE,KAA1B,CAAiCE,UAAU,CAAE,QAA7C,CAAb,EACGb,gBAAgB,CAACS,GAAjB,CAAqBnD,UAArB,EACC,oBAAC,IAAD,EAAM,KAAK,CAAE,CAAE+C,IAAI,CAAE,CAAR,CAAWM,aAAa,CAAE,KAA1B,CAAiCE,UAAU,CAAE,QAA7C,CAAb,EACE,oBAAC,kBAAD,EACE,KAAK,CAAE,CAAEL,eAAe,CAAE,KAAnB,CAA0BH,IAAI,CAAE,CAAhC,CAAmCE,MAAM,CAAE,EAA3C,CAA+CK,cAAc,CAAE,QAA/D,CAAyEC,UAAU,CAAE,QAArF,CAA+FgB,MAAM,CAAE,CAAvG,CADT,CAEE,OAAO,CAAE,KAAK1E,KAAL,CAAWiC,SAFtB,EAIE,oBAAC,IAAD,EAAM,KAAK,CAAE,CAAE+B,QAAQ,CAAE,EAAZ,CAAb,iBAJF,CADF,CAOE,oBAAC,kBAAD,EACE,KAAK,CAAE,CAAEX,eAAe,CAAE,MAAnB,CAA2BH,IAAI,CAAE,CAAjC,CAAoCE,MAAM,CAAE,EAA5C,CAAgDK,cAAc,CAAE,QAAhE,CAA0EC,UAAU,CAAE,QAAtF,CAAgGgB,MAAM,CAAE,CAAxG,CADT,CAEE,OAAO,CAAE,yBAAM,CAAA,MAAI,CAACC,UAAL,CAAgB5D,SAAhB,CAAN,EAFX,EAIE,oBAAC,IAAD,EAAM,KAAK,CAAE,CAAEiD,QAAQ,CAAE,EAAZ,CAAb,iBAJF,CAPF,CADD,CAeG,IAhBN,CAvDF,CADJ,CA6ED,C,0BAjLwB3E,KAAK,CAACuF,S,EAoLjC,GAAMd,CAAAA,MAAM,CAAGe,UAAU,CAACC,MAAX,CAAkB,CAC/Bf,cAAc,CAAE,CACZZ,KAAK,CAAE,GADK,CAEZC,MAAM,CAAE,GAFI,CAGZ2B,YAAY,CAAE,GAHF,CADe,CAAlB,CAAf,CAQA,GAAMC,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAAC/E,KAAD,CAAW,CACjC,MAAO,CAGLK,OAAO,CAAEL,KAAK,CAACgF,MAAN,CAAa3E,OAHjB,CAILwC,cAAc,CAAE7C,KAAK,CAACgF,MAAN,CAAanC,cAJxB,CAKLD,gBAAgB,CAAE5C,KAAK,CAACgF,MAAN,CAAapC,gBAL1B,CAMLhC,QAAQ,CAAEZ,KAAK,CAACgF,MAAN,CAAapE,QANlB,CAOLG,QAAQ,CAAEf,KAAK,CAACiF,YAPX,CAQLjE,WAAW,CAAEhB,KAAK,CAACgF,MAAN,CAAahE,WARrB,CAAP,CAUD,CAXD,CAaA,GAAMkE,CAAAA,kBAAkB,CAAG,QAArBA,CAAAA,kBAAqB,CAACC,QAAD,CAAc,CACvC,wBACK5F,kBAAkB,CAAC,CAAEK,oBAAoB,CAApBA,oBAAF,CAAwBC,uBAAuB,CAAvBA,uBAAxB,CAAD,CAAmDsF,QAAnD,CADvB,EAGD,CAJD,CAMA,cAAe7F,CAAAA,OAAO,CAACyF,eAAD,CAAkBG,kBAAlB,CAAP,CAA8CpF,YAA9C,CAAf","sourcesContent":["import React from 'react'\nimport { View, Image, Text, TouchableHighlight, StyleSheet, KeyboardAvoidingView, Alert } from 'react-native'\nimport { Toast } from 'native-base'\nimport { connect } from 'react-redux'\nimport { bindActionCreators } from 'redux'\nimport WellnessForm from './wellnessform'\nimport { sendWellnessData, formatDate, post } from '../util'\nimport { sendWellnessDataFail, sendWellnessDataSuccess } from '../../redux/school/actions/index'\n\nclass StudentModal extends React.Component{\n  constructor(props) {\n    super(props)\n    this.state={\n        class_id: ''\n    }\n  }\n\n  componentDidMount() {\n    const { class_id, student_id } = this.props\n    if (class_id === 'all') {\n      this.getClassIdByStudentId(student_id)\n    } else {\n      this.setState({ class_id })\n    }\n  }\n\n  getClassIdByStudentId(student_id) {\n      const { classes } = this.props\n      const id = Object.keys(classes)\n      var class_id_found = ''\n      for(var i = 0; i < id.length; i++) {\n          const {students} = classes[id[i]]\n          for(var j = 0; j < students.length; j++) {\n              if (students[j] === student_id) {\n                  class_id_found = id[i]\n              }\n          }\n      }\n\n      this.setState({\n          class_id: class_id_found\n      })\n  }\n\n  async handleSend(record_id) {\n    const { wellness, isConnected } = this.props\n    const { class_id } = this.state\n    const { records } = wellness\n    const record = records[record_id]\n    if (record.temperature === '') {\n      Alert.alert(\n        '未填寫!',\n        '',\n        [{text: 'OK'}]\n      )\n      return\n    }\n\n    if (!isConnected) {\n        Toast.show({\n            text: '拍謝 網路連不到! 等一下再試試看',\n            buttonText: 'Okay',\n            position: \"top\",\n            type: \"warning\",\n            duration: 2000\n        })\n    }\n\n    const sendDataResult = await sendWellnessData(wellness, class_id, formatDate(new Date()))\n    if (sendDataResult.success) {\n        this.props.fetchStudentAttendance()\n        this.props.sendWellnessDataSuccess()\n        this.props.hideModal()\n    } else {\n      this.props.sendWellnessDataFail(sendDataResult.message)\n    }\n  }\n\n  async markAbsent() {\n    const { student_id, school_id } = this.props\n    const { class_id } = this.state\n    const body = {\n      student_id,\n      class_id,\n      school_id,\n      startDate: formatDate(new Date()),\n      endDate: formatDate(new Date()),\n      excuse_type: 'none-medical',\n      note: '校方填寫'\n    }\n    const response = await post('/absence-excuse', body)\n    const { success, statusCode, message, data } = response\n    if (!success) {\n        Alert.alert(\n            'Sorry 標記學生缺席時電腦出狀況了！',\n            '請截圖和與工程師聯繫\\n\\n' + message,\n            [{ text: 'Ok' }]\n        )\n        return \n    }\n    this.props.fetchStudentAttendance()\n    this.props.hideModal()\n  }\n\n  render() {\n    const { show, student_id, teacher_id, students, student_unmarked, student_absent, teacherOnDuty } = this.props\n    const student = students[student_id]\n    const { wellness } = this.props\n    const record_id = wellness.by_student_id[student_id][0]\n    return (\n        <View\n          style={{\n            flex: 1,\n            width: '80%',\n            height: '70%',\n            backgroundColor:\n                student_absent.has(student_id) ? '#ffe1d0'\n                : student_unmarked.has(student_id) ? '#fff1b5'\n                : '#dcf3d0',\n            zIndex: 3,\n            position: 'absolute'\n          }}\n        >\n          <View style={{ flex: 2, flexDirection: 'row', justifyContent: 'space-evenly', alignItems: 'center' }}>\n            <View style={{ flex: 1, alignItems: 'center' }}>\n              <Image\n                source={\n                  student.profile_picture === '' ?\n                      require('../../assets/icon-thumbnail.png')\n                      : {uri: student.profile_picture }\n              }\n                style={styles.thumbnailImage}\n              />\n            </View>\n            <View style={{ flex: 1, alignItems: 'flex-start' }}>\n              <Text style={{ fontSize: 60 }}>{student.name}</Text>\n              <TouchableHighlight\n                style={{ padding: 10, backgroundColor: 'lightgrey', justifyContent: 'center' }}\n                onPress={() => this.markAbsent()}\n              >\n                <Text style={{ fontSize: 40 }}>缺席</Text>\n              </TouchableHighlight>\n            </View>\n          </View>\n          \n          <View style={{ flex: 2 }}>\n            <View style={{ flex: 3, alignItems: 'center' }}>\n              <Text style={{ fontSize: 20 }}>血型: {student.blood_type} </Text>\n              <Text style={{ fontSize: 20 }}>地址: {student.address}</Text>\n              <Text style={{ fontSize: 20 }}>家裡電話: {student.home_phone}</Text>\n              <Text style={{ fontSize: 20 }}>（父）手機: {student.father_phone}</Text>\n              <Text style={{ fontSize: 20 }}>（母）手機: {student.mother_phone}</Text>\n            </View>\n            <View style={{ flex: 1, flexDirection: 'row', paddingHorizontal: 30 }}>\n              {student_unmarked.has(student_id) ? \n                <WellnessForm\n                  student_id={student_id}\n                  teacher_id={teacherOnDuty}\n                  record_id={record_id}\n                  autoFocus={true}\n                />\n              : null}\n            </View>\n          </View>\n\n          <View style={{ flex: 1, flexDirection: 'row', alignItems: 'center' }}>\n            {student_unmarked.has(student_id) ?\n              <View style={{ flex: 1, flexDirection: 'row', alignItems: 'center' }}>\n                <TouchableHighlight\n                  style={{ backgroundColor: 'red', flex: 1, height: 60, justifyContent: 'center', alignItems: 'center', margin: 8 }}\n                  onPress={this.props.hideModal}\n                >\n                  <Text style={{ fontSize: 30 }}>取消</Text>\n                </TouchableHighlight>\n                <TouchableHighlight\n                  style={{ backgroundColor: 'grey', flex: 1, height: 60, justifyContent: 'center', alignItems: 'center', margin: 8 }}\n                  onPress={() => this.handleSend(record_id)}\n                >\n                  <Text style={{ fontSize: 30 }}>送出</Text>\n                </TouchableHighlight>\n              </View>\n              : null\n            }\n          </View>\n        </View>\n    )\n  }\n}\n\nconst styles = StyleSheet.create({\n  thumbnailImage: {\n      width: 200,\n      height: 200,\n      borderRadius: 100\n  }\n})\n\nconst mapStateToProps = (state) => {\n  return {\n    // students: state.classInfo.students,\n    // school: state.school,\n    classes: state.school.classes,\n    student_absent: state.school.student_absent,\n    student_unmarked: state.school.student_unmarked,\n    students: state.school.students,\n    wellness: state.healthstatus,\n    isConnected: state.school.isConnected\n  }\n}\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    ...bindActionCreators({ sendWellnessDataFail, sendWellnessDataSuccess}, dispatch)\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps) (StudentModal)"]},"metadata":{},"sourceType":"module"}