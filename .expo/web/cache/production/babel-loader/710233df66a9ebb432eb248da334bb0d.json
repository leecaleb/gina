{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _assertThisInitialized from\"@babel/runtime/helpers/assertThisInitialized\";import _inherits from\"@babel/runtime/helpers/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import React from'react';import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import Image from\"react-native-web/dist/exports/Image\";import TouchableHighlight from\"react-native-web/dist/exports/TouchableHighlight\";import View from\"react-native-web/dist/exports/View\";import Text from\"react-native-web/dist/exports/Text\";import TextInput from\"react-native-web/dist/exports/TextInput\";import Alert from\"react-native-web/dist/exports/Alert\";import{Container,Content,Card,Toast}from'native-base';import{connect}from'react-redux';import{bindActionCreators}from'redux';import{editMilkAmount,addMilkRecord,fetchClassMilkData,createDataSuccess,createDataFail,editDataSuccess,editDataFail,removeRecord,removeMilkRecordSuccess,removeMilkRecordFail,editMilkTime}from\"../../../redux/school/actions/index\";import{formatTime,formatDate,fetchClassData as _fetchClassData}from\"../../util\";import Reloading from\"../../reloading\";import TimeModal from\"../../parent/timemodal\";var TeacherMilkLog=function(_React$Component){_inherits(TeacherMilkLog,_React$Component);var _super=_createSuper(TeacherMilkLog);function TeacherMilkLog(props){var _this;_classCallCheck(this,TeacherMilkLog);_this=_super.call(this,props);_this.state={isLoading:true,date:new Date(),showDateTimeModal:false,record_id:''};_this.handleSend=_this.handleSend.bind(_assertThisInitialized(_this));_this.handleOnAddRecord=_this.handleOnAddRecord.bind(_assertThisInitialized(_this));return _this;}_createClass(TeacherMilkLog,[{key:\"componentDidMount\",value:function componentDidMount(){var isConnected=this.props.class.isConnected;if(!this.props.milk.loaded&&isConnected){this.fetchClassData();}else{this.setState({isLoading:false});}if(!isConnected){Toast.show({text:'拍謝 網路連不到! 等一下再試試看',buttonText:'Okay',position:\"top\",type:\"warning\",duration:2000});}}},{key:\"checkUnsent\",value:function checkUnsent(student_id){var _this$props$milk=this.props.milk,newDataForCreate=_this$props$milk.newDataForCreate,oldDataForEdit=_this$props$milk.oldDataForEdit,dataForRemoval=_this$props$milk.dataForRemoval,by_student_id=_this$props$milk.by_student_id;var record_id_list=by_student_id[student_id];var found=false;for(var i=0;i<record_id_list.length;i++){var record_id=record_id_list[i];if(newDataForCreate.has(record_id)||oldDataForEdit.has(record_id)){found=true;break;}}return found;}},{key:\"fetchClassData\",value:function fetchClassData(){var isConnected,date,start_date,end_date,milkData;return _regeneratorRuntime.async(function fetchClassData$(_context){while(1){switch(_context.prev=_context.next){case 0:isConnected=this.props.class.isConnected;if(isConnected){_context.next=4;break;}Toast.show({text:'拍謝 網路連不到! 等一下再試試看',buttonText:'Okay',position:\"top\",type:\"warning\",duration:2000});return _context.abrupt(\"return\");case 4:date=new Date();start_date=formatDate(date);date.setDate(date.getDate()+1);end_date=formatDate(date);_context.next=10;return _regeneratorRuntime.awrap(_fetchClassData('milkintake',this.props.class.class_id,start_date,end_date));case 10:milkData=_context.sent;this.denormalize(milkData);this.props.fetchClassMilkData(milkData.data);this.setState({isLoading:false});case 14:case\"end\":return _context.stop();}}},null,this,null,Promise);}},{key:\"denormalize\",value:function denormalize(milkData){if(!milkData.data.records.all_id.length){return;}var by_id=milkData.data.records.by_id;for(var record_id in by_id){by_id[record_id].time=new Date(by_id[record_id].time);}}},{key:\"handleEditMilkAmout\",value:function handleEditMilkAmout(record_id,milk_amount){var teacher_id=this.props.route.params.teacher_id;this.props.editMilkAmount(record_id,milk_amount,teacher_id);}},{key:\"handleOnAddRecord\",value:function handleOnAddRecord(student_id){this.props.addMilkRecord(student_id);}},{key:\"confirmToRemoveRecord\",value:function confirmToRemoveRecord(student_id,record_id,index){var _this2=this;Alert.alert('確定要刪除？','',[{text:'Yes',onPress:function onPress(){return _this2.handleRemoveRecord(student_id,record_id,index);}},{text:'Cancel',style:'cancel'}]);}},{key:\"handleRemoveRecord\",value:function handleRemoveRecord(student_id,record_id,index){var isConnected=this.props.class.isConnected;if(!isConnected){Toast.show({text:'拍謝 網路連不到! 等一下再試試看',buttonText:'Okay',position:\"top\",type:\"warning\",duration:2000});return;}this.props.removeRecord(student_id,record_id,index);this.handleRemove(record_id,student_id);}},{key:\"handleSend\",value:function handleSend(){var _this$props$milk2,newDataForCreate,oldDataForEdit,dataForRemoval,isConnected,handleCreateRes,handleEditRes;return _regeneratorRuntime.async(function handleSend$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_this$props$milk2=this.props.milk,newDataForCreate=_this$props$milk2.newDataForCreate,oldDataForEdit=_this$props$milk2.oldDataForEdit,dataForRemoval=_this$props$milk2.dataForRemoval;isConnected=this.props.class.isConnected;if(isConnected){_context2.next=5;break;}Toast.show({text:'拍謝 網路連不到! 等一下再試試看',buttonText:'Okay',position:\"top\",type:\"warning\",duration:2000});return _context2.abrupt(\"return\");case 5:if(!newDataForCreate.size){_context2.next=15;break;}_context2.next=8;return _regeneratorRuntime.awrap(this.handleCreate());case 8:handleCreateRes=_context2.sent;if(!handleCreateRes.success){_context2.next=13;break;}this.props.createDataSuccess();_context2.next=15;break;case 13:this.props.createDataFail(handleCreateRes.data);return _context2.abrupt(\"return\");case 15:if(!oldDataForEdit.size){_context2.next=25;break;}_context2.next=18;return _regeneratorRuntime.awrap(this.handleEdit());case 18:handleEditRes=_context2.sent;if(!handleEditRes.success){_context2.next=23;break;}this.props.editDataSuccess();_context2.next=25;break;case 23:this.props.editDataFail(handleEditRes.data);return _context2.abrupt(\"return\");case 25:this.props.navigation.goBack();case 26:case\"end\":return _context2.stop();}}},null,this,null,Promise);}},{key:\"handleCreate\",value:function handleCreate(){var _this$props$milk3,newDataForCreate,records,data_objs,request_body,createDataRes;return _regeneratorRuntime.async(function handleCreate$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_this$props$milk3=this.props.milk,newDataForCreate=_this$props$milk3.newDataForCreate,records=_this$props$milk3.records;data_objs=[];newDataForCreate.forEach(function(record_id){data_objs.push(_objectSpread({},records.by_id[record_id]));});this.normalize(data_objs);request_body={date:formatDate(new Date()),data_objs:data_objs};_context3.next=7;return _regeneratorRuntime.awrap(fetch('https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/dev/milkintake',{method:'POST',headers:{Accept:'application/json','Content-Type':'application/json'},body:JSON.stringify(request_body)}).then(function(res){return res.json();}).then(function(resJson){var statusCode=resJson.statusCode,errMessage=resJson.errMessage,message=resJson.message;if(statusCode>200){return{success:false,status_code:statusCode,data:errMessage||message};}return{success:true,status_code:200,data:resJson};}).catch(function(err){return{success:false,status_code:500,data:err};}));case 7:createDataRes=_context3.sent;return _context3.abrupt(\"return\",createDataRes);case 9:case\"end\":return _context3.stop();}}},null,this,null,Promise);}},{key:\"handleEdit\",value:function handleEdit(){var _this$props$milk4,oldDataForEdit,records,data_objs,request_body,editDataRes;return _regeneratorRuntime.async(function handleEdit$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_this$props$milk4=this.props.milk,oldDataForEdit=_this$props$milk4.oldDataForEdit,records=_this$props$milk4.records;data_objs=[];oldDataForEdit.forEach(function(record_id){data_objs.push(_objectSpread({record_id:record_id},records.by_id[record_id]));});this.normalize(data_objs);request_body={date:formatDate(new Date()),data_objs:data_objs};_context4.next=7;return _regeneratorRuntime.awrap(fetch('https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/dev/milkintake',{method:'PUT',headers:{Accept:'application/json','Content-Type':'application/json'},body:JSON.stringify(request_body)}).then(function(res){return res.json();}).then(function(resJson){var statusCode=resJson.statusCode,message=resJson.message;if(statusCode>200){return{success:false,status_code:statusCode,data:message};}return{success:true,status_code:200,data:resJson};}).catch(function(err){return{success:false,status_code:500,data:err};}));case 7:editDataRes=_context4.sent;return _context4.abrupt(\"return\",editDataRes);case 9:case\"end\":return _context4.stop();}}},null,this,null,Promise);}},{key:\"handleRemove\",value:function handleRemove(record_id,student_id){var dataForRemoval,request_body,query,removeRes;return _regeneratorRuntime.async(function handleRemove$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:dataForRemoval=this.props.milk.dataForRemoval;if(dataForRemoval.has(record_id)){_context5.next=3;break;}return _context5.abrupt(\"return\");case 3:request_body={record_id_array:record_id,student_id:student_id};query=\"https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/dev/milkintake\";_context5.next=7;return _regeneratorRuntime.awrap(fetch(query,{method:'DELETE',headers:{Accept:'application/json','Content-Type':'application/json'},body:JSON.stringify(request_body)}).then(function(res){return res.json();}).then(function(resJson){var statusCode=resJson.statusCode,message=resJson.message;if(statusCode>200){return{success:false,status_code:statusCode,data:message};}return{success:true,status_code:200,data:resJson};}).catch(function(err){return{success:false,status_code:500,data:err};}));case 7:removeRes=_context5.sent;if(removeRes.success){this.props.removeMilkRecordSuccess();}else{this.props.removeMilkRecordFail();}case 9:case\"end\":return _context5.stop();}}},null,this,null,Promise);}},{key:\"normalize\",value:function normalize(data_objs){for(var i=0;i<data_objs.length;i++){data_objs[i].time=formatTime(data_objs[i].time);}}},{key:\"selectDatetimeConfirm\",value:function selectDatetimeConfirm(time){var teacher_id=this.props.route.params.teacher_id;var record_id=this.state.record_id;this.setState({record_id:'',showDateTimeModal:false});this.props.editMilkTime(record_id,time,teacher_id);}},{key:\"render\",value:function render(){var _this3=this;if(this.state.isLoading){return React.createElement(Reloading,null);}var _this$state=this.state,date=_this$state.date,showDateTimeModal=_this$state.showDateTimeModal;return React.createElement(Container,null,showDateTimeModal?React.createElement(TimeModal,{start_date:date,datetime_type:'time',hideModal:function hideModal(){return _this3.setState({showDateTimeModal:false});},selectDatetimeConfirm:function selectDatetimeConfirm(datetime){return _this3.selectDatetimeConfirm(datetime);},minDatetime:null,maxDatetime:null}):null,React.createElement(View,{style:styles.subHeading},React.createElement(Text,{style:{fontSize:40}},date.getFullYear()+'.'+(date.getMonth()+1)+'.'+date.getDate()),React.createElement(TouchableHighlight,{style:{backgroundColor:'#dcf3d0',padding:10},onPress:this.handleSend},React.createElement(Text,{style:{fontSize:40,color:'grey'}},\"\\u9001\\u51FA\"))),React.createElement(Content,{contentContainerStyle:{alignItems:'center'}},Object.keys(this.props.class.students).map(function(student_id){var record_id_array=_this3.props.milk.by_student_id[student_id];var records=_this3.props.milk.records.by_id;return React.createElement(View,{key:student_id,style:{width:'98%'}},React.createElement(Card,{style:{flex:1,paddingVertical:15}},React.createElement(View,{style:{flex:1,flexDirection:'row'}},React.createElement(View,{style:{flex:1,justifyContent:'center',alignItems:'center'}},React.createElement(TouchableHighlight,{style:styles.childThumbnail,onPress:function onPress(){return _this3.handleOnAddRecord(student_id);},underlayColor:\"transparent\"},React.createElement(Image,{source:_this3.props.class.students[student_id].profile_picture===''?require(\"../../../assets/icon-thumbnail.png\"):{uri:_this3.props.class.students[student_id].profile_picture},style:styles.thumbnailImage}))),React.createElement(View,{style:{flex:3}},React.createElement(View,{style:{flexDirection:'row'}},React.createElement(View,{style:{flex:1}},React.createElement(Text,{style:{fontSize:30,paddingLeft:18}},_this3.props.class.students[student_id].name)),React.createElement(View,{style:{flex:1,paddingRight:15}},_this3.checkUnsent(student_id)?React.createElement(Text,{style:{fontSize:15,paddingLeft:18,alignSelf:'flex-end',color:'red'}},\"\\u672A\\u9001\\u51FA\"):null)),record_id_array.map(function(record_id,index){var record=records[record_id];return React.createElement(View,{key:record_id,style:styles.cardBody},React.createElement(View,{style:{width:'35%',marginRight:'3%',height:'100%'}},React.createElement(TouchableHighlight,{style:{flex:1,justifyContent:'center',backgroundColor:'#fef6dd',borderRadius:10},onPress:function onPress(){return _this3.setState({showDateTimeModal:true,record_id:record_id});}},React.createElement(Text,{style:{fontSize:35,textAlign:'center'}},record.time.getHours()+':'+record.time.getMinutes()))),React.createElement(View,{style:{flexDirection:'row',width:'35%',marginRight:'3%',alignItems:'center',justifyContent:'center',backgroundColor:'#fef6dd',height:'100%',borderRadius:10}},React.createElement(TextInput,{style:{flex:2,fontSize:35,textAlign:'center'},keyboardType:\"decimal-pad\",placeholder:\"\\u2F64\\u91CF\",value:''+record.amount,onChangeText:function onChangeText(milk_amount){_this3.handleEditMilkAmout(record_id,milk_amount);}}),React.createElement(Text,{style:{flex:1,fontSize:30,textAlign:'center'}},\"c.c.\")),React.createElement(View,{style:{width:'20%',marginRight:'4%',height:'100%'}},React.createElement(TouchableHighlight,{style:{flex:1,justifyContent:'center',backgroundColor:'#ffe1d0',borderRadius:10},onPress:function onPress(){return _this3.confirmToRemoveRecord(student_id,record_id,index);}},React.createElement(Text,{style:{fontSize:30,textAlign:'center'}},\"\\u79FB\\u9664\"))));})))));})));}}]);return TeacherMilkLog;}(React.Component);var styles=StyleSheet.create({childThumbnail:{},thumbnailImage:{width:140,height:140,borderRadius:70},subHeading:{width:'90%',flexDirection:'row',alignItems:'center',justifyContent:'space-between',alignSelf:'center'},cardBody:{flexDirection:'row',marginVertical:6}});var mapStateToProps=function mapStateToProps(state){return{class:state.classInfo,milk:state.milk};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return _objectSpread({},bindActionCreators({editMilkAmount:editMilkAmount,addMilkRecord:addMilkRecord,fetchClassMilkData:fetchClassMilkData,createDataSuccess:createDataSuccess,createDataFail:createDataFail,editDataSuccess:editDataSuccess,editDataFail:editDataFail,removeRecord:removeRecord,removeMilkRecordSuccess:removeMilkRecordSuccess,removeMilkRecordFail:removeMilkRecordFail,editMilkTime:editMilkTime},dispatch));};export default connect(mapStateToProps,mapDispatchToProps)(TeacherMilkLog);","map":{"version":3,"sources":["/home/caleb_lee/gina_web_app/components/teacher/logs/milklog.js"],"names":["React","Container","Content","Card","Toast","connect","bindActionCreators","editMilkAmount","addMilkRecord","fetchClassMilkData","createDataSuccess","createDataFail","editDataSuccess","editDataFail","removeRecord","removeMilkRecordSuccess","removeMilkRecordFail","editMilkTime","formatTime","formatDate","fetchClassData","Reloading","TimeModal","TeacherMilkLog","props","state","isLoading","date","Date","showDateTimeModal","record_id","handleSend","bind","handleOnAddRecord","isConnected","class","milk","loaded","setState","show","text","buttonText","position","type","duration","student_id","newDataForCreate","oldDataForEdit","dataForRemoval","by_student_id","record_id_list","found","i","length","has","start_date","setDate","getDate","end_date","class_id","milkData","denormalize","data","records","all_id","by_id","time","milk_amount","teacher_id","route","params","index","Alert","alert","onPress","handleRemoveRecord","style","handleRemove","size","handleCreate","handleCreateRes","success","handleEdit","handleEditRes","navigation","goBack","data_objs","forEach","push","normalize","request_body","fetch","method","headers","Accept","body","JSON","stringify","then","res","json","resJson","statusCode","errMessage","message","status_code","catch","err","createDataRes","editDataRes","record_id_array","query","removeRes","datetime","selectDatetimeConfirm","styles","subHeading","fontSize","getFullYear","getMonth","backgroundColor","padding","color","alignItems","Object","keys","students","map","width","flex","paddingVertical","flexDirection","justifyContent","childThumbnail","profile_picture","require","uri","thumbnailImage","paddingLeft","name","paddingRight","checkUnsent","alignSelf","record","cardBody","marginRight","height","borderRadius","textAlign","getHours","getMinutes","amount","handleEditMilkAmout","confirmToRemoveRecord","Component","StyleSheet","create","marginVertical","mapStateToProps","classInfo","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { StyleSheet, Image, TouchableHighlight, View, Text, TextInput, Alert} from 'react-native'\nimport { Container, Content, Card, Toast } from 'native-base'\nimport { connect } from 'react-redux'\nimport { bindActionCreators } from 'redux'\nimport {\n    editMilkAmount,\n    addMilkRecord,\n    fetchClassMilkData,\n    createDataSuccess,\n    createDataFail,\n    editDataSuccess,\n    editDataFail,\n    removeRecord,\n    removeMilkRecordSuccess,\n    removeMilkRecordFail,\n    editMilkTime\n} from '../../../redux/school/actions/index'\nimport { formatTime, formatDate, fetchClassData } from '../../util'\nimport Reloading from '../../reloading'\nimport TimeModal from '../../parent/timemodal'\n\nclass TeacherMilkLog extends React.Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            isLoading: true,\n            date: new Date(),\n            showDateTimeModal: false,\n            record_id: ''\n        }\n        this.handleSend = this.handleSend.bind(this)\n        this.handleOnAddRecord = this.handleOnAddRecord.bind(this)\n    }\n\n    componentDidMount() {\n        const { isConnected } = this.props.class\n        if (!this.props.milk.loaded && isConnected) {\n            this.fetchClassData()\n        }\n        else {\n            this.setState({\n                isLoading: false\n            })\n        }\n\n        if (!isConnected) {\n            Toast.show({\n                text: '拍謝 網路連不到! 等一下再試試看',\n                buttonText: 'Okay',\n                position: \"top\",\n                type: \"warning\",\n                duration: 2000\n            })\n        }\n    }\n\n    checkUnsent(student_id) {\n        const { newDataForCreate, oldDataForEdit, dataForRemoval, by_student_id } = this.props.milk\n        const record_id_list = by_student_id[student_id]\n        var found = false\n        for (var i = 0; i < record_id_list.length; i++) {\n            const record_id = record_id_list[i]\n            if (newDataForCreate.has(record_id) || oldDataForEdit.has(record_id)) {\n                found = true\n                break\n            }\n        }\n        return found\n    }\n\n    async fetchClassData() {\n        const { isConnected } = this.props.class\n        if (!isConnected) {\n            Toast.show({\n                text: '拍謝 網路連不到! 等一下再試試看',\n                buttonText: 'Okay',\n                position: \"top\",\n                type: \"warning\",\n                duration: 2000\n            })\n            return\n        }\n        const date = new Date()\n        const start_date = formatDate(date)\n        date.setDate(date.getDate() + 1)\n        const end_date = formatDate(date)\n        const milkData = await fetchClassData('milkintake', this.props.class.class_id, start_date, end_date)\n        this.denormalize(milkData)\n        this.props.fetchClassMilkData(milkData.data)\n        this.setState({\n            isLoading: false\n        })\n    }\n\n    denormalize(milkData) {\n        if (!milkData.data.records.all_id.length) {\n            return\n        }\n        const { by_id } = milkData.data.records\n        for (const record_id in by_id) {\n            by_id[record_id].time = new Date(by_id[record_id].time)\n        }\n    }\n\n    handleEditMilkAmout(record_id, milk_amount) {\n        const { teacher_id } = this.props.route.params\n        this.props.editMilkAmount(record_id, milk_amount, teacher_id)\n    }\n\n    handleOnAddRecord(student_id) {\n        this.props.addMilkRecord(student_id)\n    }\n\n    confirmToRemoveRecord(student_id, record_id, index) {\n        Alert.alert(\n            '確定要刪除？',\n            '',\n            [\n                { text: 'Yes', onPress: () => this.handleRemoveRecord(student_id, record_id, index) },\n                { text: 'Cancel', style: 'cancel' }\n            ]\n        )\n    }\n\n    handleRemoveRecord(student_id, record_id, index) {\n        const { isConnected } = this.props.class\n        if (!isConnected) {\n            Toast.show({\n                text: '拍謝 網路連不到! 等一下再試試看',\n                buttonText: 'Okay',\n                position: \"top\",\n                type: \"warning\",\n                duration: 2000\n            })\n            return\n        }\n        this.props.removeRecord(student_id, record_id, index)\n        this.handleRemove(record_id, student_id)\n    }\n\n    async handleSend() {\n        // this.setState({ isLoading: true })\n        const { newDataForCreate, oldDataForEdit, dataForRemoval } = this.props.milk\n        const { isConnected } = this.props.class\n        if (!isConnected) {\n            Toast.show({\n                text: '拍謝 網路連不到! 等一下再試試看',\n                buttonText: 'Okay',\n                position: \"top\",\n                type: \"warning\",\n                duration: 2000\n            })\n            return\n        }\n\n        if (newDataForCreate.size) {\n            const handleCreateRes = await this.handleCreate()\n            // console.log('handleCreateRes: ', handleCreateRes)\n            if (handleCreateRes.success) {\n                this.props.createDataSuccess()\n            } else {\n                this.props.createDataFail(handleCreateRes.data)\n                return\n            }\n        }\n\n        if (oldDataForEdit.size) {\n            const handleEditRes = await this.handleEdit()\n            // console.log('handleEditRes: ', handleEditRes)\n            if (handleEditRes.success) {\n                this.props.editDataSuccess()\n            } else {\n                this.props.editDataFail(handleEditRes.data)\n                return\n            }\n        }\n        // this.setState({ isLoading: false })\n        this.props.navigation.goBack()\n    }\n\n    async handleCreate() {\n        const { newDataForCreate, records } = this.props.milk\n        const data_objs = []\n        newDataForCreate.forEach(record_id => {\n            data_objs.push({\n                ...records.by_id[record_id]\n            })\n        })\n\n        this.normalize(data_objs)\n        const request_body = {\n            date: formatDate(new Date()),\n            data_objs\n        }\n\n        const createDataRes = await fetch('https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/dev/milkintake', {\n            method: 'POST',\n            headers: {\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify(request_body)\n        })\n            .then(res => res.json())\n            .then(resJson => {\n                // console.log('milklog/resJson: ', resJson)\n                const {statusCode, errMessage, message } = resJson\n                if (statusCode > 200) {\n                    return {\n                        success: false,\n                        status_code: statusCode,\n                        data: errMessage || message\n                    }\n                }\n                return {\n                    success: true,\n                    status_code: 200,\n                    data: resJson\n                }\n            })\n            .catch(err => {\n                return {\n                    success: false,\n                    status_code: 500,\n                    data: err\n                }\n            })\n        return createDataRes\n    }\n\n    async handleEdit() {\n        const { oldDataForEdit, records } = this.props.milk\n        const data_objs = []\n        \n        oldDataForEdit.forEach(record_id => {\n            data_objs.push({\n                record_id,\n                ...records.by_id[record_id]\n            })\n        })\n        this.normalize(data_objs)\n        const request_body = {\n            date: formatDate(new Date()),\n            data_objs\n        }\n\n        const editDataRes = await fetch('https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/dev/milkintake', {\n            method: 'PUT',\n            headers: {\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify(request_body)\n        })\n            .then(res => res.json())\n            .then(resJson => {\n                const {statusCode, message } = resJson\n                if (statusCode > 200) {\n                    return {\n                        success: false,\n                        status_code: statusCode,\n                        data: message\n                    }\n                }\n                return {\n                    success: true,\n                    status_code: 200,\n                    data: resJson\n                }\n            })\n            .catch(err => {\n                return {\n                    success: false,\n                    status_code: 500,\n                    data: err\n                }\n            })\n        return editDataRes\n    }\n\n    async handleRemove(record_id, student_id) {\n        const { dataForRemoval } = this.props.milk\n\n        if (!dataForRemoval.has(record_id)) {\n            return\n        }\n\n        var request_body = {\n            record_id_array: record_id,\n            student_id\n        }\n        const query = `https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/dev/milkintake`\n        const removeRes = await fetch(query, {\n            method: 'DELETE',\n            headers: {\n                Accept: 'application/json',\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify(request_body)\n        })\n            .then(res => res.json())\n            .then(resJson => {\n                const {statusCode, message } = resJson\n                if (statusCode > 200) {\n                    return {\n                        success: false,\n                        status_code: statusCode,\n                        data: message\n                    }\n                }\n                return {\n                    success: true,\n                    status_code: 200,\n                    data: resJson\n                }\n            })\n            .catch(err => {\n                return {\n                    success: false,\n                    status_code: 500,\n                    data: err\n                }\n            })\n\n        if (removeRes.success) {\n            this.props.removeMilkRecordSuccess()\n        } else {\n            this.props.removeMilkRecordFail()\n        }\n    }\n\n    normalize(data_objs) {\n        for (var i = 0; i < data_objs.length; i++) {\n            data_objs[i].time = formatTime(data_objs[i].time)\n        }\n    }\n\n    selectDatetimeConfirm(time) {\n        const { teacher_id } = this.props.route.params\n        const { record_id } = this.state\n        this.setState({ record_id: '', showDateTimeModal: false })\n        this.props.editMilkTime(record_id, time, teacher_id)\n    }\n\n    render() {\n        if (this.state.isLoading) {\n            return (\n                <Reloading />\n            )\n        }\n\n        const { date, showDateTimeModal } = this.state\n        return (\n            <Container>\n                {showDateTimeModal ?\n                    <TimeModal\n                        start_date={date}\n                        datetime_type={'time'}\n                        hideModal={() => this.setState({ showDateTimeModal: false })}\n                        selectDatetimeConfirm={(datetime) => this.selectDatetimeConfirm(datetime)}\n                        minDatetime={null}\n                        maxDatetime={null}\n                    />\n                    : null\n                }\n                <View style={styles.subHeading}>\n                    <Text style={{ fontSize: 40 }}>{date.getFullYear() + '.' + (date.getMonth()+1) + '.' + date.getDate()}</Text>\n                    <TouchableHighlight\n                        style={{ backgroundColor: '#dcf3d0', padding: 10 }}\n                        onPress={this.handleSend}\n                    >\n                        <Text style={{ fontSize: 40, color: 'grey' }}>送出</Text>\n                    </TouchableHighlight>\n                </View>\n                <Content contentContainerStyle={{ alignItems: 'center' }}>\n                    {Object.keys(this.props.class.students).map((student_id) => {\n                        const record_id_array = this.props.milk.by_student_id[student_id]\n                        const records = this.props.milk.records.by_id\n                        return(\n                            <View key={student_id} style={{ width: '98%' }}>\n                                <Card style={{ flex: 1, paddingVertical: 15 }}>\n                                    <View style={{ flex: 1, flexDirection: 'row'}}>\n                                        <View style={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}>\n                                            <TouchableHighlight\n                                                style={styles.childThumbnail}\n                                                onPress={() => this.handleOnAddRecord(student_id)}\n                                                underlayColor=\"transparent\"\n                                            >\n                                                <Image\n                                                    // source={{uri: this.props.class.students[student_id].profile_picture }}\n                                                    source={\n                                                        this.props.class.students[student_id].profile_picture === '' ?\n                                                            require('../../../assets/icon-thumbnail.png')\n                                                            : {uri: this.props.class.students[student_id].profile_picture}\n                                                    }\n                                                    style={styles.thumbnailImage}/>\n                                            </TouchableHighlight>\n                                        </View>\n                                        <View style={{ flex: 3}}>\n                                            <View style={{ flexDirection: 'row'}}>\n                                                <View style={{ flex: 1 }}>\n                                                    <Text style={{ fontSize: 30, paddingLeft: 18 }}>{this.props.class.students[student_id].name}</Text>\n                                                </View>\n                                                <View style={{ flex: 1, paddingRight: 15 }}>\n                                                    {this.checkUnsent(student_id) ?\n                                                        <Text style={{ fontSize: 15, paddingLeft: 18, alignSelf: 'flex-end', color: 'red' }}>\n                                                            未送出\n                                                        </Text>\n                                                        : null\n                                                    }\n                                                </View>\n                                            </View>\n                                            {record_id_array.map((record_id, index) => {\n                                                const record = records[record_id]\n                                                return (\n                                                    <View key={record_id} style={styles.cardBody}>\n                                                        <View style={{ width: '35%', marginRight: '3%', height: '100%' }}>\n                                                            <TouchableHighlight\n                                                                style={{ flex: 1, justifyContent: 'center', backgroundColor: '#fef6dd', borderRadius: 10 }}\n                                                                onPress={() => this.setState({ showDateTimeModal: true, record_id})}\n                                                            >\n                                                                <Text style={{ fontSize: 35, textAlign: 'center' }}>\n                                                                    {record.time.getHours() + ':' + record.time.getMinutes()}\n                                                                </Text>\n                                                            </TouchableHighlight>\n                                                        </View>\n                                                        <View style={{\n                                                            flexDirection: 'row',\n                                                            width: '35%',\n                                                            marginRight: '3%',\n                                                            alignItems: 'center',\n                                                            justifyContent: 'center',\n                                                            backgroundColor: '#fef6dd',\n                                                            height: '100%',\n                                                            borderRadius: 10\n                                                        }}>\n                                                            <TextInput\n                                                                style={{ flex: 2, fontSize: 35, textAlign: 'center' }}\n                                                                keyboardType='decimal-pad'\n                                                                placeholder=\"⽤量\"\n                                                                value={'' + record.amount}\n                                                                onChangeText={(milk_amount) => {this.handleEditMilkAmout(record_id, milk_amount)}}\n                                                            />\n                                                            <Text style={{ flex: 1, fontSize: 30, textAlign: 'center' }}>\n                                                                c.c.\n                                                            </Text>\n                                                        </View>\n                                                        <View style={{ width: '20%', marginRight: '4%', height: '100%' }}>\n                                                            <TouchableHighlight\n                                                                style={{ flex:1, justifyContent: 'center', backgroundColor: '#ffe1d0', borderRadius: 10}}\n                                                                onPress={() => this.confirmToRemoveRecord(student_id, record_id, index)}\n                                                            >\n                                                                <Text style={{ fontSize: 30, textAlign: 'center' }}>\n                                                                    移除\n                                                                </Text>\n                                                            </TouchableHighlight>\n                                                        </View>\n                                                    </View>\n                                                )\n                                            })}\n                                        </View>\n                                    </View>\n                                </Card>\n                            </View>\n                        )\n                    })}\n                </Content>\n            </Container>\n        )\n    }\n}\n\nconst styles = StyleSheet.create({\n    childThumbnail: {\n        // width: 100,\n        // height: 100,\n        // backgroundColor: 'white',\n        // marginLeft: -7,\n    },\n    thumbnailImage: {\n        width: 140,\n        height: 140,\n        borderRadius: 70\n    },\n    subHeading: {\n        width: '90%',\n        flexDirection: 'row',\n        alignItems: 'center',\n        justifyContent: 'space-between',\n        alignSelf: 'center'\n    },\n    cardBody: {\n        // flex: 1,\n        flexDirection: 'row',\n        marginVertical: 6\n        // alignItems: 'center',\n        // justifyContent: 'center',\n    }\n})\n\nconst mapStateToProps = (state) => {\n    return {\n        class: state.classInfo,\n        milk: state.milk\n    }\n}\n\nconst mapDispatchToProps = (dispatch) => {\n    return {\n        ...bindActionCreators({\n            editMilkAmount,\n            addMilkRecord,\n            fetchClassMilkData,\n            createDataSuccess,\n            createDataFail,\n            editDataSuccess,\n            editDataFail,\n            removeRecord,\n            removeMilkRecordSuccess,\n            removeMilkRecordFail,\n            editMilkTime\n        }, dispatch)\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps) (TeacherMilkLog)"]},"metadata":{},"sourceType":"module"}