{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _inherits from\"@babel/runtime/helpers/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import React from'react';import View from\"react-native-web/dist/exports/View\";import ScrollView from\"react-native-web/dist/exports/ScrollView\";import TouchableHighlight from\"react-native-web/dist/exports/TouchableHighlight\";import Image from\"react-native-web/dist/exports/Image\";import Text from\"react-native-web/dist/exports/Text\";import Platform from\"react-native-web/dist/exports/Platform\";import Alert from\"react-native-web/dist/exports/Alert\";import{connect}from'react-redux';import{bindActionCreators}from'redux';import*as ImagePicker from'expo-image-picker';import*as Permissions from'expo-permissions';import{put,delete_by_id,get}from\"../../util\";import{updateTeacherProfilePicture,fetchTeachersSuccess}from\"../../../redux/school/actions/index\";import Modal from\"./modal\";import AddTeacher from\"./addteacher\";import EditTeacher from\"./editteacher\";var Teachers=function(_React$Component){_inherits(Teachers,_React$Component);var _super=_createSuper(Teachers);function Teachers(props){var _this;_classCallCheck(this,Teachers);_this=_super.call(this,props);_this.getPermissionAsync=function _callee(){var _await$Permissions$as,status;return _regeneratorRuntime.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(Platform.OS==='ios')){_context.next=8;break;}_context.next=3;return _regeneratorRuntime.awrap(Permissions.askAsync(Permissions.CAMERA_ROLL));case 3:_await$Permissions$as=_context.sent;status=_await$Permissions$as.status;if(!(status!=='granted')){_context.next=8;break;}alert(\"Sorry, we need camera roll permissions to make this work!\");return _context.abrupt(\"return\");case 8:case\"end\":return _context.stop();}}},null,null,null,Promise);};_this._pickImage=function _callee2(teacher_id,url){var result,base64;return _regeneratorRuntime.async(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return _regeneratorRuntime.awrap(ImagePicker.launchImageLibraryAsync({mediaTypes:ImagePicker.MediaTypeOptions.All,allowsEditing:true,aspect:[1,1],quality:0.4,base64:true}));case 3:result=_context2.sent;if(!result.cancelled){base64=result.base64;_this.getProfilePictureURL(base64,teacher_id,url);}_context2.next=10;break;case 7:_context2.prev=7;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0);case 10:case\"end\":return _context2.stop();}}},null,null,[[0,7]],Promise);};_this.state={showModal:false,modal_type:'',selected_teacher_id:''};return _this;}_createClass(Teachers,[{key:\"componentDidMount\",value:function componentDidMount(){this.getPermissionAsync();}},{key:\"getProfilePictureURL\",value:function getProfilePictureURL(image,teacher_id,url){var school_name,teachers,body,response,success,statusCode,message,data;return _regeneratorRuntime.async(function getProfilePictureURL$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:school_name=this.props.route.params.school_name;teachers=this.props.teachers;body={image:image,url:url,path:school_name+\"/teacher/profile_picture_\"+teacher_id+\"_\"+new Date().getMilliseconds()+\".jpg\"};_context3.next=5;return _regeneratorRuntime.awrap(put(\"/user/\"+teacher_id+\"/profile-picture\",body));case 5:response=_context3.sent;success=response.success,statusCode=response.statusCode,message=response.message,data=response.data;if(success){_context3.next=10;break;}alert(\"Sorry \"+teachers[teacher_id].name+\"\\u7167\\u7247\\u4E0A\\u50B3\\u6642\\u96FB\\u8166\\u51FA\\u72C0\\u6CC1\\u4E86\\uFF01\\u8ACB\\u622A\\u5716\\u548C\\u8207\\u5DE5\\u7A0B\\u5E2B\\u806F\\u7E6B\\n\\n\"+message);return _context3.abrupt(\"return\");case 10:this.props.updateTeacherProfilePicture(teacher_id,data.image_url);case 11:case\"end\":return _context3.stop();}}},null,this,null,Promise);}},{key:\"fetchTeacherData\",value:function fetchTeacherData(){var school_id,response,success,statusCode,message,data,admins,teachers,classes;return _regeneratorRuntime.async(function fetchTeacherData$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:school_id=this.props.route.params.school_id;_context4.next=3;return _regeneratorRuntime.awrap(get(\"/school/\"+school_id+\"/teacher\"));case 3:response=_context4.sent;success=response.success,statusCode=response.statusCode,message=response.message,data=response.data;if(success){_context4.next=8;break;}alert('Sorry 取得教師資料時電腦出狀況了！請截圖和與工程師聯繫\\n\\n'+message);return _context4.abrupt(\"return\");case 8:admins=data.admins,teachers=data.teachers,classes=data.classes;this.props.fetchTeachersSuccess(admins,teachers,classes);case 10:case\"end\":return _context4.stop();}}},null,this,null,Promise);}},{key:\"getModalContent\",value:function getModalContent(){var _this2=this;var school_id=this.props.route.params.school_id;var _this$props=this.props,classes=_this$props.classes,teachers=_this$props.teachers;var _this$state=this.state,modal_type=_this$state.modal_type,selected_teacher_id=_this$state.selected_teacher_id;if(modal_type==='add_teacher'){return React.createElement(AddTeacher,{classes:classes,school_id:school_id,fetchTeacherData:function fetchTeacherData(){return _this2.fetchTeacherData();},goBack:function goBack(){return _this2.hideModal();}});}else if(modal_type==='edit_teacher'){return React.createElement(EditTeacher,{classes:classes,teacher_id:selected_teacher_id,teacher:teachers[selected_teacher_id],fetchTeacherData:function fetchTeacherData(){return _this2.fetchTeacherData();},goBack:function goBack(){return _this2.hideModal();}});}}},{key:\"hideModal\",value:function hideModal(){this.setState({showModal:false});}},{key:\"confirmDeleteTeacher\",value:function confirmDeleteTeacher(teacher_id){var teachers=this.props.teachers;var confirmed=confirm(teachers[teacher_id].name+\" \\u522A\\u9664\\u78BA\\u8A8D\");if(confirmed){this.deleteTeacher(teacher_id);}}},{key:\"deleteTeacher\",value:function deleteTeacher(teacher_id){var response,success,statusCode,message,data;return _regeneratorRuntime.async(function deleteTeacher$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return _regeneratorRuntime.awrap(delete_by_id(\"/user/\"+teacher_id));case 2:response=_context5.sent;success=response.success,statusCode=response.statusCode,message=response.message,data=response.data;if(success){_context5.next=7;break;}alert(\"Sorry \"+teachers[teacher_id].name+\"\\u522A\\u9664\\u6642\\u96FB\\u8166\\u51FA\\u72C0\\u6CC1\\u4E86\\uFF01\\u8ACB\\u622A\\u5716\\u548C\\u8207\\u5DE5\\u7A0B\\u5E2B\\u806F\\u7E6B\\n\\n\"+message);return _context5.abrupt(\"return\");case 7:this.fetchTeacherData();case 8:case\"end\":return _context5.stop();}}},null,this,null,Promise);}},{key:\"render\",value:function render(){var _this3=this;var teachers=this.props.teachers;var showModal=this.state.showModal;return React.createElement(View,null,React.createElement(Modal,{show:showModal,component:this.getModalContent(),hideModal:function hideModal(){return _this3.hideModal();}}),React.createElement(ScrollView,null,React.createElement(View,{style:{padding:20}},React.createElement(TouchableHighlight,{style:{padding:10,alignSelf:'flex-end',backgroundColor:'#ffddb7'},onPress:function onPress(){return _this3.setState({showModal:true,modal_type:'add_teacher'});}},React.createElement(Text,{style:{fontSize:40}},\"\\u65B0\\u589E\\u6559\\u5E2B\"))),Object.keys(teachers).map(function(id,index){var teacher=teachers[id];return React.createElement(View,{key:id,style:{flex:1,backgroundColor:'lightgrey',flexDirection:'row',marginBottom:10,padding:15}},React.createElement(TouchableHighlight,{style:{},onPress:function onPress(){return _this3._pickImage(id,teacher.profile_picture);}},React.createElement(Image,{source:teacher.profile_picture===''?require(\"../../../assets/icon-teacher-thumbnail.png\"):{uri:teacher.profile_picture},style:{width:200,height:200,borderRadius:100}})),React.createElement(View,{style:{flex:5,paddingLeft:15}},React.createElement(View,null,React.createElement(Text,{style:{fontSize:50}},teacher.name))),React.createElement(View,{style:{flex:1,justifyContent:'space-evenly'}},React.createElement(View,{style:{backgroundColor:'white'}},React.createElement(TouchableHighlight,{style:{padding:15,justifyContent:'center'},onPress:function onPress(){return _this3.setState({showModal:true,modal_type:'edit_teacher',selected_teacher_id:id});}},React.createElement(Text,{style:{fontSize:25,alignSelf:'center'}},\"\\u7DE8\\u8F2F\"))),React.createElement(View,{style:{backgroundColor:'#fa625f'}},React.createElement(TouchableHighlight,{style:{padding:15,justifyContent:'center'},onPress:function onPress(){return _this3.confirmDeleteTeacher(id);}},React.createElement(Text,{style:{fontSize:25,alignSelf:'center'}},\"\\u522A\\u9664\")))));})));}}]);return Teachers;}(React.Component);var mapStateToProps=function mapStateToProps(state){return{teachers:state.school.teachers,classes:state.school.classes};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return _objectSpread({},bindActionCreators({updateTeacherProfilePicture:updateTeacherProfilePicture,fetchTeachersSuccess:fetchTeachersSuccess},dispatch));};export default connect(mapStateToProps,mapDispatchToProps)(Teachers);","map":{"version":3,"sources":["/home/caleb_lee/gina_web_app/components/teacher/admin/teachers.js"],"names":["React","connect","bindActionCreators","ImagePicker","Permissions","put","delete_by_id","get","updateTeacherProfilePicture","fetchTeachersSuccess","Modal","AddTeacher","EditTeacher","Teachers","props","getPermissionAsync","Platform","OS","askAsync","CAMERA_ROLL","status","alert","_pickImage","teacher_id","url","launchImageLibraryAsync","mediaTypes","MediaTypeOptions","All","allowsEditing","aspect","quality","base64","result","cancelled","getProfilePictureURL","console","log","state","showModal","modal_type","selected_teacher_id","image","school_name","route","params","teachers","body","path","Date","getMilliseconds","response","success","statusCode","message","data","name","image_url","school_id","admins","classes","fetchTeacherData","hideModal","setState","confirmed","confirm","deleteTeacher","getModalContent","padding","alignSelf","backgroundColor","fontSize","Object","keys","map","id","index","teacher","flex","flexDirection","marginBottom","profile_picture","require","uri","width","height","borderRadius","paddingLeft","justifyContent","confirmDeleteTeacher","Component","mapStateToProps","school","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { View, ScrollView, TouchableHighlight, Image, Text, Platform, Alert } from 'react-native'\nimport { connect } from 'react-redux'\nimport { bindActionCreators } from 'redux'\nimport * as ImagePicker from 'expo-image-picker';\nimport * as Permissions from 'expo-permissions';\nimport { put, delete_by_id, get } from '../../util'\nimport { updateTeacherProfilePicture, fetchTeachersSuccess  } from '../../../redux/school/actions/index'\nimport Modal from './modal'\nimport AddTeacher from './addteacher';\nimport EditTeacher from './editteacher';\n\n/*\nPage where we view and edit Teacher profiles:\n  -creating teacher profile\n  -editing teacher profile\n  -removing teacher profile\n*/\n\nclass Teachers extends React.Component{\n  constructor(props) {\n    super(props)\n    this.state={\n      showModal: false,\n      modal_type: '',\n      selected_teacher_id: ''\n    }\n  }\n\n  componentDidMount() {\n    this.getPermissionAsync()\n  }\n\n  getPermissionAsync = async () => {\n    if (Platform.OS === 'ios') {\n      const { status } = await Permissions.askAsync(Permissions.CAMERA_ROLL);\n      if (status !== 'granted') {\n        alert(`Sorry, we need camera roll permissions to make this work!`)\n        return \n      }\n    }\n  };\n\n  _pickImage = async (teacher_id, url) => {\n    try {\n      let result = await ImagePicker.launchImageLibraryAsync({\n        mediaTypes: ImagePicker.MediaTypeOptions.All,\n        allowsEditing: true,\n        aspect: [1,1],\n        quality: 0.4,\n        base64: true\n      });\n      if (!result.cancelled) {\n        const { base64 } = result\n        this.getProfilePictureURL(base64, teacher_id, url)\n      }\n      // console.log(result);\n    } catch (E) {\n      console.log(E);\n    }\n  };\n\n  async getProfilePictureURL(image, teacher_id, url) {\n    const { school_name } = this.props.route.params\n    const { teachers } = this.props\n    const body = {\n      image,\n      url,\n      path: `${school_name}/teacher/profile_picture_${teacher_id}_${(new Date()).getMilliseconds()}.jpg`\n    }\n    const response = await put(`/user/${teacher_id}/profile-picture`, body)\n    // console.log(response)\n    const { success, statusCode, message, data } = response\n    if (!success) {\n      alert(`Sorry ${teachers[teacher_id].name}照片上傳時電腦出狀況了！請截圖和與工程師聯繫\\n\\n` + message)\n      return \n    }\n    this.props.updateTeacherProfilePicture(teacher_id, data.image_url)\n  }\n\n  async fetchTeacherData() {\n    const { school_id } = this.props.route.params\n    const response = await get(`/school/${school_id}/teacher`)\n    const { success, statusCode, message, data } = response\n    if (!success) {\n        alert('Sorry 取得教師資料時電腦出狀況了！請截圖和與工程師聯繫\\n\\n' + message)\n        return \n    }\n\n    const {admins, teachers, classes} = data\n    this.props.fetchTeachersSuccess(admins, teachers, classes)\n}\n\n  getModalContent() {\n    const { school_id } = this.props.route.params\n    const { classes, teachers } = this.props\n    const { modal_type, selected_teacher_id } = this.state\n    if (modal_type === 'add_teacher') {\n      return <AddTeacher\n                classes={classes}\n                school_id={school_id}\n                fetchTeacherData={() => this.fetchTeacherData()}\n                goBack={() => this.hideModal()}\n            />\n    } else if (modal_type === 'edit_teacher') {\n      return <EditTeacher\n                classes={classes}\n                teacher_id={selected_teacher_id}\n                teacher={teachers[selected_teacher_id]}\n                fetchTeacherData={() => this.fetchTeacherData()}\n                goBack={() => this.hideModal()}\n            />\n    }\n  }\n\n  hideModal() {\n    this.setState({\n      showModal: false\n    })\n  }\n\n  confirmDeleteTeacher(teacher_id) {\n    const {teachers} = this.props\n    const confirmed = confirm(`${teachers[teacher_id].name} 刪除確認`)\n    if (confirmed) {\n      this.deleteTeacher(teacher_id)\n    }\n  }\n\n  async deleteTeacher(teacher_id) {\n    const response = await delete_by_id(`/user/${teacher_id}`)\n    const { success, statusCode, message, data } = response\n    if (!success) {\n      alert(`Sorry ${teachers[teacher_id].name}刪除時電腦出狀況了！請截圖和與工程師聯繫\\n\\n` + message)\n      return \n    }\n    this.fetchTeacherData()\n  }\n\n  render() {\n    const { teachers } = this.props\n    const { showModal } = this.state\n    return (\n      <View>\n        <Modal\n          show={showModal}\n          component={this.getModalContent()}\n          hideModal={() => this.hideModal()}\n        />\n        <ScrollView>\n          <View style={{ padding: 20 }}>\n            <TouchableHighlight\n              style={{ padding: 10, alignSelf: 'flex-end', backgroundColor: '#ffddb7' }}\n              onPress={() => this.setState({ showModal: true, modal_type: 'add_teacher' })}\n            >\n              <Text style={{ fontSize: 40 }}>新增教師</Text>\n            </TouchableHighlight>\n          </View>\n          {Object.keys(teachers).map((id, index) => {\n            const teacher = teachers[id]\n            return (\n              <View key={id} style={{ flex:1, backgroundColor: 'lightgrey', flexDirection: 'row', marginBottom: 10, padding: 15 }}>\n                {/* profile picture */}\n                <TouchableHighlight\n                  style={{ }}\n                  onPress={() => this._pickImage(id, teacher.profile_picture)}\n                >\n                  <Image\n                    source={\n                      teacher.profile_picture === '' ?\n                        require('../../../assets/icon-teacher-thumbnail.png')\n                        : {uri: teacher.profile_picture}\n                    }\n                    style={{\n                      width: 200,\n                      height: 200,\n                      borderRadius: 100\n                    }}\n                  />\n                </TouchableHighlight>\n                \n                <View style={{ flex: 5, paddingLeft: 15 }}>\n                  {/* Name */}\n                  <View>\n                    <Text style={{ fontSize: 50 }}>{teacher.name}</Text>\n                  </View>\n                </View>\n\n                {/* Right */}\n                <View style={{ flex: 1, justifyContent: 'space-evenly' }}>\n                  <View style={{ backgroundColor: 'white' }}>\n                    <TouchableHighlight\n                      style={{padding: 15, justifyContent: 'center'}}\n                      onPress={() => this.setState({ showModal: true, modal_type: 'edit_teacher', selected_teacher_id: id })}\n                    >\n                      <Text style={{ fontSize: 25, alignSelf: 'center' }}>編輯</Text>\n                    </TouchableHighlight>\n                  </View>\n\n                  <View style={{ backgroundColor: '#fa625f' }}>\n                    <TouchableHighlight\n                      style={{padding: 15, justifyContent: 'center'}}\n                      onPress={() => this.confirmDeleteTeacher(id)}\n                    >\n                      <Text style={{ fontSize: 25, alignSelf: 'center' }}>刪除</Text>\n                    </TouchableHighlight>\n                  </View>\n\n                </View>\n              </View>\n            )\n          })}\n        </ScrollView>\n      </View>\n    )\n  }\n}\n\nconst mapStateToProps = (state) => {\n  return {\n    teachers: state.school.teachers,\n    classes: state.school.classes\n  }\n}\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    ...bindActionCreators({\n      updateTeacherProfilePicture,\n      fetchTeachersSuccess\n    }, dispatch)\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps) (Teachers)"]},"metadata":{},"sourceType":"module"}