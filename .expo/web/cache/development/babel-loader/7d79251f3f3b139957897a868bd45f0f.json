{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nvar _jsxFileName = \"/home/caleb_lee/gina_web_app/components/auth/authloading.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function () { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from 'react';\nimport View from \"react-native-web/dist/exports/View\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport ActivityIndicator from \"react-native-web/dist/exports/ActivityIndicator\";\nimport * as Font from 'expo-font';\nimport Auth from '@aws-amplify/auth';\nimport SchoolApp from \"../teacher/schoolapp\";\nimport Signin from \"./signin\";\nimport Signup from \"./signup\";\nimport ParentApp from \"../parent/parentapp\";\nimport ConfirmSignUp from \"./confirmsignup\";\nimport Reloading from \"../reloading\";\nimport YellowBox from \"react-native-web/dist/exports/YellowBox\";\nimport ENV from \"../../variables\";\nYellowBox.ignoreWarnings(['Non-serializable values were found in the navigation state']);\n\nvar AuthLoading = function (_React$Component) {\n  _inherits(AuthLoading, _React$Component);\n\n  var _super = _createSuper(AuthLoading);\n\n  function AuthLoading(props) {\n    var _this;\n\n    _classCallCheck(this, AuthLoading);\n\n    _this = _super.call(this, props);\n    _this.state = {\n      status: '',\n      id: '',\n      username: ''\n    };\n    _this.getCurrentUser = _this.getCurrentUser.bind(_assertThisInitialized(_this));\n    return _this;\n  }\n\n  _createClass(AuthLoading, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      return _regeneratorRuntime.async(function componentDidMount$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _regeneratorRuntime.awrap(Font.loadAsync({\n                'Roboto': require(\"../../node_modules/native-base/Fonts/Roboto.ttf\"),\n                'Roboto_medium': require(\"../../node_modules/native-base/Fonts/Roboto_medium.ttf\")\n              }));\n\n            case 2:\n              this.getCurrentUser();\n\n            case 3:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, this, null, Promise);\n    }\n  }, {\n    key: \"getCurrentUser\",\n    value: function getCurrentUser() {\n      var _this2 = this;\n\n      this.setState({\n        status: 'loading'\n      });\n      Auth.currentAuthenticatedUser().then(function (user) {\n        console.log(user.username);\n        fetch(\"https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/\" + ENV + \"/user?username=\" + user.username, {\n          method: 'GET',\n          headers: {\n            Accept: 'application/json',\n            'Content-Type': 'application/json'\n          }\n        }).then(function (res) {\n          return res.json();\n        }).then(function (resJson) {\n          var statusCode = resJson.statusCode,\n              message = resJson.message,\n              data = resJson.data;\n\n          if (statusCode === 200) {\n            _this2.setState({\n              status: data.role,\n              id: data.id,\n              username: user.username\n            });\n          } else {\n            _this2.setState({\n              status: 'signedout'\n            });\n          }\n        }).catch(function (err) {\n          console.log('err: ', err);\n\n          _this2.setState({\n            status: 'signedout'\n          });\n        });\n      }).catch(function (err) {\n        if (err == 'not authenticated') {\n          _this2.setState({\n            status: 'signedout'\n          });\n        }\n\n        _this2.setState({\n          status: 'signedout'\n        });\n      });\n    }\n  }, {\n    key: \"changeAuthState\",\n    value: function changeAuthState(state, username) {\n      this.setState({\n        status: state,\n        username: username\n      });\n    }\n  }, {\n    key: \"handleSignOut\",\n    value: function handleSignOut() {\n      var _this3 = this;\n\n      Auth.signOut().then(function () {\n        _this3.getCurrentUser();\n      }).catch(function (err) {\n        return console.log(err);\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this4 = this;\n\n      console.log('ENV: ', ENV);\n      var _this$state = this.state,\n          status = _this$state.status,\n          username = _this$state.username;\n      console.log('status: ', status);\n      return React.createElement(View, {\n        style: {\n          flex: 1\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 100,\n          columnNumber: 13\n        }\n      }, status.includes('parent') ? React.createElement(ParentApp, {\n        parent_id: this.state.id,\n        handleSignOut: function handleSignOut() {\n          return _this4.handleSignOut();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 103,\n          columnNumber: 25\n        }\n      }) : status === 'school' ? React.createElement(SchoolApp, {\n        school_id: this.state.id,\n        school_name: username,\n        handleSignOut: function handleSignOut() {\n          return _this4.handleSignOut();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 105,\n          columnNumber: 29\n        }\n      }) : status === 'ConfirmSignUpPage' ? React.createElement(ConfirmSignUp, {\n        getCurrentUser: this.getCurrentUser,\n        username: this.state.username,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 107,\n          columnNumber: 33\n        }\n      }) : status === 'signedout' || status === 'school' ? React.createElement(Signin, {\n        loadAuth: this.getCurrentUser,\n        changeAuthState: function changeAuthState(state, username) {\n          return _this4.changeAuthState(state, username);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 109,\n          columnNumber: 37\n        }\n      }) : React.createElement(View, {\n        style: {\n          flex: 1,\n          justifyContent: 'center',\n          alignItems: 'center'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 111,\n          columnNumber: 41\n        }\n      }, React.createElement(Text, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 112,\n          columnNumber: 45\n        }\n      }, \"Loading...\"), React.createElement(ActivityIndicator, {\n        size: \"large\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 113,\n          columnNumber: 45\n        }\n      })));\n    }\n  }]);\n\n  return AuthLoading;\n}(React.Component);\n\nexport default AuthLoading;","map":{"version":3,"sources":["/home/caleb_lee/gina_web_app/components/auth/authloading.js"],"names":["React","Font","Auth","SchoolApp","Signin","Signup","ParentApp","ConfirmSignUp","Reloading","ENV","YellowBox","ignoreWarnings","AuthLoading","props","state","status","id","username","getCurrentUser","bind","loadAsync","require","setState","currentAuthenticatedUser","then","user","console","log","fetch","method","headers","Accept","res","json","resJson","statusCode","message","data","role","catch","err","signOut","flex","includes","handleSignOut","changeAuthState","justifyContent","alignItems","Component"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { View, Text, ActivityIndicator } from 'react-native'\nimport * as Font from 'expo-font'\nimport Auth from '@aws-amplify/auth'\nimport SchoolApp from '../teacher/schoolapp'\nimport Signin from './signin'\nimport Signup from './signup'\nimport ParentApp from '../parent/parentapp'\nimport ConfirmSignUp from './confirmsignup'\nimport Reloading from '../reloading'\nimport { YellowBox } from 'react-native';\nimport ENV from '../../variables'\n\nYellowBox.ignoreWarnings([\n    'Non-serializable values were found in the navigation state',\n]);\n\nclass AuthLoading extends React.Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            status: '',\n            id: '',\n            username: ''\n        }\n        this.getCurrentUser = this.getCurrentUser.bind(this)\n    }\n\n    async componentDidMount() {\n        await Font.loadAsync({\n            'Roboto': require('../../node_modules/native-base/Fonts/Roboto.ttf'),\n            'Roboto_medium': require('../../node_modules/native-base/Fonts/Roboto_medium.ttf'),\n        })\n        this.getCurrentUser()\n    }\n\n    getCurrentUser() {\n        this.setState({ status: 'loading' })\n        Auth.currentAuthenticatedUser()\n            .then(user => {\n                //user is authenticated\n                console.log(user.username)\n                fetch(`https://iejnoswtqj.execute-api.us-east-1.amazonaws.com/${ENV}/user?username=${user.username}`, {\n                    method: 'GET',\n                    headers: {\n                        Accept: 'application/json',\n                        'Content-Type': 'application/json'\n                    }\n                })\n                    .then((res) => res.json())\n                    .then((resJson) => {\n                        // get id, name, role of admin and parents\n                        const { statusCode, message, data } = resJson\n                        // console.log('resJson: ', resJson)\n                        if (statusCode === 200) {\n                            this.setState({\n                                status: data.role,\n                                id: data.id,\n                                username: user.username\n                            })\n                        } else {\n                            this.setState({\n                                status: 'signedout'\n                            })\n                        }\n                    })\n                    .catch((err) => {\n                        console.log('err: ', err)\n                        this.setState({ status: 'signedout' })\n                    })\n            })\n            .catch(err => {\n                if (err == 'not authenticated') {\n                    this.setState({ status: 'signedout' })\n                }\n                this.setState({ status: 'signedout' })\n            })\n    }\n\n    changeAuthState(state, username) {\n        this.setState({\n            status: state,\n            username\n        })\n    }\n\n    handleSignOut() {\n        Auth.signOut()\n            .then(() => {\n                this.getCurrentUser()\n            })\n            .catch(err => console.log(err))\n    }\n\n    render() {\n        console.log('ENV: ', ENV)\n        const { status, username } = this.state\n        console.log('status: ', status)\n        return (\n            <View style={{ flex: 1 }}>\n                {\n                    status.includes('parent') ?\n                        <ParentApp parent_id={this.state.id} handleSignOut={() => this.handleSignOut()}/>\n                        : status === 'school' ? \n                            <SchoolApp school_id={this.state.id} school_name={username} handleSignOut={() => this.handleSignOut()} />\n                            : status === 'ConfirmSignUpPage' ?\n                                <ConfirmSignUp getCurrentUser={this.getCurrentUser} username={this.state.username}/>\n                                : status === 'signedout' || status === 'school' ?\n                                    <Signin loadAuth={this.getCurrentUser} changeAuthState={(state,username) => this.changeAuthState(state, username)} />\n                                    :\n                                        <View style={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}>\n                                            <Text>Loading...</Text>\n                                            <ActivityIndicator size=\"large\"></ActivityIndicator>\n                                        </View>\n                }\n            </View>\n        )\n    }\n}\n\n// const mapDispatchToProps = (dispatch) => {\n//     return ({\n//         ...bindActionCreators({ initializeClass }, dispatch)\n//     })\n// }\n\n// export default connect(null, mapDispatchToProps) (AuthLoading)\nexport default AuthLoading"]},"metadata":{},"sourceType":"module"}